<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- SEO Meta Tags -->
    <meta name="description"
        content="Tiệm Bánh Netflix - Chia sẻ tài khoản Netflix chất lượng cao 4K UHD. Giá rẻ, ổn định, hỗ trợ 24/7. Đăng ký ngay để trải nghiệm Netflix chính hãng với chi phí tiết kiệm.">
    <meta name="keywords"
        content="Netflix 4K, chia sẻ Netflix, Netflix giá rẻ, tài khoản Netflix, Netflix Việt Nam, Netflix Premium, Netflix UHD, Tiệm Bánh Netflix">
    <meta name="author" content="Tiệm Bánh Netflix">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://tiembanh4k.com/">

    <!-- Theme Color for Mobile Browsers -->
    <meta name="theme-color" content="#e50914">
    <meta name="msapplication-TileColor" content="#e50914">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://tiembanh4k.com/">
    <meta property="og:title" content="Tiệm Bánh Netflix - Chia Sẻ Netflix 4K Chất Lượng Cao">
    <meta property="og:description"
        content="Chia sẻ tài khoản Netflix chất lượng cao 4K UHD. Giá rẻ, ổn định, hỗ trợ 24/7.">
    <meta property="og:image" content="https://tiembanh4k.com/Background.webp">
    <meta property="og:image:width" content="1920">
    <meta property="og:image:height" content="1080">
    <meta property="og:image:type" content="image/webp">
    <meta property="og:locale" content="vi_VN">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://tiembanh4k.com/">
    <meta property="twitter:title" content="Tiệm Bánh Netflix - Chia Sẻ Netflix 4K Chất Lượng Cao">
    <meta property="twitter:description"
        content="Chia sẻ tài khoản Netflix chất lượng cao 4K UHD. Giá rẻ, ổn định, hỗ trợ 24/7.">
    <meta property="twitter:image" content="https://tiembanh4k.com/Background.webp">

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-GM4CGKGZBM"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'G-GM4CGKGZBM');
    </script>

    <!-- Structured Data for Google Search -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Organization",
      "name": "Tiệm Bánh Netflix",
      "url": "https://tiembanh4k.com",
      "logo": "https://tiembanh4k.com/favicon.png",
      "description": "Chia sẻ tài khoản Netflix chất lượng cao 4K UHD. Giá rẻ, ổn định, hỗ trợ 24/7.",
      "sameAs": [
        "https://www.facebook.com/tiembanh4k/"
      ],
      "contactPoint": {
        "@type": "ContactPoint",
        "contactType": "Customer Service",
        "url": "https://www.facebook.com/tiembanh4k/"
      }
    }
    </script>

    <title>Tiệm Bánh Netflix - Chia Sẻ Netflix 4K Chất Lượng Cao</title>

    <!-- Favicon - PNG with transparent background (for Google favicon) -->
    <link rel="icon" type="image/png" sizes="48x48" href="favicon-48.png">
    <link rel="icon" type="image/png" sizes="96x96" href="favicon-96.png">
    <link rel="icon" type="image/png" sizes="144x144" href="favicon-144.png">
    <link rel="icon" type="image/png" sizes="192x192" href="favicon.png">
    <link rel="icon" type="image/png" sizes="512x512" href="favicon-512.png">
    <link rel="apple-touch-icon" sizes="180x180" href="favicon.png">
    <link rel="manifest" href="manifest.json">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, rgba(20, 20, 20, 0.95) 0%, rgba(26, 26, 26, 0.95) 100%),
                url('Background.webp') center/cover fixed;
            color: #fff;
            min-height: 100vh;
            padding: 20px;
        }

        .main-wrapper {
            min-height: calc(100vh - 40px);
            display: flex;
            flex-direction: column;
        }

        .main-content {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .container {
            max-width: 1200px;
            width: 100%;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .main-layout {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 25px;
        }

        .features-area {
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 35px;
            box-shadow: 0 12px 48px rgba(0, 0, 0, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .sidebar {
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 12px 48px rgba(0, 0, 0, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.1);
            height: fit-content;
        }

        /* ========== MOBILE RESPONSIVE ========== */
        @media (max-width: 768px) {
            body {
                padding: 20px;
                background: #000 !important;
                /* Nền đen thuần */
            }

            .main-wrapper {
                min-height: auto;
            }

            .main-content {
                align-items: flex-start;
            }

            .container {
                max-width: 100%;
            }

            .main-layout {
                grid-template-columns: 1fr;
                gap: 0;
            }

            /* Ẩn header và features-area trên mobile khi đã đăng nhập */
            .header {
                display: none !important;
            }

            .features-area {
                display: none !important;
            }

            /* Sidebar (Account Overview) - full width, no box */
            .sidebar {
                background: transparent !important;
                border: none !important;
                box-shadow: none !important;
                backdrop-filter: none !important;
                padding: 0;
                max-width: 300px;
                margin: 0 auto;
            }

            .sidebar .section-title {
                text-align: center;
                font-size: 1rem;
                margin-bottom: 20px;
                color: #e50914;
            }

            /* User profile card */
            #userProfileCard {
                text-align: center;
            }

            #userProfileCard>div:first-child {
                margin-bottom: 15px;
            }

            /* Avatar smaller */
            #userProfileCard div[style*="width: 80px"] {
                width: 60px !important;
                height: 60px !important;
                font-size: 1.8rem !important;
            }

            #userDisplayName {
                font-size: 1.1rem !important;
            }

            #userEmail {
                font-size: 0.8rem !important;
            }

            /* Info card */
            #userInfoCard {
                background: transparent !important;
                border: 1px solid rgba(255, 255, 255, 0.1) !important;
                padding: 12px !important;
                border-radius: 8px !important;
            }

            #userInfoCard span {
                font-size: 0.75rem !important;
            }

            #userType {
                font-size: 1rem !important;
            }

            /* Buttons mobile style */
            .sidebar .btn {
                padding: 12px 0 !important;
                font-size: 0.8rem !important;
                background: transparent !important;
                border: 1px solid rgba(255, 255, 255, 0.2) !important;
                margin-bottom: 8px !important;
            }

            /* Ẩn nút Báo hỏng trên mobile */
            .sidebar .btn[onclick*="showReportIssueModal"] {
                display: none !important;
            }

            /* Ẩn phần Extension Status trên mobile */
            .sidebar .divider,
            .sidebar>div:last-child {
                display: none !important;
            }

            /* Đổi text Account Overview thành Tiệm Bánh Netflix */
            .sidebar .section-title {
                font-size: 0 !important;
                color: transparent !important;
            }

            .sidebar .section-title::before {
                content: "Tiệm Bánh Netflix";
                font-size: 1.2rem;
                color: #e50914;
                font-weight: 700;
            }

            /* Mobile TV Activation Form */
            #mobileTvForm {
                display: block !important;
                margin-bottom: 15px;
                padding: 12px;
                border: 1px solid rgba(255, 255, 255, 0.1);
                border-radius: 8px;
            }

            #mobileTvForm .tv-title {
                font-size: 0.75rem;
                color: #fbbf24;
                font-weight: 700;
                margin-bottom: 8px;
                text-align: center;
            }

            #mobileTvForm .tv-input-row {
                display: flex;
                gap: 8px;
            }

            #mobileTvForm input {
                flex: 1;
                padding: 10px;
                font-size: 0.8rem;
                background: transparent;
                border: 1px solid rgba(255, 255, 255, 0.2);
                border-radius: 6px;
                color: #fff;
                text-align: center;
                letter-spacing: 2px;
            }

            #mobileTvForm input::placeholder {
                color: #666;
                letter-spacing: 0;
            }

            #mobileTvForm button {
                padding: 10px 15px;
                font-size: 0.75rem;
                background: rgba(34, 197, 94, 0.1);
                border: 1px solid #22c55e;
                color: #22c55e;
                border-radius: 6px;
                cursor: pointer;
                font-weight: 600;
                min-width: 85px;
                /* Giữ chiều rộng cố định để không giật UI khi loading */
            }

            #mobileTvForm .tv-status {
                font-size: 0.7rem;
                margin-top: 8px;
                text-align: center;
            }

            /* Footer hidden */
            footer {
                display: none !important;
            }

            /* Custom Modal (Account Help, Referral History, etc) - Mobile */
            .custom-modal-overlay {
                padding: 20px !important;
                align-items: center !important;
            }

            .custom-modal-dialog {
                max-width: 280px !important;
                width: 100% !important;
                margin: 0 auto !important;
                border-radius: 10px !important;
            }

            .custom-modal-header {
                padding: 10px 12px !important;
                gap: 6px !important;
            }

            .custom-modal-icon {
                font-size: 16px !important;
            }

            .custom-modal-title {
                font-size: 0.85rem !important;
            }

            .custom-modal-body {
                padding: 10px 12px !important;
                font-size: 0.7rem !important;
                line-height: 1.4 !important;
                max-height: 45vh !important;
                overflow-y: auto !important;
            }

            .custom-modal-body div {
                width: 100% !important;
                max-width: 100% !important;
            }

            .custom-modal-body p {
                font-size: 0.7rem !important;
                margin-bottom: 5px !important;
            }

            .custom-modal-body strong {
                font-size: 0.7rem !important;
            }

            .custom-modal-footer {
                padding: 8px 12px !important;
            }

            .custom-modal-btn {
                padding: 8px 16px !important;
                font-size: 0.75rem !important;
            }

            /* Referral Notification Modal (Tin vui!) - Mobile */
            .referral-notification-overlay {
                padding: 20px !important;
            }

            .referral-notification-modal {
                max-width: 280px !important;
                width: 100% !important;
                border-radius: 12px !important;
            }

            .referral-notification-header {
                padding: 15px 12px 10px !important;
            }

            .referral-notification-icon {
                font-size: 32px !important;
                margin-bottom: 6px !important;
            }

            .referral-notification-title {
                font-size: 1rem !important;
                margin-bottom: 4px !important;
            }

            .referral-notification-subtitle {
                font-size: 0.7rem !important;
            }

            .referral-notification-body {
                padding: 12px !important;
            }

            .referral-notification-item {
                padding: 10px !important;
                margin-bottom: 8px !important;
                border-radius: 8px !important;
            }

            .referral-notification-email {
                font-size: 0.72rem !important;
            }

            .referral-notification-credits {
                font-size: 0.7rem !important;
                padding: 3px 8px !important;
            }

            .referral-notification-time {
                font-size: 0.65rem !important;
            }

            .referral-notification-summary {
                padding: 12px !important;
                border-radius: 8px !important;
                margin-top: 10px !important;
            }

            .referral-notification-total {
                font-size: 1.3rem !important;
                margin-bottom: 2px !important;
            }

            .referral-notification-total-label {
                font-size: 0.7rem !important;
            }

            .referral-notification-remaining {
                font-size: 0.7rem !important;
                margin-top: 8px !important;
            }

            .referral-notification-cta {
                padding: 8px !important;
                margin-top: 10px !important;
                font-size: 0.65rem !important;
                border-radius: 6px !important;
            }

            .referral-notification-footer {
                padding: 10px 12px !important;
            }

            .referral-notification-btn {
                padding: 10px 24px !important;
                font-size: 0.75rem !important;
                border-radius: 6px !important;
            }

            /* Purchase Credits Modal - Mobile */
            #purchaseCreditsModal {
                padding: 15px !important;
                align-items: center !important;
            }

            #purchaseCreditsModal .modal-content {
                max-width: 100% !important;
                width: 100% !important;
                padding: 15px !important;
                margin: 0 !important;
                max-height: none !important;
                overflow-y: visible !important;
                border-radius: 12px !important;
            }

            #purchaseCreditsModal h2 {
                font-size: 1.1rem !important;
                margin-bottom: 4px !important;
            }

            #purchaseCreditsModal .modal-content>div:first-child p {
                font-size: 0.65rem !important;
                margin-bottom: 6px !important;
            }

            /* Conversion rate section */
            #purchaseCreditsModal .modal-content>div:nth-child(2) {
                margin-bottom: 12px !important;
                margin-top: 8px !important;
            }

            #purchaseCreditsModal .modal-content>div:nth-child(2) span {
                font-size: 0.85rem !important;
            }

            /* 2 column to 1 column on mobile */
            #purchaseCreditsModal .modal-content>div:nth-child(3) {
                display: flex !important;
                flex-direction: column !important;
                gap: 10px !important;
            }

            /* Input box smaller */
            #purchaseCreditsModal #inputBox {
                padding: 10px !important;
                margin-bottom: 8px !important;
            }

            #purchaseCreditsModal #inputBox p {
                font-size: 0.65rem !important;
                margin-bottom: 4px !important;
            }

            #purchaseCreditsModal #purchaseAmount {
                font-size: 1.2rem !important;
            }

            #purchaseCreditsModal #inputBox span {
                font-size: 0.8rem !important;
            }

            /* Credits box smaller */
            #purchaseCreditsModal #creditsAmount {
                font-size: 1.4rem !important;
            }

            /* Quick select - horizontal on mobile */
            #purchaseCreditsModal .modal-content>div:nth-child(3)>div:last-child>div {
                display: grid !important;
                grid-template-columns: repeat(2, 1fr) !important;
                gap: 6px !important;
            }

            #purchaseCreditsModal .modal-content>div:nth-child(3)>div:last-child>div button {
                padding: 8px !important;
            }

            #purchaseCreditsModal .modal-content>div:nth-child(3)>div:last-child>div button span {
                font-size: 0.7rem !important;
            }

            /* Summary box */
            #purchaseCreditsModal .modal-content>div:nth-child(4) {
                padding: 10px 12px !important;
                margin-bottom: 12px !important;
            }

            #purchaseCreditsModal .modal-content>div:nth-child(4) span:first-child {
                font-size: 0.75rem !important;
            }

            #purchaseCreditsModal #totalAmount {
                font-size: 1rem !important;
            }

            /* Action buttons */
            #purchaseCreditsModal .modal-content>div:last-child {
                gap: 8px !important;
            }

            #purchaseCreditsModal .modal-content>div:last-child button {
                padding: 10px !important;
                font-size: 0.8rem !important;
            }

            /* ========== MOBILE HAMBURGER MENU ========== */
            .mobile-hamburger-btn {
                display: flex !important;
                position: fixed;
                top: 15px;
                left: 15px;
                z-index: 10000;
                width: 40px;
                height: 40px;
                background: rgba(0, 0, 0, 0.8);
                border: 1px solid rgba(255, 255, 255, 0.15);
                border-radius: 10px;
                align-items: center;
                justify-content: center;
                cursor: pointer;
                transition: all 0.2s ease;
                backdrop-filter: blur(10px);
            }

            .mobile-hamburger-btn:active {
                transform: scale(0.95);
                background: rgba(255, 255, 255, 0.1);
            }

            .mobile-hamburger-btn .bar {
                width: 18px;
                height: 2px;
                background: #fff;
                border-radius: 2px;
                position: relative;
                transition: all 0.3s ease;
            }

            .mobile-hamburger-btn .bar::before,
            .mobile-hamburger-btn .bar::after {
                content: '';
                position: absolute;
                width: 18px;
                height: 2px;
                background: #fff;
                border-radius: 2px;
                transition: all 0.3s ease;
            }

            .mobile-hamburger-btn .bar::before {
                top: -6px;
            }

            .mobile-hamburger-btn .bar::after {
                bottom: -6px;
            }

            /* Menu open state - transform to X */
            .mobile-hamburger-btn.open .bar {
                background: transparent;
            }

            .mobile-hamburger-btn.open .bar::before {
                top: 0;
                transform: rotate(45deg);
            }

            .mobile-hamburger-btn.open .bar::after {
                bottom: 0;
                transform: rotate(-45deg);
            }

            /* Slide-in Menu */
            .mobile-slide-menu {
                display: block !important;
                position: fixed;
                top: 0;
                left: -280px;
                width: 260px;
                height: 100%;
                background: linear-gradient(180deg, #0a0a0a 0%, #111 100%);
                z-index: 9999;
                transition: left 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
                padding: 70px 20px 30px 20px;
                box-shadow: 4px 0 20px rgba(0, 0, 0, 0.5);
                border-right: 1px solid rgba(255, 255, 255, 0.1);
                overflow-y: auto;
            }

            .mobile-slide-menu.open {
                left: 0;
            }

            .mobile-slide-menu .menu-header {
                margin-bottom: 25px;
                padding-bottom: 15px;
                border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            }

            .mobile-slide-menu .menu-header h3 {
                color: #e50914;
                font-size: 1.1rem;
                font-weight: 700;
                margin: 0;
            }

            .mobile-slide-menu .menu-item {
                display: flex;
                align-items: center;
                justify-content: space-between;
                padding: 16px 14px;
                margin-bottom: 8px;
                background: rgba(255, 255, 255, 0.03);
                border: 1px solid rgba(255, 255, 255, 0.08);
                border-radius: 10px;
                cursor: pointer;
                transition: all 0.2s ease;
                text-decoration: none;
            }

            .mobile-slide-menu .menu-item:active {
                background: rgba(255, 255, 255, 0.1);
                transform: scale(0.98);
            }

            .mobile-slide-menu .menu-item span {
                color: #fff;
                font-size: 0.9rem;
                font-weight: 500;
            }

            .mobile-slide-menu .menu-item .arrow {
                color: #666;
                font-size: 1rem;
                transition: transform 0.2s ease;
            }

            .mobile-slide-menu .menu-item:active .arrow {
                transform: translateX(3px);
                color: #e50914;
            }

            /* Overlay backdrop */
            .mobile-menu-overlay {
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.6);
                z-index: 9998;
                opacity: 0;
                transition: opacity 0.3s ease;
            }

            .mobile-menu-overlay.open {
                display: block;
                opacity: 1;
            }
        }

        /* Desktop: Ẩn mobile TV form */
        #mobileTvForm {
            display: none;
        }

        /* Desktop: Ẩn hamburger menu */
        .mobile-hamburger-btn,
        .mobile-slide-menu,
        .mobile-menu-overlay {
            display: none;
        }

        @media (max-width: 968px) {
            .main-layout {
                grid-template-columns: 1fr;
            }

            /* Modal responsive for mobile */
            .modal-content {
                width: 95%;
                padding: 20px;
            }

            /* Official Package Modal - Make grid 1 column on mobile */
            #officialPackageModal .modal-content {
                max-width: 95% !important;
                background: #000 !important;
                /* Solid black background on mobile */
                backdrop-filter: none !important;
                /* Remove blur effect */
            }

            #officialPackageModal .modal-content h2 {
                font-size: 1.5rem !important;
                margin-bottom: 15px !important;
            }

            #officialPackageModal .modal-content p {
                font-size: 0.9rem !important;
                margin-bottom: 0 !important;
                padding-bottom: 20px !important;
                border-bottom: 1px solid rgba(255, 255, 255, 0.1) !important;
            }

            /* Change 4 column grid to 1 column on mobile */
            #officialPackageModal div[style*="grid-template-columns: repeat(4, 1fr)"] {
                grid-template-columns: 1fr !important;
                gap: 0 !important;
                /* Remove gap, use separator instead */
            }

            /* Package cards - Remove background and border, add separator on mobile */
            #officialPackageModal div[style*="background: rgba(255, 255, 255, 0.05)"],
            #officialPackageModal div[style*="background: linear-gradient"] {
                background: transparent !important;
                border: none !important;
                border-bottom: 1px solid rgba(255, 255, 255, 0.1) !important;
                padding: 18px 15px 15px 15px !important;
                margin: 0 !important;
                min-height: auto !important;
                /* CRITICAL: Remove min-height: 500px that creates gaps */
            }

            /* Last package card - remove bottom border */
            #officialPackageModal div[style*="grid-template-columns: repeat(4, 1fr)"]>div:last-child {
                border-bottom: none !important;
            }

            /* Package header - Vertical layout on mobile */
            #officialPackageModal div[style*="text-align: center; margin-bottom: 20px"] {
                display: flex !important;
                flex-direction: column !important;
                align-items: flex-start !important;
                text-align: left !important;
                margin-bottom: 8px !important;
            }

            /* Package title - Make all text uppercase and uniform style */
            #officialPackageModal div[style*="font-size: 1.5rem"] {
                font-size: 1.05rem !important;
                margin: 0 !important;
                font-weight: 700 !important;
                text-transform: uppercase !important;
                letter-spacing: 0.5px !important;
            }

            /* Replace package names entirely on mobile */
            #officialPackageModal div[style*="grid-template-columns: repeat(4, 1fr)"]>div:nth-child(1) div[style*="font-size: 1.5rem"] {
                font-size: 0 !important;
            }

            #officialPackageModal div[style*="grid-template-columns: repeat(4, 1fr)"]>div:nth-child(1) div[style*="font-size: 1.5rem"]::after {
                content: "1 THÁNG - LINH HOẠT" !important;
                font-size: 1.05rem !important;
                font-weight: 700 !important;
                color: #fff !important;
            }

            #officialPackageModal div[style*="grid-template-columns: repeat(4, 1fr)"]>div:nth-child(2) div[style*="font-size: 1.5rem"] {
                font-size: 0 !important;
            }

            #officialPackageModal div[style*="grid-template-columns: repeat(4, 1fr)"]>div:nth-child(2) div[style*="font-size: 1.5rem"]::after {
                content: "3 THÁNG - ĐÁNG GIÁ" !important;
                font-size: 1.05rem !important;
                font-weight: 700 !important;
                color: #fff !important;
            }

            #officialPackageModal div[style*="grid-template-columns: repeat(4, 1fr)"]>div:nth-child(3) div[style*="font-size: 1.5rem"] {
                font-size: 0 !important;
            }

            #officialPackageModal div[style*="grid-template-columns: repeat(4, 1fr)"]>div:nth-child(3) div[style*="font-size: 1.5rem"]::after {
                content: "6 THÁNG - CÂN BẰNG" !important;
                font-size: 1.05rem !important;
                font-weight: 700 !important;
                color: #fff !important;
            }

            #officialPackageModal div[style*="grid-template-columns: repeat(4, 1fr)"]>div:nth-child(4) div[style*="font-size: 1.5rem"] {
                font-size: 0 !important;
            }

            #officialPackageModal div[style*="grid-template-columns: repeat(4, 1fr)"]>div:nth-child(4) div[style*="font-size: 1.5rem"]::after {
                content: "12 THÁNG - ỔN ĐỊNH" !important;
                font-size: 1.05rem !important;
                font-weight: 700 !important;
                color: #fff !important;
            }

            /* Hide subtitle text on mobile (Linh hoạt nhất, Đáng giá nhất, etc) */
            #officialPackageModal div[style*="font-size: 0.9rem"][style*="font-weight: 600"],
            #officialPackageModal div[style*="font-size: 0.8rem"][style*="color: #aaa"] {
                display: none !important;
            }

            /* Price container - align left, below title */
            #officialPackageModal div[style*="background: rgba(0, 0, 0, 0.3)"] {
                background: transparent !important;
                padding: 0 !important;
                margin: 5px 0 0 0 !important;
                text-align: left !important;
            }

            /* Strike-through price - smaller */
            #officialPackageModal div[style*="text-decoration: line-through"] {
                font-size: 0.75rem !important;
                margin: 0 !important;
            }

            /* Main price */
            #officialPackageModal div[style*="font-size: 2.4rem"] {
                font-size: 1.5rem !important;
                margin: 0 !important;
                line-height: 1.2 !important;
            }

            /* Price per month - hide or make very small */
            #officialPackageModal div[style*="font-size: 0.85rem"][style*="color: #aaa"] {
                display: none !important;
            }

            /* Hide top badges (PHỔ BIẾN, TIẾT KIỆM, etc) on mobile */
            #officialPackageModal div[style*="position: absolute; top: -12px"] {
                display: none !important;
            }

            /* Hide ALL savings badges - comprehensive selectors */
            #officialPackageModal div[style*="Tiết kiệm"],
            #officialPackageModal div[style*="background"][style*="0.15"],
            #officialPackageModal div[style*="border: 1px solid"][style*="border-radius: 6px"][style*="padding: 12px"] {
                display: none !important;
            }

            /* Package features - reduce spacing and REMOVE flex: 1 */
            #officialPackageModal ul {
                font-size: 0.85rem !important;
                margin-top: 10px !important;
                margin-bottom: 10px !important;
                line-height: 1.6 !important;
                flex: 0 !important;
                /* CRITICAL: Remove flex: 1 that pushes button down */
            }

            /* Buttons - Match mobile warning screen style */
            #officialPackageModal button,
            #paymentModal button {
                background: transparent !important;
                border: 1px solid rgba(255, 255, 255, 0.2) !important;
                color: #fff !important;
                padding: 16px 0 !important;
                border-radius: 6px !important;
                font-weight: 600 !important;
                font-size: 0.95em !important;
                text-align: center !important;
                transition: all 0.3s !important;
                margin-top: 0 !important;
                margin-bottom: 0 !important;
            }

            #officialPackageModal button:hover,
            #paymentModal button:hover {
                background: rgba(255, 255, 255, 0.05) !important;
            }

            /* Mobile: Show button inside package, hide outside button */
            /* MUST use higher specificity to override #officialPackageModal button margin-top: 0 */
            #officialPackageModal .mobile-only-home-btn {
                display: block !important;
                margin-top: 24px !important;
                /* Override margin-top: 0 from #officialPackageModal button */
            }

            .desktop-only-home-btn-container {
                display: none !important;
            }

            /* Payment Modal - Clean up on mobile */
            #paymentModal .modal-content {
                background: #000 !important;
                backdrop-filter: none !important;
            }

            #paymentModal h2 {
                font-size: 1.3rem !important;
                margin-bottom: 20px !important;
            }

            /* Payment Modal - 2 columns to 1 column on mobile */
            #paymentModal div[style*="grid-template-columns: 1fr 1fr"] {
                grid-template-columns: 1fr !important;
                gap: 0 !important;
            }

            /* Payment Modal - QR section NO border */
            #paymentModal div[style*="background: rgba(255, 255, 255, 0.05)"] {
                background: transparent !important;
                border-radius: 0 !important;
                padding: 20px 0 !important;
                border: none !important;
            }

            #paymentModal img {
                max-width: 250px !important;
                border: none !important;
                margin-bottom: 15px !important;
            }

            /* H3 "Hướng dẫn thanh toán" - add border below */
            #paymentModal h3 {
                font-size: 1.1rem !important;
                margin-bottom: 0 !important;
                padding-bottom: 15px !important;
                border-bottom: 1px solid rgba(255, 255, 255, 0.1) !important;
            }

            #paymentModal p {
                font-size: 0.9rem !important;
                line-height: 1.6 !important;
            }

            /* Thông tin thanh toán box - no borders, reduce bottom spacing */
            #paymentModal>div>div>div:nth-child(2)>div>div:nth-child(1) {
                background: transparent !important;
                border: none !important;
                padding: 15px 0 8px 0 !important;
                margin: 0 !important;
            }

            /* Reduce margin of last paragraph in payment info to reduce gap before separator */
            #paymentModal>div>div>div:nth-child(2)>div>div:nth-child(1)>div>p:last-child {
                margin-bottom: 0 !important;
            }

            /* Lưu ý quan trọng - Add TOP border */
            #paymentModal div[style*="background: rgba(255, 193, 7, 0.1)"] {
                background: transparent !important;
                border: none !important;
                border-top: 1px solid rgba(255, 255, 255, 0.1) !important;
                border-radius: 0 !important;
                padding: 15px 0 !important;
                margin: 0 !important;
            }

            /* Xác minh thanh toán - add top border */
            #paymentModal div[style*="background: rgba(59, 130, 246, 0.1)"] {
                background: transparent !important;
                border: none !important;
                border-top: 1px solid rgba(255, 255, 255, 0.1) !important;
                border-radius: 0 !important;
                padding: 15px 0 !important;
                margin: 0 !important;
            }
        }

        /* Desktop: Hide mobile button inside package, show outside button */
        @media (min-width: 969px) {
            #officialPackageModal .mobile-only-home-btn {
                display: none !important;
            }

            .desktop-only-home-btn-container {
                display: block !important;
            }
        }

        /* Tablet/Medium screens: 2 columns grid */
        @media (min-width: 969px) and (max-width: 1250px) {
            #officialPackageModal div[style*="grid-template-columns: repeat(4, 1fr)"] {
                grid-template-columns: repeat(2, 1fr) !important;
                gap: 20px !important;
            }

            #officialPackageModal .modal-content {
                max-width: 95% !important;
            }
        }

        h1 {
            font-size: 3rem;
            margin-bottom: 5px;
            background: linear-gradient(90deg, #e50914);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 700;
            letter-spacing: -1px;
        }

        .slogan {
            color: #ffffff;
            font-size: 1rem;
            line-height: 1.5;
            margin-bottom: 15px;
        }

        .section-title {
            font-size: 1.4rem;
            color: #fff;
            margin-bottom: 20px;
            font-weight: 600;
        }

        .divider {
            height: 1px;
            background: rgba(255, 255, 255, 0.1);
            margin: 25px 0;
        }

        /* Extension Status Banner */
        .extension-banner {
            background: rgba(255, 193, 7, 0.15);
            border: 2px solid #ffc107;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
            display: none;
        }

        .extension-banner.show {
            display: block;
        }

        .extension-banner.success {
            background: rgba(40, 167, 69, 0.15);
            border-color: #28a745;
        }

        .extension-banner.error {
            background: rgba(220, 53, 69, 0.15);
            border-color: #dc3545;
        }

        .extension-banner h3 {
            font-size: 1.2rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .extension-banner p {
            font-size: 0.95rem;
            line-height: 1.5;
            opacity: 0.9;
        }

        .extension-banner a {
            color: #fff;
            text-decoration: underline;
            font-weight: 600;
        }

        .extension-id {
            margin-top: 10px;
            padding: 8px 12px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 6px;
            font-size: 0.85rem;
            word-break: break-all;
        }

        /* Options */
        .options {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .option-card {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 25px;
            transition: all 0.3s ease;
        }

        .option-card:hover {
            border-color: #e50914;
            transform: translateY(-2px);
            box-shadow: 0 6px 24px rgba(229, 9, 20, 0.3);
        }

        .option-card h2 {
            font-size: 1.5rem;
            margin-bottom: 10px;
            color: #fff;
        }

        .option-card p {
            margin-bottom: 15px;
            font-size: 0.95rem;
            color: #aaa;
            line-height: 1.5;
        }

        /* Step Flow */
        .step-flow {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 10px;
        }

        .step {
            background: rgba(255, 255, 255, 0.03);
            border-left: 3px solid rgba(229, 9, 20, 0.5);
            padding: 15px;
            border-radius: 8px;
        }

        .step-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 12px;
        }

        .step-number {
            background: #e50914;
            color: #fff;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1rem;
            flex-shrink: 0;
        }

        .step-title {
            font-size: 1.1rem;
            font-weight: 600;
        }

        .step-status {
            margin-top: 10px;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.9rem;
            display: none;
        }

        .step-status.show {
            display: block;
        }

        .step-status.success {
            background: rgba(40, 167, 69, 0.2);
            border: 1px solid rgba(40, 167, 69, 0.5);
            color: #4ade80;
        }

        .step-status.error {
            background: rgba(220, 53, 69, 0.2);
            border: 1px solid rgba(220, 53, 69, 0.5);
            color: #f87171;
        }

        .step-status.warning {
            background: rgba(255, 193, 7, 0.2);
            border: 1px solid rgba(255, 193, 7, 0.5);
            color: #fbbf24;
        }

        /* Buttons */
        .btn {
            display: inline-block;
            width: 100%;
            padding: 14px 28px;
            background: #e50914;
            color: #fff;
            text-decoration: none;
            text-align: center;
            border-radius: 8px;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
        }

        .btn:hover:not(:disabled) {
            background: #f40612;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(229, 9, 20, 0.4);
        }

        .btn:disabled {
            background: #555;
            cursor: not-allowed;
            opacity: 0.6;
            transform: none;
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .btn-secondary:hover:not(:disabled) {
            background: rgba(255, 255, 255, 0.15);
        }

        /* Custom Action Buttons */
        .btn[onclick*="openUpgradeToProModal"]:hover {
            background: rgba(245, 158, 11, 0.2) !important;
            border-color: rgba(245, 158, 11, 0.5) !important;
            box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
        }

        .btn[onclick*="showReportIssueModal"]:hover {
            background: rgba(59, 130, 246, 0.2) !important;
            border-color: rgba(59, 130, 246, 0.5) !important;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }

        .btn[onclick*="handleLogout"]:hover {
            background: rgba(107, 114, 128, 0.2) !important;
            border-color: rgba(107, 114, 128, 0.5) !important;
            box-shadow: 0 4px 12px rgba(107, 114, 128, 0.3);
        }

        .btn[onclick*="facebook.com"]:hover {
            background: rgba(16, 185, 129, 0.2) !important;
            border-color: rgba(16, 185, 129, 0.5) !important;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
        }

        /* Ad Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.98);
            z-index: 10000000;
            justify-content: center;
        }

        .modal.active {
            display: flex;
            overflow-y: auto;
            padding: 20px 0;
            align-items: flex-start;
        }

        .modal-content {
            max-width: 800px;
            width: 90%;
            background: #000;
            border-radius: 12px;
            padding: 30px;
            position: relative;
            margin: auto;
            flex-shrink: 0;
        }

        .video-container {
            position: relative;
            margin-bottom: 20px;
            background: #1a1a1a;
            border-radius: 8px;
            min-height: 400px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .ad-timer {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(0, 0, 0, 0.8);
            padding: 10px 18px;
            border-radius: 6px;
            font-size: 1rem;
            font-weight: 600;
        }

        .modal-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        .modal-actions .btn {
            width: auto;
            min-width: 150px;
        }

        /* Toast Notifications */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #28a745;
            color: #fff;
            padding: 16px 24px;
            border-radius: 8px;
            box-shadow: 0 6px 24px rgba(0, 0, 0, 0.3);
            z-index: 2000;
            animation: slideIn 0.3s ease;
            max-width: 400px;
        }

        .toast.error {
            background: #dc3545;
        }

        .toast.warning {
            background: #ffc107;
            color: #000;
        }

        /* Help Icon - Single icon for card */
        .help-icon {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 18px;
            height: 18px;
            background: rgba(99, 102, 241, 0.15);
            border: 1px solid rgba(99, 102, 241, 0.4);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #818cf8;
            font-size: 11px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }

        .help-icon:hover {
            background: rgba(99, 102, 241, 0.3);
            border-color: rgba(99, 102, 241, 0.7);
            color: #a5b4fc;
            transform: scale(1.1);
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Ad Content Styles */
        .ad-content {
            text-align: center;
            color: #fff;
        }

        .ad-content h2 {
            font-size: 3rem;
            margin-bottom: 20px;
        }

        .ad-content p {
            font-size: 1.5rem;
            margin-bottom: 30px;
        }

        .progress-bar {
            width: 100%;
            max-width: 600px;
            height: 8px;
            background: #333;
            border-radius: 4px;
            overflow: hidden;
            margin: 0 auto;
        }

        .progress-fill {
            height: 100%;
            background: #e50914;
            width: 0%;
            transition: width 0.1s linear;
        }

        /* Team Message Modal Styles (tránh ad blocker) */
        .team-modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 10000;
            align-items: center;
            justify-content: center;
        }

        .team-modal-overlay.active {
            display: flex;
        }

        .team-modal-content {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            border-radius: 16px;
            padding: 40px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .ad-timer {
            font-size: 3rem;
            font-weight: 700;
            color: #60a5fa;
            margin: 20px 0;
            animation: pulse 1s infinite;
        }

        .ad-video-placeholder {
            background: #000;
            border-radius: 8px;
            padding: 60px 20px;
            margin: 20px 0;
            border: 2px dashed rgba(255, 255, 255, 0.3);
        }

        @keyframes pulse {

            0%,
            100% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.05);
            }
        }

        /* Custom Modal Dialog System */
        .custom-modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            z-index: 10001;
            animation: fadeIn 0.2s ease-out;
        }

        .custom-modal-overlay.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .custom-modal-dialog {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            border-radius: 16px;
            padding: 0;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.9);
            border: 1px solid rgba(255, 255, 255, 0.1);
            animation: slideUp 0.3s ease-out;
            overflow: hidden;
        }

        .custom-modal-header {
            padding: 24px 28px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .custom-modal-icon {
            font-size: 28px;
            line-height: 1;
        }

        .custom-modal-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #fff;
            flex: 1;
        }

        .custom-modal-body {
            padding: 28px;
            color: #ddd;
            line-height: 1.6;
            max-height: 60vh;
            overflow-y: auto;
        }

        .custom-modal-body pre {
            background: rgba(0, 0, 0, 0.3);
            padding: 16px;
            border-radius: 8px;
            border-left: 3px solid #60a5fa;
            white-space: pre-wrap;
            word-wrap: break-word;
            font-family: 'Segoe UI', sans-serif;
            font-size: 0.95rem;
            margin: 0;
        }

        .custom-modal-footer {
            padding: 20px 28px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }

        .custom-modal-btn {
            padding: 10px 24px;
            border: none;
            border-radius: 8px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: inherit;
        }

        .custom-modal-btn-primary {
            background: linear-gradient(135deg, #60a5fa, #3b82f6);
            color: white;
        }

        .custom-modal-btn-primary:hover {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
        }

        .custom-modal-btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
        }

        .custom-modal-btn-secondary:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        .custom-modal-btn-danger {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
        }

        .custom-modal-btn-danger:hover {
            background: linear-gradient(135deg, #dc2626, #b91c1c);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.4);
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Referral Notification Modal */
        .referral-notification-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(8px);
            z-index: 10002;
            animation: fadeIn 0.3s ease-out;
        }

        .referral-notification-overlay.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .referral-notification-modal {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            border-radius: 20px;
            padding: 0;
            max-width: 480px;
            width: 90%;
            box-shadow: 0 25px 80px rgba(0, 0, 0, 0.9), 0 0 40px rgba(251, 191, 36, 0.15);
            border: 1px solid rgba(251, 191, 36, 0.3);
            animation: slideUp 0.4s ease-out;
            overflow: hidden;
        }

        .referral-notification-header {
            padding: 28px 28px 20px;
            text-align: center;
            background: linear-gradient(180deg, rgba(251, 191, 36, 0.1) 0%, transparent 100%);
        }

        .referral-notification-icon {
            font-size: 56px;
            line-height: 1;
            margin-bottom: 12px;
            animation: celebrateBounce 0.6s ease-out;
        }

        @keyframes celebrateBounce {
            0% {
                transform: scale(0);
            }

            50% {
                transform: scale(1.2);
            }

            70% {
                transform: scale(0.9);
            }

            100% {
                transform: scale(1);
            }
        }

        .referral-notification-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #fbbf24;
            margin-bottom: 8px;
        }

        .referral-notification-subtitle {
            font-size: 0.95rem;
            color: rgba(255, 255, 255, 0.7);
        }

        .referral-notification-body {
            padding: 24px 28px;
        }

        .referral-notification-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            border-left: 3px solid #fbbf24;
        }

        .referral-notification-item:last-child {
            margin-bottom: 0;
        }

        .referral-notification-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .referral-notification-email {
            font-size: 0.95rem;
            color: #60a5fa;
            font-weight: 500;
        }

        .referral-notification-credits {
            font-size: 0.9rem;
            color: #4ade80;
            font-weight: 600;
            background: rgba(74, 222, 128, 0.15);
            padding: 4px 10px;
            border-radius: 20px;
        }

        .referral-notification-time {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.5);
        }

        .referral-notification-summary {
            background: linear-gradient(135deg, rgba(251, 191, 36, 0.15) 0%, rgba(251, 191, 36, 0.05) 100%);
            border-radius: 12px;
            padding: 20px;
            margin-top: 16px;
            text-align: center;
            border: 1px solid rgba(251, 191, 36, 0.2);
        }

        .referral-notification-total {
            font-size: 2rem;
            font-weight: 700;
            color: #fbbf24;
            margin-bottom: 4px;
        }

        .referral-notification-total-label {
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.6);
        }

        .referral-notification-remaining {
            margin-top: 12px;
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.7);
        }

        .referral-notification-remaining strong {
            color: #60a5fa;
        }

        .referral-notification-cta {
            margin-top: 16px;
            padding: 12px;
            background: rgba(96, 165, 250, 0.1);
            border-radius: 8px;
            font-size: 0.9rem;
            color: #60a5fa;
            text-align: center;
        }

        .referral-notification-footer {
            padding: 20px 28px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            text-align: center;
        }

        .referral-notification-btn {
            padding: 14px 40px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: inherit;
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            color: #1a1a2e;
        }

        .referral-notification-btn:hover {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(251, 191, 36, 0.4);
        }

        @keyframes spin {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(360deg);
            }
        }

        @keyframes loading {
            0% {
                width: 0%;
            }

            50% {
                width: 70%;
            }

            100% {
                width: 100%;
            }
        }
    </style>
</head>

<body>
    <!-- Mobile Detection Script -->
    <script>
        (function () {
            function isMobileDevice() {
                const userAgent = navigator.userAgent || navigator.vendor || window.opera;
                const mobileRegex = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|Mobile|mobile|CriOS|FxiOS|EdgiOS/i;
                const isIOS = /iPad|iPhone|iPod/.test(userAgent) && !window.MSStream;
                const isAndroid = /Android/.test(userAgent);
                const isTouchDevice = ('ontouchstart' in window) || (navigator.maxTouchPoints > 0);
                const screenWidth = window.innerWidth || screen.width;
                const isSmallScreen = screenWidth <= 768;

                return isIOS || isAndroid || mobileRegex.test(userAgent) || (isTouchDevice && isSmallScreen);
            }

            function isLoggedIn() {
                // Kiểm tra token trong localStorage (key đúng là 'auth_token')
                const token = localStorage.getItem('auth_token');
                return !!token;
            }

            window.__isMobile = isMobileDevice();

            // Hiển thị giao diện mobile
            function applyMobileUI() {
                if (window.__isMobile) {
                    const mobileUI = document.getElementById('mobileMainUI');
                    const mainWrapper = document.querySelector('.main-wrapper');
                    const footer = document.querySelector('footer');

                    if (isLoggedIn()) {
                        // Đã đăng nhập → hiển thị account overview (main-wrapper)
                        if (mobileUI) mobileUI.style.display = 'none';
                        if (mainWrapper) mainWrapper.style.display = 'flex';
                        if (footer) footer.style.display = 'none';
                    } else {
                        // Chưa đăng nhập → hiển thị màn hình chính mobile
                        if (mobileUI) mobileUI.style.display = 'flex';
                        if (mainWrapper) mainWrapper.style.display = 'none';
                        if (footer) footer.style.display = 'none';
                    }
                    document.body.style.overflow = 'auto';
                }
            }

            // Export function để có thể gọi lại sau khi đăng nhập/đăng xuất
            window.applyMobileUI = applyMobileUI;

            applyMobileUI();
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', applyMobileUI);
            }
            window.addEventListener('load', applyMobileUI);
        })();
    </script>

    <!-- Mobile Main UI - Giao diện chính cho điện thoại -->
    <div id="mobileMainUI"
        style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 999999; flex-direction: column; align-items: center; justify-content: center; padding: 40px 30px; overflow-y: auto;">

        <!-- Logo -->
        <div style="text-align: center; margin-bottom: 30px;">
            <h1
                style="font-size: 2.2em; color: #e50914; font-weight: 900; letter-spacing: -1px; margin: 0; text-transform: uppercase;">
                Tiệm Bánh<br>Netflix
            </h1>
            <p
                style="color: #666; font-size: 0.75em; margin: 12px 0 0 0; letter-spacing: 3px; text-transform: uppercase;">
                Share - Support - Enjoy
            </p>
        </div>

        <!-- Main Buttons -->
        <div style="width: 100%; max-width: 280px; display: flex; flex-direction: column; gap: 12px;">
            <button onclick="showMobileOfficialPackage()"
                style="width: 100%; padding: 14px 0; background: rgba(251, 191, 36, 0.1); border: 1px solid #fbbf24; color: #fbbf24; border-radius: 8px; font-size: 0.9em; font-weight: 600; cursor: pointer; transition: all 0.3s; display: flex; align-items: center; justify-content: center; gap: 8px;">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="m2 4 3 12h14l3-12-6 7-4-7-4 7-6-7zm3 16h14" />
                </svg>
                Mua gói chính chủ
            </button>
            <button onclick="window.open('https://youtu.be/vrVgwrjUbpo', '_blank')"
                style="width: 100%; padding: 14px 0; background: transparent; border: 1px solid rgba(255, 255, 255, 0.2); color: #fff; border-radius: 8px; font-size: 0.9em; font-weight: 600; cursor: pointer; transition: all 0.3s; display: flex; align-items: center; justify-content: center; gap: 8px;">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="10" />
                    <polygon points="10 8 16 12 10 16 10 8" />
                </svg>
                Xem video hướng dẫn
            </button>
            <button onclick="window.open('https://www.facebook.com/tiembanh4k/', '_blank')"
                style="width: 100%; padding: 14px 0; background: transparent; border: 1px solid rgba(255, 255, 255, 0.2); color: #fff; border-radius: 8px; font-size: 0.9em; font-weight: 600; cursor: pointer; transition: all 0.3s; display: flex; align-items: center; justify-content: center; gap: 8px;">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="m2 7 4.41-4.41A2 2 0 0 1 7.83 2h8.34a2 2 0 0 1 1.42.59L22 7" />
                    <path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8" />
                    <path d="M15 22v-4a2 2 0 0 0-2-2h-2a2 2 0 0 0-2 2v4" />
                    <path d="M2 7h20" />
                    <path
                        d="M22 7v3a2 2 0 0 1-2 2v0a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 16 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 12 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 8 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 4 12v0a2 2 0 0 1-2-2V7" />
                </svg>
                Ghé qua Tiệm Bánh
            </button>
        </div>

        <!-- Separator -->
        <div style="width: 100%; max-width: 280px; height: 1px; background: rgba(255, 255, 255, 0.1); margin: 25px 0;">
        </div>

        <!-- Login Section -->
        <div style="text-align: center; margin-bottom: 15px;">
            <h3 style="color: #fff; font-size: 1em; font-weight: 600; margin: 0 0 8px 0;">Chưa đăng nhập</h3>
            <p style="color: #888; font-size: 0.75em; margin: 0;">Vui lòng đăng nhập để sử dụng dịch vụ</p>
        </div>

        <!-- Auth Buttons -->
        <div style="width: 100%; max-width: 280px; display: flex; flex-direction: column; gap: 12px;">
            <button onclick="showMobileRegister()"
                style="width: 100%; padding: 14px 0; background: rgba(229, 9, 20, 0.1); border: 1px solid #e50914; color: #e50914; border-radius: 8px; font-size: 0.9em; font-weight: 600; cursor: pointer; transition: all 0.3s; display: flex; align-items: center; justify-content: center; gap: 8px;">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2" />
                    <circle cx="9" cy="7" r="4" />
                    <line x1="19" x2="19" y1="8" y2="14" />
                    <line x1="22" x2="16" y1="11" y2="11" />
                </svg>
                Đăng ký
            </button>
            <button onclick="showMobileLogin()"
                style="width: 100%; padding: 14px 0; background: transparent; border: 1px solid rgba(255, 255, 255, 0.2); color: #fff; border-radius: 8px; font-size: 0.9em; font-weight: 600; cursor: pointer; transition: all 0.3s; display: flex; align-items: center; justify-content: center; gap: 8px;">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4" />
                    <polyline points="10 17 15 12 10 7" />
                    <line x1="15" x2="3" y1="12" y2="12" />
                </svg>
                Đăng nhập
            </button>
        </div>

        <!-- Modal tạm ngưng gói chính chủ -->
        <div id="mobileOfficialModal"
            style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); align-items: center; justify-content: center; z-index: 9999999; padding: 20px; box-sizing: border-box;">
            <div
                style="background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%); border-radius: 12px; padding: 25px 20px; max-width: 300px; width: 100%; text-align: center; box-shadow: 0 20px 60px rgba(0,0,0,0.5); border: 1px solid rgba(255,255,255,0.1);">
                <div style="font-size: 2.2rem; margin-bottom: 12px;">⚠️</div>
                <h2 style="color: #fbbf24; margin: 0 0 10px 0; font-size: 1rem;">Tạm ngưng phát hành</h2>
                <p style="color: #ccc; line-height: 1.5; margin: 0 0 12px 0; font-size: 0.8rem;">
                    Tiệm Bánh đang <strong style="color: #e50914;">tạm ngưng các gói chính chủ</strong> do thay đổi
                    chính sách của Netflix.
                </p>
                <p style="color: #888; line-height: 1.5; margin: 0 0 18px 0; font-size: 0.75rem;">
                    Bọn mình sẽ thông báo khi mở lại. Cảm ơn bạn! 💖
                </p>
                <button onclick="closeMobileOfficialModal()"
                    style="background: #e50914; color: #fff; border: none; padding: 10px 30px; border-radius: 6px; font-size: 0.85rem; font-weight: 600; cursor: pointer;">Đã
                    hiểu</button>
            </div>
        </div>
    </div>

    <script>
        function showMobileRegister() {
            window.location.href = '/auth/?mode=register';
        }
        function showMobileLogin() {
            window.location.href = '/auth/?mode=login';
        }
        function showMobileOfficialPackage() {
            var modal = document.getElementById('mobileOfficialModal');
            if (modal) {
                modal.style.display = 'flex';
            }
        }
        function closeMobileOfficialModal() {
            var modal = document.getElementById('mobileOfficialModal');
            if (modal) {
                modal.style.display = 'none';
            }
        }
        // Click outside to close
        document.getElementById('mobileOfficialModal').onclick = function (e) {
            if (e.target === this) {
                closeMobileOfficialModal();
            }
        };
    </script>

    <!-- OLD Mobile Device Warning - Hidden -->
    <div id="mobileWarning"
        style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 99998; overflow-y: auto;">
        <div
            style="min-height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 60px 30px;">
            <div style="text-align: center; margin-bottom: 80px;">
                <h1
                    style="font-size: 3em; color: #e50914; font-weight: 900; letter-spacing: -2px; margin: 0; text-transform: uppercase;">
                    Tiệm Bánh Netflix
                </h1>
                <p
                    style="color: #666; font-size: 0.85em; margin: 8px 0 0 0; letter-spacing: 3px; text-transform: uppercase;">
                    Share - Support - Enjoy
                </p>
            </div>
            <div style="max-width: 550px; width: 100%;">
                <div
                    style="display: inline-block; background: rgba(229, 9, 20, 0.15); border: 1px solid rgba(229, 9, 20, 0.3); padding: 8px 20px; border-radius: 50px; margin-bottom: 30px;">
                    <span style="color: #e50914; font-size: 0.85em; font-weight: 600; letter-spacing: 1px;">THIẾT BỊ
                        KHÔNG HỖ TRỢ</span>
                </div>

                <!-- Main Message -->
                <h2 style="color: #fff; font-size: 1.3em; font-weight: 600; margin: 0 0 15px 0;">
                    Chỉ hỗ trợ trên PC - Laptop - TV
                </h2>

                <p style="color: #999; font-size: 1em; line-height: 1.7; margin: 0 0 35px 0;">
                    Dịch vụ <span style="color: #e50914; font-weight: 600;">Xem Netflix miễn phí</span> của Tiệm Bánh
                    yêu cầu cài đặt Extension, hiện chỉ khả dụng trên PC - Laptop - TV.
                </p>

                <!-- Primary CTA -->
                <a href="https://youtu.be/vrVgwrjUbpo" target="_blank"
                    style="display: block; background: transparent; border: 1px solid rgba(255, 255, 255, 0.2); color: #fff; padding: 16px 0; border-radius: 6px; text-decoration: none; font-weight: 600; font-size: 0.95em; text-align: center; transition: all 0.3s;">
                    Xem video hướng dẫn
                </a>

                <!-- Separator -->
                <div style="height: 1px; background: rgba(238, 5, 5, 0.158); margin: 30px 0;"></div>

                <!-- Alternative Section -->
                <div style="margin-bottom: 30px;">
                    <h3 style="color: #fff; font-size: 1.3em; font-weight: 600; margin: 0 0 15px 0;">
                        Bạn muốn xem Netflix trên điện thoại hả?
                    </h3>
                    <p style="color: #888; font-size: 0.95em; line-height: 1.6; margin: 0 0 25px 0;">
                        Liên hệ bọn mình để mua gói chính chủ với đầy đủ tính năng nha!
                    </p>
                    <button type="button" id="buyOfficialBtn"
                        style="display: block; width: 100%; background: transparent; border: 1px solid rgba(255, 255, 255, 0.2); color: #fff; padding: 16px 0; border-radius: 6px; font-weight: 600; font-size: 0.95em; text-align: center; transition: all 0.3s; cursor: pointer;">
                        Mua Netflix chính chủ
                    </button>

                    <!-- Modal tạm ngưng cho mobile -->
                    <div id="suspendedModalMobile"
                        style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); align-items: center; justify-content: center; z-index: 99999; padding: 20px; box-sizing: border-box;">
                        <div
                            style="background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%); border-radius: 12px; padding: 25px 20px; max-width: 320px; width: 100%; text-align: center; box-shadow: 0 20px 60px rgba(0,0,0,0.5); border: 1px solid rgba(255,255,255,0.1);">
                            <div style="font-size: 2.5rem; margin-bottom: 12px;">⚠️</div>
                            <h2 style="color: #fbbf24; margin: 0 0 10px 0; font-size: 1.1rem;">Tạm ngưng phát hành</h2>
                            <p style="color: #ccc; line-height: 1.5; margin: 0 0 12px 0; font-size: 0.85rem;">
                                Tiệm Bánh đang <strong style="color: #e50914;">tạm ngưng các gói chính chủ</strong> do
                                thay đổi chính sách của Netflix.
                            </p>
                            <p style="color: #888; line-height: 1.5; margin: 0 0 18px 0; font-size: 0.8rem;">
                                Bọn mình sẽ thông báo khi mở lại. Cảm ơn bạn! 💖
                            </p>
                            <button id="closeSuspendedModalMobile"
                                style="background: #e50914; color: #fff; border: none; padding: 10px 30px; border-radius: 6px; font-size: 0.9rem; font-weight: 600; cursor: pointer;">Đã
                                hiểu</button>
                        </div>
                    </div>

                    <script>
                        (function () {
                            var btn = document.getElementById('buyOfficialBtn');
                            var modal = document.getElementById('suspendedModalMobile');
                            var closeBtn = document.getElementById('closeSuspendedModalMobile');

                            btn.onclick = function () {
                                modal.style.display = 'flex';
                                document.body.style.overflow = 'hidden';
                            };

                            closeBtn.onclick = function () {
                                modal.style.display = 'none';
                                document.body.style.overflow = '';
                            };

                            modal.onclick = function (e) {
                                if (e.target === modal) {
                                    modal.style.display = 'none';
                                    document.body.style.overflow = '';
                                }
                            };
                        })();
                    </script>
                </div>

                <!-- Separator -->
                <div style="height: 1px; background: rgba(238, 5, 5, 0.158); margin: 30px 0;"></div>

                <!-- Support Section -->
                <div>
                    <h3 style="color: #fff; font-size: 1.3em; font-weight: 600; margin: 0 0 15px 0;">
                        Bạn có thắc mắc nào hông nè?
                    </h3>
                    <p style="color: #888; font-size: 0.95em; line-height: 1.6; margin: 0 0 25px 0;">
                        Nhân sự Tiệm Bánh luôn sẵn sàng hỗ trợ bạn.
                    </p>
                    <a href="contact/" target="_blank"
                        style="display: block; background: transparent; border: 1px solid rgba(255, 255, 255, 0.2); color: #fff; padding: 16px 0; border-radius: 6px; text-decoration: none; font-weight: 600; font-size: 0.95em; text-align: center; transition: all 0.3s;">
                        Ghé qua Tiệm Bánh
                    </a>
                </div>

            </div>

            <!-- Footer -->
            <div style="margin-top: 50px; text-align: center;">
                <p style="color: #444; font-size: 0.85em; margin: 0;">
                    © 2025 Tiệm Bánh Netflix
                </p>
            </div>

        </div>
    </div>

    <!-- Smart Loading Indicator -->
    <div id="smartLoadingOverlay"
        style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.85); backdrop-filter: blur(8px); display: none; align-items: center; justify-content: center; z-index: 99999;">
        <div style="text-align: center;">
            <div
                style="width: 50px; height: 50px; border: 4px solid rgba(229, 9, 20, 0.2); border-top-color: #e50914; border-radius: 50%; animation: spin 0.8s linear infinite; margin: 0 auto 15px;">
            </div>
            <div id="smartLoadingText" style="color: #fff; font-size: 1rem; font-weight: 500;">Đang xử lý...</div>
        </div>
    </div>
    <style>
        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
    </style>

    <div class="main-wrapper">
        <!-- Mobile Hamburger Menu (chỉ hiển thị trên mobile sau khi đăng nhập) -->
        <div class="mobile-hamburger-btn" id="mobileHamburgerBtn" onclick="toggleMobileMenu()">
            <span class="bar"></span>
        </div>

        <!-- Mobile Slide-in Menu -->
        <div class="mobile-slide-menu" id="mobileSlideMenu">
            <div class="menu-header">
                <h3>Tiệm Bánh Netflix</h3>
            </div>

            <a class="menu-item" href="javascript:void(0)" onclick="closeMobileMenu(); showOfficialPackageModal();">
                <div style="display: flex; align-items: center;">
                    <div
                        style="width: 28px; display: flex; justify-content: center; flex-shrink: 0; margin-right: 10px;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                            stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect width="20" height="14" x="2" y="5" rx="2" />
                            <line x1="2" x2="22" y1="10" y2="10" />
                        </svg>
                    </div>
                    <span>Mua gói chính chủ</span>
                </div>
                <span class="arrow">›</span>
            </a>

            <a class="menu-item" href="https://youtu.be/vrVgwrjUbpo" target="_blank" onclick="closeMobileMenu();">
                <div style="display: flex; align-items: center;">
                    <div
                        style="width: 28px; display: flex; justify-content: center; flex-shrink: 0; margin-right: 10px;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                            stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polygon points="6 3 20 12 6 21 6 3" />
                        </svg>
                    </div>
                    <span>Video hướng dẫn</span>
                </div>
                <span class="arrow">›</span>
            </a>

            <a class="menu-item" href="/shop/" onclick="closeMobileMenu();">
                <div style="display: flex; align-items: center;">
                    <div
                        style="width: 28px; display: flex; justify-content: center; flex-shrink: 0; margin-right: 10px;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                            stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="m2 7 4.41-4.41A2 2 0 0 1 7.83 2h8.34a2 2 0 0 1 1.42.59L22 7" />
                            <path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8" />
                            <path d="M15 22v-4a2 2 0 0 0-2-2h-2a2 2 0 0 0-2 2v4" />
                            <path d="M2 7h20" />
                            <path
                                d="M22 7v3a2 2 0 0 1-2 2a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 16 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 12 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 8 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 4 12a2 2 0 0 1-2-2V7" />
                        </svg>
                    </div>
                    <span>Quầy lưu niệm</span>
                </div>
                <span class="arrow">›</span>
            </a>
        </div>

        <!-- Mobile Menu Overlay -->
        <div class="mobile-menu-overlay" id="mobileMenuOverlay" onclick="closeMobileMenu()"></div>
        <div class="main-content">
            <div class="container">
                <!-- HEADER -->
                <div class="header">
                    <h1>TIỆM BÁNH NETFLIX</h1>
                    <p class="slogan">Share • Support • Enjoy</p>
                </div>

                <div class="main-layout">
                    <!-- LEFT AREA: Features -->
                    <div class="features-area">
                        <h2 class="section-title">Chọn phương thức xem Netflix</h2>

                        <div class="options">
                            <!-- Option 1: Buy Official -->
                            <div class="option-card">
                                <h2>Mua gói chính chủ</h2>
                                <p>Đăng ký tài khoản Netflix chính chủ với đầy đủ tính năng và nhiều profile.</p>
                                <button class="btn" onclick="showOfficialPackageModal()">Chọn gói dịch vụ</button>
                            </div>

                            <!-- Option 2: Watch as Guest -->
                            <div class="option-card" id="guestSection">
                                <h2>Xem với tư cách khách</h2>
                                <p style="font-size: 0.85rem; color: #aaa; margin-bottom: 20px;">
                                    <strong>Lưu ý:</strong> Chỉ hỗ trợ trên PC và TV, không khả dụng cho điện thoại. Để
                                    trải nghiệm đầy đủ tính năng, vui lòng chọn "Mua gói chính chủ".
                                </p>

                                <!-- Login Required Notice -->
                                <div id="loginRequired"
                                    style="display: none; background: rgba(255, 193, 7, 0.2); border: 1px solid rgba(255, 193, 7, 0.5); padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                                    <p style="margin: 0; color: #fbbf24; font-size: 0.95rem;">
                                        Vui lòng <a href="/auth/"
                                            style="color: #fff; text-decoration: underline; font-weight: 600;">đăng
                                            nhập</a> để sử dụng tính năng này!
                                    </p>
                                </div>

                                <!-- 2-COLUMN LAYOUT -->
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">

                                    <!-- CỘT A: XEM TRÊN PC -->
                                    <div
                                        style="background: rgba(0, 123, 255, 0.1); border: 1px solid rgba(0, 123, 255, 0.3); border-radius: 12px; padding: 20px;">
                                        <h3 style="font-size: 1.2rem; margin-bottom: 10px; color: #60a5fa;">Xem trên PC
                                        </h3>
                                        <p style="margin-bottom: 8px; font-size: 0.85rem; color: #ddd;">
                                            Thuê phiên xem tạm thời bằng cách xem quảng cáo ngắn (Free plan).
                                        </p>
                                        <p style="margin-bottom: 15px; font-size: 0.85rem; color: #ddd;">
                                            Hoặc nâng cấp lên Pro plan để xem không quảng cáo.
                                        </p>

                                        <div style="display: flex; flex-direction: column; gap: 10px;">
                                            <button class="btn" id="openNetflixBtn"
                                                style="font-size: 0.85rem; padding: 8px 16px;">
                                                Bước 1: Mở Netflix.com
                                            </button>
                                            <button class="btn" id="watchAsGuestBtn"
                                                style="font-size: 0.85rem; padding: 8px 16px;">
                                                Bước 2: Watch as Guest
                                            </button>
                                            <button
                                                onclick="window.open('https://www.facebook.com/tiembanh4k/', '_blank')"
                                                class="btn" style="font-size: 0.85rem; padding: 8px 16px;">
                                                Contact Support
                                            </button>
                                        </div>
                                    </div>

                                    <!-- CỘT B: KÍCH HOẠT TV -->
                                    <div
                                        style="background: rgba(139, 92, 246, 0.1); border: 1px solid rgba(139, 92, 246, 0.3); border-radius: 12px; padding: 20px;">
                                        <h3 style="font-size: 1.2rem; margin-bottom: 15px; color: #a78bfa;">Kích hoạt TV
                                        </h3>

                                        <!-- FORM NHẬP MÃ TV TRỰC TIẾP -->
                                        <div id="tvActivationForm" style="margin-bottom: 15px;">
                                            <p
                                                style="margin: 0 0 10px 0; font-size: 0.85rem; color: #ddd; line-height: 1.5;">
                                                Bật TV → Mở Netflix → Nhập mã 8 số hiển thị trên TV:
                                            </p>

                                            <!-- Input mã TV -->
                                            <div style="display: flex; gap: 8px; margin-bottom: 10px;">
                                                <input type="text" id="tvCodeInput" placeholder="Nhập mã 8 số"
                                                    maxlength="9" pattern="[0-9]*" inputmode="numeric"
                                                    style="flex: 1; padding: 10px 12px; border: 1px solid rgba(167, 139, 250, 0.4); border-radius: 6px; background: rgba(0,0,0,0.3); color: #fff; font-size: 0.9rem; font-weight: 600; letter-spacing: 2px; text-align: center; outline: none; transition: border-color 0.2s; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;"
                                                    onfocus="this.style.borderColor='#a78bfa'"
                                                    onblur="this.style.borderColor='rgba(167, 139, 250, 0.4)'"
                                                    oninput="this.value = this.value.replace(/[^0-9]/g, '').slice(0, 8)" />
                                            </div>

                                            <!-- Nút kích hoạt -->
                                            <button id="tvActivateBtn" onclick="handleTvActivation()"
                                                style="width: 100%; padding: 10px 16px; background: linear-gradient(135deg, #8b5cf6, #7c3aed); color: white; border: none; border-radius: 6px; font-size: 0.9rem; font-weight: 600; cursor: pointer; transition: all 0.2s ease; display: flex; align-items: center; justify-content: center; gap: 8px;"
                                                onmouseover="this.style.transform='translateY(-1px)'; this.style.boxShadow='0 4px 12px rgba(139, 92, 246, 0.4)'"
                                                onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                                                <span id="tvActivateBtnText">Kích hoạt TV</span>
                                            </button>

                                            <!-- Status message -->
                                            <div id="tvActivationStatus"
                                                style="margin-top: 10px; padding: 8px 12px; border-radius: 6px; font-size: 0.8rem; display: none;">
                                            </div>
                                        </div>

                                        <!-- Hướng dẫn thủ công (hiển thị mặc định) -->
                                        <div
                                            style="padding: 12px; border-left: 2px solid rgba(167, 139, 250, 0.3); background: rgba(167, 139, 250, 0.05); border-radius: 6px; margin-bottom: 12px;">
                                            <p
                                                style="margin: 0 0 10px 0; font-size: 0.8rem; color: #a78bfa; font-weight: 600;">
                                                Hướng dẫn kích hoạt thủ công (dùng PC)</p>
                                            <div
                                                style="display: flex; align-items: flex-start; gap: 8px; margin-bottom: 8px;">
                                                <span
                                                    style="background: #a78bfa; color: #000; min-width: 18px; height: 18px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 0.7rem;">1</span>
                                                <p style="margin: 0; font-size: 0.8rem; color: #bbb;">Trên PC: Bấm
                                                    <strong>"Watch as Guest"</strong>
                                                </p>
                                            </div>
                                            <div
                                                style="display: flex; align-items: flex-start; gap: 8px; margin-bottom: 8px;">
                                                <span
                                                    style="background: #a78bfa; color: #000; min-width: 18px; height: 18px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 0.7rem;">2</span>
                                                <p style="margin: 0; font-size: 0.8rem; color: #bbb;">Truy cập
                                                    <code
                                                        style="background: rgba(255,255,255,0.1); padding: 1px 4px; border-radius: 3px; font-size: 0.75rem;">netflix.com/tv2</code>
                                                </p>
                                            </div>
                                            <div style="display: flex; align-items: flex-start; gap: 8px;">
                                                <span
                                                    style="background: #a78bfa; color: #000; min-width: 18px; height: 18px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 0.7rem;">3</span>
                                                <p style="margin: 0; font-size: 0.8rem; color: #bbb;">Nhập mã TV →
                                                    Nhấn Enter</p>
                                            </div>
                                        </div>

                                        <!-- Video Tutorial Button -->
                                        <button onclick="window.open('https://youtu.be/ZCgK92o_EyY', '_blank')"
                                            style="background: linear-gradient(135deg, #ff0000, #cc0000); color: white; border: none; padding: 8px 16px; border-radius: 6px; font-size: 0.8rem; font-weight: 600; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; transition: all 0.2s ease; width: 100%;">
                                            <span>Xem video hướng dẫn</span>
                                        </button>
                                    </div>

                                </div>

                                <!-- STATUS SECTION - Trạng thái xử lý -->
                                <div
                                    style="margin-top: 20px; padding: 12px 15px; background: rgba(0, 0, 0, 0.4); border: 1px solid rgba(96, 165, 250, 0.3); border-radius: 8px;">
                                    <div style="display: flex; align-items: center;">
                                        <span
                                            style="font-size: 0.9rem; color: #facc00; font-weight: 600; margin-right: 6px; line-height: 1;">Trạng
                                            thái:</span>
                                        <span id="statusMessage"
                                            style="color: #4ade80; font-size: 0.9rem; line-height: 1;">Sẵn sàng để
                                            Netflix and Chill - Let's go!!!</span>
                                    </div>
                                </div>

                                <!-- Responsive: Stack on mobile -->
                                <style>
                                    @media (max-width: 968px) {
                                        .option-card>div[style*="grid-template-columns"] {
                                            grid-template-columns: 1fr !important;
                                        }
                                    }
                                </style>
                            </div>
                        </div>

                        <!-- Quầy Lưu Niệm Banner -->
                        <a href="/shop/" style="text-decoration: none; display: block; margin-top: 25px;">
                            <div style="background: linear-gradient(135deg, rgba(229, 9, 20, 0.15) 0%, rgba(251, 191, 36, 0.1) 100%); border: 2px solid rgba(229, 9, 20, 0.4); border-radius: 12px; padding: 22px 25px; display: flex; align-items: center; gap: 15px; transition: all 0.3s ease;"
                                onmouseover="this.style.borderColor='rgba(229, 9, 20, 0.7)'; this.style.background='linear-gradient(135deg, rgba(229, 9, 20, 0.22) 0%, rgba(251, 191, 36, 0.15) 100%)'; this.style.transform='translateY(-2px)';"
                                onmouseout="this.style.borderColor='rgba(229, 9, 20, 0.4)'; this.style.background='linear-gradient(135deg, rgba(229, 9, 20, 0.15) 0%, rgba(251, 191, 36, 0.1) 100%)'; this.style.transform='translateY(0)';">
                                <div style="flex: 1;">
                                    <h4
                                        style="color: #fbbf24; font-size: 1.15rem; margin-bottom: 6px; font-weight: 700;">
                                        QUẦY LƯU NIỆM – TIỆM BÁNH NETFLIX</h4>
                                    <p style="color: #ccc; font-size: 0.9rem; line-height: 1.4; margin: 0;">Ủng hộ Tiệm
                                        Bánh với những sản phẩm giá tốt, chất lượng cao nhé!</p>
                                </div>
                                <div style="color: #e50914; font-size: 1.5rem; font-weight: bold;">→</div>
                            </div>
                        </a>
                    </div>

                    <!-- RIGHT SIDEBAR: User Info & Extension Status -->
                    <div class="sidebar">
                        <h3 class="section-title" style="font-size: 1.2rem;">Account Overview</h3>

                        <!-- User Profile / Login Button -->
                        <div id="userProfileSection">
                            <!-- Login Button (when not logged in) -->
                            <div id="loginSection" style="display: none;">
                                <div style="text-align: center; padding: 30px 0;">
                                    <div style="font-size: 4rem; margin-bottom: 15px;"></div>
                                    <h3 style="font-size: 1.2rem; margin-bottom: 10px; color: #fff;">Chưa đăng nhập</h3>
                                    <p style="color: #aaa; font-size: 0.9rem; margin-bottom: 20px;">
                                        Vui lòng đăng nhập để sử dụng dịch vụ
                                    </p>
                                    <a href="/auth/" class="btn" style="display: block; text-align: center;">
                                        Đăng nhập / Đăng ký
                                    </a>
                                </div>
                            </div>

                            <!-- User Profile Card (when logged in) -->
                            <div id="userProfileCard" style="display: none;">
                                <div style="text-align: center; margin-bottom: 20px;">
                                    <div
                                        style="width: 80px; height: 80px; border-radius: 50%; background: linear-gradient(135deg, #6341fa, #a177ee); display: flex; align-items: center; justify-content: center; font-size: 2.5rem; margin: 0 auto 15px;">
                                        <span id="userAvatar"><img src="../favicon.svg" alt="Avatar" width="40"
                                                height="40" style="display: block;"></span>
                                    </div>
                                    <h3 id="userDisplayName"
                                        style="font-size: 1.4rem; margin-bottom: 5px; color: #fff; font-weight: 600;">
                                        User Name</h3>
                                    <div
                                        style="display: flex; align-items: center; justify-content: center; gap: 8px; margin-bottom: 20px;">
                                        <p id="userEmail" style="font-size: 0.95rem; color: #aaa; margin: 0;">
                                            email@example.com</p>
                                        <span id="verifiedBadge"
                                            style="display: none; background: rgba(34, 197, 94, 0.15); color: #22c55e; padding: 3px 10px; border-radius: 6px; font-size: 0.75rem; font-weight: 600; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif; border: 1px solid rgba(34, 197, 94, 0.3);">Verified</span>
                                    </div>
                                </div>

                                <div id="userInfoCard"
                                    style="background: rgba(99, 102, 241, 0.08); border: 1px solid rgba(99, 102, 241, 0.25); padding: 15px; border-radius: 10px; margin-bottom: 15px; position: relative;">
                                    <!-- Help Icon -->
                                    <span class="help-icon" onclick="showAccountHelpModal()"
                                        title="Xem giải thích">?</span>

                                    <div style="text-align: center; margin-bottom: 12px;">
                                        <span id="userType"
                                            style="color: #4649f7; font-weight: 650; font-size: 1.2rem;">FREE
                                            PLAN</span>
                                    </div>
                                    <div id="proExpiresContainer"
                                        style="display: none; border-top: 1px solid rgba(99, 102, 241, 0.25); padding-top: 12px; margin-top: 12px;">
                                        <div
                                            style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                            <span style="color: #fff; font-weight: 500; font-size: 0.9rem;">Active
                                                from:</span>
                                            <span id="proUpgradedDate"
                                                style="color: #22c55e; font-size: 0.9rem; font-weight: 600;">-</span>
                                        </div>
                                        <div
                                            style="display: flex; justify-content: space-between; align-items: center;">
                                            <span style="color: #fff; font-weight: 500; font-size: 0.9rem;">Expires
                                                on:</span>
                                            <span id="proExpiresDate"
                                                style="color: #22c55e; font-size: 0.9rem; font-weight: 600;">-</span>
                                        </div>
                                    </div>
                                    <div id="netflixInfoBorder"
                                        style="border-top: 1px solid rgba(99, 102, 241, 0.25); padding-top: 12px; margin-top: 12px;">
                                        <div
                                            style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                            <span
                                                style="color: #fff; font-weight: 500; font-size: 0.9rem;">Credits:</span>
                                            <span id="userCredits"
                                                style="color: #22c55e; font-size: 0.9rem; font-weight: 600;">5</span>
                                        </div>
                                        <!-- Hiển thị số ngày còn lại cho Free credits (chỉ hiện khi plan = free và credits > 0) -->
                                        <div id="creditsExpiresRow"
                                            style="display: none; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                            <span
                                                style="color: #fff; font-weight: 500; font-size: 0.9rem;">Expires:</span>
                                            <span id="creditsExpires"
                                                style="color: #22c55e; font-size: 0.9rem; font-weight: 600;">7 days
                                                left</span>
                                        </div>
                                        <!-- Assigned Account (PC) - ẩn trên mobile -->
                                        <div id="pcAccountRow"
                                            style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                            <span style="color: #fff; font-weight: 500; font-size: 0.9rem;">Assigned
                                                Account:</span>
                                            <span id="assignedCookie"
                                                style="color: #22c55e; font-size: 0.9rem; font-weight: 600;">-</span>
                                        </div>
                                        <!-- TV Account - chỉ hiện trên mobile, thay thế Assigned Account -->
                                        <div id="tvAccountRow"
                                            style="display: none; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                            <span style="color: #fff; font-weight: 500; font-size: 0.9rem;">Assigned
                                                Account:</span>
                                            <span id="assignedTvCookie"
                                                style="color: #8b5cf6; font-size: 0.9rem; font-weight: 600;">-</span>
                                        </div>
                                        <div
                                            style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                            <span style="color: #fff; font-weight: 500; font-size: 0.9rem;">Switches
                                                Left:</span>
                                            <span id="reportLimit"
                                                style="color: #22c55e; font-size: 0.9rem; font-weight: 600;">2/2</span>
                                        </div>
                                        <div
                                            style="display: flex; justify-content: space-between; align-items: center;">
                                            <span style="color: #fff; font-weight: 500; font-size: 0.9rem;">Monthly
                                                Invites:</span>
                                            <span id="referralsRemaining"
                                                style="color: #22c55e; font-size: 0.9rem; font-weight: 600;">2/2</span>
                                        </div>
                                        <!-- Link xem lịch sử giới thiệu -->
                                        <div style="text-align: right; margin-top: 8px;">
                                            <a href="javascript:void(0)" onclick="showReferralHistoryModal()"
                                                style="color: #60a5fa; font-size: 0.8rem; text-decoration: none; display: inline-flex; align-items: center; gap: 4px;">
                                                Xem lịch sử giới thiệu
                                            </a>
                                        </div>
                                    </div>
                                </div>

                                <!-- Mobile TV Activation Form (chỉ hiển thị trên mobile) -->
                                <div id="mobileTvForm">
                                    <div class="tv-title">KÍCH HOẠT NETFLIX TV</div>
                                    <div class="tv-input-row">
                                        <input type="text" id="mobileTvCodeInput" placeholder="Nhập mã 8 số"
                                            maxlength="9" inputmode="numeric">
                                        <button type="button" onclick="handleMobileTvActivation()">Kích hoạt</button>
                                    </div>
                                    <div id="mobileTvStatus" class="tv-status"></div>

                                    <!-- Hướng dẫn dạng Accordion -->
                                    <div
                                        style="margin-top: 16px; padding-top: 16px; border-top: 1px solid rgba(255,255,255,0.08);">

                                        <!-- Accordion 1: Hướng dẫn kích hoạt -->
                                        <div
                                            style="background: rgba(255,255,255,0.03); border-radius: 10px; margin-bottom: 10px; border: 1px solid rgba(255,255,255,0.08); overflow: hidden;">
                                            <div onclick="toggleAccordion('tvGuideAccordion')"
                                                style="padding: 14px 16px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; transition: all 0.2s;">
                                                <span
                                                    style="font-size: 0.75rem; color: #fff; font-weight: 600; letter-spacing: 0.5px;">HƯỚNG
                                                    DẪN KÍCH HOẠT NETFLIX TV</span>
                                                <span id="tvGuideAccordionIcon"
                                                    style="font-size: 0.9rem; color: #60a5fa; transition: transform 0.3s; flex-shrink: 0;">▼</span>
                                            </div>
                                            <div id="tvGuideAccordion"
                                                style="max-height: 0; overflow: hidden; transition: max-height 0.3s ease-out;">
                                                <div
                                                    style="padding: 12px 16px 14px 16px; border-top: 1px solid rgba(255,255,255,0.05);">
                                                    <div style="display: flex; flex-direction: column; gap: 8px;">
                                                        <div style="display: flex; align-items: center; gap: 8px;">
                                                            <span
                                                                style="color: #60a5fa; font-size: 0.8rem; font-weight: 700; flex-shrink: 0;">1.</span>
                                                            <span
                                                                style="font-size: 0.8rem; color: #ddd; line-height: 1.4;">Mở
                                                                Netflix TV</span>
                                                        </div>
                                                        <div style="display: flex; align-items: center; gap: 8px;">
                                                            <span
                                                                style="color: #60a5fa; font-size: 0.8rem; font-weight: 700; flex-shrink: 0;">2.</span>
                                                            <span
                                                                style="font-size: 0.8rem; color: #ddd; line-height: 1.4;">Cách
                                                                đăng nhập "Dùng điện thoại"</span>
                                                        </div>
                                                        <div style="display: flex; align-items: center; gap: 8px;">
                                                            <span
                                                                style="color: #60a5fa; font-size: 0.8rem; font-weight: 700; flex-shrink: 0;">3.</span>
                                                            <span
                                                                style="font-size: 0.8rem; color: #ddd; line-height: 1.4;">Nhập
                                                                mã 8 số vào ô trên</span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Accordion 2: Mẹo đăng xuất, đổi ngôn ngữ -->
                                        <div
                                            style="background: rgba(255,255,255,0.03); border-radius: 10px; border: 1px solid rgba(255,255,255,0.08); overflow: hidden;">
                                            <div onclick="toggleAccordion('tvTipsAccordion')"
                                                style="padding: 14px 16px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; transition: all 0.2s;">
                                                <span
                                                    style="font-size: 0.75rem; color: #fff; font-weight: 600; letter-spacing: 0.5px;">MẸO
                                                    ĐĂNG XUẤT, ĐỔI NGÔN NGỮ</span>
                                                <span id="tvTipsAccordionIcon"
                                                    style="font-size: 0.9rem; color: #60a5fa; transition: transform 0.3s; flex-shrink: 0;">▼</span>
                                            </div>
                                            <div id="tvTipsAccordion"
                                                style="max-height: 0; overflow: hidden; transition: max-height 0.3s ease-out;">
                                                <div
                                                    style="padding: 12px 16px 14px 16px; border-top: 1px solid rgba(255,255,255,0.05);">
                                                    <div style="display: flex; flex-direction: column; gap: 8px;">
                                                        <a href="https://www.youtube.com/watch?v=g4KlYM9-hQo"
                                                            target="_blank"
                                                            style="display: flex; align-items: center; justify-content: space-between; padding: 12px; background: rgba(255,255,255,0.02); border-radius: 8px; text-decoration: none; transition: all 0.2s; border: 1px solid rgba(255,255,255,0.05);"
                                                            onmouseover="this.style.background='rgba(96,165,250,0.1)'; this.style.borderColor='rgba(96,165,250,0.3)'"
                                                            onmouseout="this.style.background='rgba(255,255,255,0.02)'; this.style.borderColor='rgba(255,255,255,0.05)'">
                                                            <span style="font-size: 0.8rem; color: #ddd;">Đăng xuất
                                                                Netflix TV</span>
                                                            <span
                                                                style="font-size: 1.1rem; color: #60a5fa; flex-shrink: 0;">›</span>
                                                        </a>
                                                        <a href="https://www.youtube.com/watch?v=Uj9rojB8lRg"
                                                            target="_blank"
                                                            style="display: flex; align-items: center; justify-content: space-between; padding: 12px; background: rgba(255,255,255,0.02); border-radius: 8px; text-decoration: none; transition: all 0.2s; border: 1px solid rgba(255,255,255,0.05);"
                                                            onmouseover="this.style.background='rgba(96,165,250,0.1)'; this.style.borderColor='rgba(96,165,250,0.3)'"
                                                            onmouseout="this.style.background='rgba(255,255,255,0.02)'; this.style.borderColor='rgba(255,255,255,0.05)'">
                                                            <span style="font-size: 0.8rem; color: #ddd;">Đổi ngôn ngữ
                                                                Netflix TV</span>
                                                            <span
                                                                style="font-size: 1.1rem; color: #60a5fa; flex-shrink: 0;">›</span>
                                                        </a>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                    </div>
                                </div>

                                <button id="purchaseCreditsBtn" onclick="openPurchaseCreditsModal()" class="btn"
                                    style="background: rgba(245, 158, 11, 0.1); color: #fbbf24; margin-bottom: 10px; border: 1px solid rgba(245, 158, 11, 0.3); border-radius: 8px; transition: all 0.3s; display: flex; align-items: center; justify-content: center; gap: 8px;">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round">
                                        <circle cx="8" cy="8" r="6" />
                                        <path d="M18.09 10.37A6 6 0 1 1 10.34 18" />
                                        <path d="M7 6h1v4" />
                                        <path d="m16.71 13.88.7.71-2.82 2.82" />
                                    </svg>
                                    Mua thêm Credits
                                </button>

                                <!-- Nút đổi tài khoản TV - chỉ hiện trên mobile -->
                                <button id="switchTvAccountBtn" onclick="switchMobileTvAccount()" class="btn"
                                    style="display: none; background: rgba(139, 92, 246, 0.1); color: #8b5cf6; margin-bottom: 10px; border: 1px solid rgba(139, 92, 246, 0.3); border-radius: 8px; transition: all 0.3s; align-items: center; justify-content: center; gap: 8px;">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round">
                                        <rect width="20" height="15" x="2" y="7" rx="2" ry="2" />
                                        <polyline points="17 2 12 7 7 2" />
                                    </svg>
                                    Đổi tài khoản Netflix TV
                                </button>

                                <button onclick="showReportIssueModal()" class="btn"
                                    style="background: rgba(59, 130, 246, 0.1); color: #60a5fa; margin-bottom: 10px; border: 1px solid rgba(59, 130, 246, 0.3); border-radius: 8px; transition: all 0.3s; display: flex; align-items: center; justify-content: center; gap: 8px;">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round">
                                        <path
                                            d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z" />
                                        <path d="M12 9v4" />
                                        <path d="M12 17h.01" />
                                    </svg>
                                    Báo hỏng - Đổi tài khoản Netflix
                                </button>

                                <button onclick="window.open('https://www.facebook.com/tiembanh4k/', '_blank')"
                                    class="btn"
                                    style="background: rgba(16, 185, 129, 0.1); color: #34d399; margin-bottom: 10px; border: 1px solid rgba(16, 185, 129, 0.3); border-radius: 8px; transition: all 0.3s; display: flex; align-items: center; justify-content: center; gap: 8px;">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round">
                                        <path
                                            d="M3 11h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-5Zm0 0a9 9 0 1 1 18 0m0 0v5a2 2 0 0 1-2 2h-1a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2h3Z" />
                                    </svg>
                                    Contact Support
                                </button>

                                <button onclick="handleLogout()" class="btn"
                                    style="background: rgba(107, 114, 128, 0.1); color: #9ca3af; border: 1px solid rgba(107, 114, 128, 0.3); border-radius: 8px; transition: all 0.3s; display: flex; align-items: center; justify-content: center; gap: 8px;">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round">
                                        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" />
                                        <polyline points="16 17 21 12 16 7" />
                                        <line x1="21" x2="9" y1="12" y2="12" />
                                    </svg>
                                    Đăng xuất
                                </button>
                            </div>
                        </div>

                        <div class="divider"></div>

                        <!-- Extension Status -->
                        <div>
                            <h3 class="section-title" style="font-size: 1.1rem;">Trạng thái Extension</h3>

                            <div class="extension-banner" id="extensionBanner">
                                <h3 id="bannerTitle" style="font-size: 1rem; margin-bottom: 8px;">Chưa cài Extension
                                </h3>
                                <p id="bannerText" style="font-size: 0.85rem; margin: 0;">
                                    Vui lòng cài đặt Extension Tiệm Bánh Netflix
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- End Main Layout -->
            </div>
            <!-- End Container -->
        </div>
        <!-- End Main Content -->
    </div>
    <!-- End Main Wrapper -->

    <!-- Purchase Credits Modal -->
    <div class="modal" id="purchaseCreditsModal">
        <div class="modal-content"
            style="max-width: 640px; background: linear-gradient(180deg, #1a1a1a 0%, #0f0f0f 100%); border-radius: 16px; border: 1px solid rgba(251, 191, 36, 0.15); box-shadow: 0 25px 80px rgba(0, 0, 0, 0.8); padding: 26px;">

            <!-- Header -->
            <div style="text-align: center; margin-bottom: 16px;">
                <h2
                    style="margin: 0 0 8px 0; font-size: 1.8rem; background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; font-weight: 900; letter-spacing: -1px;">
                    Mua thêm Credits</h2>
                <p style="color: #fbbf24; font-size: 0.88rem; margin: 0 0 10px 0; font-weight: 600;">
                    1 credit = 1 lần đăng nhập thành công Netflix
                </p>
                <div style="height: 1px; background: rgba(251, 191, 36, 0.2); margin: 0 auto; max-width: 420px;"></div>
            </div>

            <!-- Conversion Rate -->
            <div style="text-align: center; margin-bottom: 18px; margin-top: 12px;">
                <p
                    style="color: #a1a1a1; font-size: 0.75rem; margin-bottom: 6px; font-weight: 500; text-transform: uppercase; letter-spacing: 0.5px;">
                    Tỉ lệ quy đổi</p>
                <div
                    style="display: flex; align-items: center; justify-content: center; gap: 10px; margin-bottom: 6px;">
                    <span style="color: #fff; font-size: 1.15rem; font-weight: 800;">500 VNĐ</span>
                    <span style="color: #fbbf24; font-size: 0.95rem; opacity: 0.6;">=</span>
                    <span style="color: #fbbf24; font-size: 1.15rem; font-weight: 800;">1 Credit</span>
                </div>
                <p style="color: #fbbf24; font-size: 0.78rem; margin: 0; font-weight: 600;">
                    Tối thiểu 30.000 VNĐ = 60 credits
                </p>
            </div>

            <!-- 2 Column Layout -->
            <div style="display: grid; grid-template-columns: 1.5fr 1fr; gap: 20px; margin-bottom: 20px;">

                <!-- LEFT: Input & Result -->
                <div>
                    <!-- Input Amount Box -->
                    <div style="background: #0a0a0a; border: 2px solid rgba(255, 255, 255, 0.1); border-radius: 12px; padding: 16px; margin-bottom: 12px; transition: all 0.3s;"
                        id="inputBox">
                        <p style="color: #a1a1a1; font-size: 0.75rem; margin-bottom: 6px; font-weight: 500;">Số tiền nạp
                        </p>
                        <div style="position: relative;">
                            <input type="text" id="purchaseAmount" placeholder="0"
                                style="width: 100%; padding: 2px 0; padding-right: 50px; font-size: 2rem; font-weight: 900; border: none; background: transparent; color: #fff; text-align: left; outline: none; font-family: inherit;"
                                oninput="calculateCredits(this.value)"
                                onfocus="document.getElementById('inputBox').style.borderColor='rgba(251, 191, 36, 0.4)'"
                                onblur="document.getElementById('inputBox').style.borderColor='rgba(255, 255, 255, 0.1)'">
                            <span
                                style="position: absolute; right: 0; bottom: 6px; color: #6b7280; font-size: 1rem; font-weight: 700;">VNĐ</span>
                        </div>
                    </div>

                    <!-- Credits Receive Box - Cố định -->
                    <div
                        style="background: linear-gradient(135deg, #fbbf24, #f59e0b); border-radius: 12px; padding: 16px; box-shadow: 0 6px 24px rgba(251, 191, 36, 0.25);">
                        <p style="color: rgba(0, 0, 0, 0.7); font-size: 0.72rem; margin-bottom: 4px; font-weight: 600;">
                            Bạn nhận được</p>
                        <p style="color: #000; font-size: 2.2rem; font-weight: 900; margin: 0; line-height: 1;"
                            id="creditsAmount">0</p>
                        <p style="color: rgba(0, 0, 0, 0.8); font-size: 0.95rem; margin-top: 2px; font-weight: 700;">
                            Credits</p>
                    </div>
                </div>

                <!-- RIGHT: Quick Select -->
                <div>
                    <p style="color: #a1a1a1; font-size: 0.75rem; margin-bottom: 8px; font-weight: 500;">Chọn nhanh</p>

                    <div style="display: flex; flex-direction: column; gap: 7px;">
                        <button type="button"
                            onclick="document.getElementById('purchaseAmount').value='30.000'; calculateCredits('30.000');"
                            style="padding: 10px 12px; background: rgba(255, 255, 255, 0.04); border: 1.5px solid rgba(255, 255, 255, 0.12); border-radius: 8px; cursor: pointer; transition: all 0.2s;"
                            onmouseover="this.style.background='rgba(251, 191, 36, 0.08)'; this.style.borderColor='rgba(251, 191, 36, 0.3)'"
                            onmouseout="this.style.background='rgba(255, 255, 255, 0.04)'; this.style.borderColor='rgba(255, 255, 255, 0.12)'">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span style="color: #fbbf24; font-size: 0.85rem; font-weight: 700;">60 credits</span>
                                <span style="color: #fff; font-size: 0.85rem; font-weight: 700;">30.000</span>
                            </div>
                        </button>

                        <button type="button"
                            onclick="document.getElementById('purchaseAmount').value='50.000'; calculateCredits('50.000');"
                            style="padding: 10px 12px; background: rgba(255, 255, 255, 0.04); border: 1.5px solid rgba(255, 255, 255, 0.12); border-radius: 8px; cursor: pointer; transition: all 0.2s;"
                            onmouseover="this.style.background='rgba(251, 191, 36, 0.08)'; this.style.borderColor='rgba(251, 191, 36, 0.3)'"
                            onmouseout="this.style.background='rgba(255, 255, 255, 0.04)'; this.style.borderColor='rgba(255, 255, 255, 0.12)'">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span style="color: #fbbf24; font-size: 0.85rem; font-weight: 700;">100 credits</span>
                                <span style="color: #fff; font-size: 0.85rem; font-weight: 700;">50.000</span>
                            </div>
                        </button>

                        <button type="button"
                            onclick="document.getElementById('purchaseAmount').value='100.000'; calculateCredits('100.000');"
                            style="padding: 10px 12px; background: rgba(255, 255, 255, 0.04); border: 1.5px solid rgba(255, 255, 255, 0.12); border-radius: 8px; cursor: pointer; transition: all 0.2s;"
                            onmouseover="this.style.background='rgba(251, 191, 36, 0.08)'; this.style.borderColor='rgba(251, 191, 36, 0.3)'"
                            onmouseout="this.style.background='rgba(255, 255, 255, 0.04)'; this.style.borderColor='rgba(255, 255, 255, 0.12)'">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span style="color: #fbbf24; font-size: 0.85rem; font-weight: 700;">200 credits</span>
                                <span style="color: #fff; font-size: 0.85rem; font-weight: 700;">100.000</span>
                            </div>
                        </button>

                        <button type="button"
                            onclick="document.getElementById('purchaseAmount').value='200.000'; calculateCredits('200.000');"
                            style="padding: 10px 12px; background: rgba(255, 255, 255, 0.04); border: 1.5px solid rgba(255, 255, 255, 0.12); border-radius: 8px; cursor: pointer; transition: all 0.2s;"
                            onmouseover="this.style.background='rgba(251, 191, 36, 0.08)'; this.style.borderColor='rgba(251, 191, 36, 0.3)'"
                            onmouseout="this.style.background='rgba(255, 255, 255, 0.04)'; this.style.borderColor='rgba(255, 255, 255, 0.12)'">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span style="color: #fbbf24; font-size: 0.85rem; font-weight: 700;">400 credits</span>
                                <span style="color: #fff; font-size: 0.85rem; font-weight: 700;">200.000</span>
                            </div>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Summary Box - Luôn hiển thị -->
            <div
                style="background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.08); border-radius: 10px; padding: 12px 16px; margin-bottom: 18px;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <span style="color: #a1a1a1; font-size: 0.9rem; font-weight: 600;">Tổng thanh toán</span>
                    <span style="color: #fbbf24; font-size: 1.4rem; font-weight: 900;" id="totalAmount">0 VNĐ</span>
                </div>
            </div>

            <!-- Action buttons -->
            <div style="display: flex; gap: 10px;">
                <button class="btn" onclick="closePurchaseCreditsModal()"
                    style="flex: 1; padding: 13px; font-size: 0.95rem; border-radius: 11px; background: rgba(255, 255, 255, 0.05); border: 1.5px solid rgba(255, 255, 255, 0.15); color: #fff; font-weight: 600; transition: all 0.2s; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;"
                    onmouseover="this.style.borderColor='rgba(255, 255, 255, 0.3)'; this.style.background='rgba(255, 255, 255, 0.08)'"
                    onmouseout="this.style.borderColor='rgba(255, 255, 255, 0.15)'; this.style.background='rgba(255, 255, 255, 0.05)'">
                    Hủy
                </button>
                <button id="confirmPurchaseBtn" class="btn" onclick="confirmPurchaseCredits()"
                    style="flex: 2.5; padding: 13px; font-size: 0.95rem; font-weight: 700; background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%); border-radius: 11px; box-shadow: 0 6px 20px rgba(251, 191, 36, 0.35); transition: all 0.3s; border: none; color: #000; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;"
                    onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 10px 28px rgba(251, 191, 36, 0.5)'"
                    onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 6px 20px rgba(251, 191, 36, 0.35)'"
                    disabled>
                    Thanh toán
                </button>
            </div>
        </div>
    </div>

    <!-- Plan Selection Modal -->
    <div class="modal" id="planModal">
        <div class="modal-content" style="max-width: 900px;">
            <h2 style="margin-bottom: 25px; text-align: center;">Chọn gói xem phim</h2>

            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px;">
                <!-- Option 1: Free with Ads -->
                <div style="background: rgba(255, 255, 255, 0.05); border: 2px solid rgba(255, 255, 255, 0.2); border-radius: 12px; padding: 25px; cursor: pointer; transition: all 0.3s; display: flex; flex-direction: column; position: relative;"
                    onmouseover="this.style.borderColor='#e50914'"
                    onmouseout="this.style.borderColor='rgba(255,255,255,0.2)'" onclick="selectFreePlan()">
                    <div
                        style="position: absolute; top: -12px; left: 50%; transform: translateX(-50%); background: #4ade80; color: #000; padding: 4px 14px; border-radius: 12px; font-size: 0.75rem; font-weight: 700; white-space: nowrap;">
                        Gói hiện tại</div>
                    <h3 style="font-size: 1.4rem; margin-bottom: 15px;">Free Plan - Xem quảng cáo</h3>

                    <div
                        style="background: rgba(0, 0, 0, 0.3); border-radius: 8px; padding: 15px; margin-bottom: 15px; height: 100px; display: flex; align-items: center; justify-content: center;">
                        <div style="text-align: center;">
                            <span style="font-size: 2.5rem; font-weight: 700; color: #4ade80;">0 VNĐ</span>
                            <span style="font-size: 1rem; color: #aaa;">/tháng</span>
                        </div>
                    </div>

                    <p style="color: #aaa; margin-bottom: 15px; line-height: 1.6; flex: 1;">
                        • 5 credits sử dụng trong 7 ngày đầu đăng ký<br>
                        • 1 credit = 1 lần đăng nhập thành công Netflix<br>
                        • 2 lượt đổi tài khoản Netflix/tháng<br>
                        • Xem quảng cáo ngắn để mở khóa phiên xem
                    </p>
                    <button class="btn" style="width: 100%;">
                        Bắt đầu xem quảng cáo
                    </button>
                </div>

                <!-- Option 2: Pro Plan -->
                <div
                    style="background: linear-gradient(135deg, rgba(229, 9, 20, 0.2), rgba(255, 107, 107, 0.2)); border: 2px solid #e50914; border-radius: 12px; padding: 25px; display: flex; flex-direction: column;">
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
                        <h3 style="font-size: 1.4rem; margin: 0;">Pro Plan - Không quảng cáo</h3>
                        <span
                            style="background: #ffc107; color: #000; padding: 4px 12px; border-radius: 12px; font-size: 0.8rem; font-weight: 700;">HOT</span>
                    </div>

                    <div
                        style="background: rgba(0, 0, 0, 0.3); border-radius: 8px; padding: 15px; margin-bottom: 15px; height: 100px;">
                        <div style="text-align: center; margin-bottom: 2px;">
                            <span style="font-size: 2.5rem; font-weight: 700; color: #ffc107;">30.000 VNĐ</span>
                            <span style="font-size: 1rem; color: #aaa;">/tháng</span>
                        </div>
                        <p style="color: #4ade80; text-align: center; font-size: 0.9rem; margin: 0;">
                            Quá rẻ cho cả một thế giới phim ảnh!
                        </p>
                    </div>

                    <ul style="color: #ddd; line-height: 2; margin-bottom: 20px; margin-left: 20px; flex: 1;">
                        <li>Nhận ngay <strong>60 credits</strong> khi nâng cấp</li>
                        <li>1 credit = 1 lần đăng nhập thành công Netflix</li>
                        <li>Có tới <strong>5 lượt đổi tài khoản Netflix/tháng</strong></li>
                        <li>Xem phim <strong>không quảng cáo</strong></li>
                        <li>Ưu tiên hỗ trợ khi có sự cố</li>
                    </ul>

                    <button onclick="openUpgradeToProFromPlanModal()" class="btn"
                        style="width: 100%; background: #ffc107; color: #000; font-weight: 700;">
                        Nâng cấp Pro Plan - 30.000 VNĐ/tháng
                    </button>
                </div>
            </div>

            <div style="text-align: center; margin-top: 20px;">
                <button class="btn btn-secondary" onclick="closePlanModal()" style="width: auto; padding: 10px 30px;">
                    Đóng
                </button>
            </div>
        </div>
    </div>

    <!-- Official Package Modal -->
    <div class="modal" id="officialPackageModal">
        <div class="modal-content"
            style="max-width: 1200px; background: linear-gradient(135deg, rgba(20, 20, 20, 0.98) 0%, rgba(26, 26, 26, 0.98) 100%), url('Background.webp') center/cover; backdrop-filter: blur(10px);">
            <h2 style="margin-bottom: 10px; text-align: center; font-size: 2rem; color: #e50914;">ĐĂNG KÝ CHÍNH CHỦ</h2>
            <p style="text-align: center; color: #4ade80; margin-bottom: 35px; font-size: 0.9rem; font-weight: 600;">Xem
                đa thiết bị • Giá tiền hợp lý</p>

            <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 25px; margin-bottom: 30px;">
                <!-- 1 Month Plan -->
                <div style="background: rgba(255, 255, 255, 0.05); border: 2px solid rgba(255, 255, 255, 0.2); border-radius: 12px; padding: 30px 25px; cursor: pointer; transition: all 0.3s; position: relative; min-height: 500px; display: flex; flex-direction: column;"
                    onmouseover="this.style.borderColor='#4ade80'; this.style.transform='translateY(-5px)'"
                    onmouseout="this.style.borderColor='rgba(255,255,255,0.2)'; this.style.transform='translateY(0)'">
                    <div style="text-align: center; margin-bottom: 20px;">
                        <div style="font-size: 1.5rem; font-weight: 700; color: #fff; margin-bottom: 8px;">1 Tháng</div>
                        <div style="font-size: 0.9rem; color: #4ade80; font-weight: 600;">Linh hoạt nhất</div>
                        <div style="font-size: 0.8rem; color: #aaa; margin-top: 6px;">Dễ thử – Dễ ghiền</div>
                    </div>

                    <div
                        style="background: rgba(0, 0, 0, 0.3); border-radius: 8px; padding: 20px; margin-bottom: 20px; text-align: center;">
                        <div
                            style="text-decoration: line-through; color: #aaa; font-size: 0.95rem; margin-bottom: 10px;">
                            120.000đ</div>
                        <div
                            style="font-size: 2.4rem; font-weight: 700; color: #4ade80; line-height: 1; margin-bottom: 10px;">
                            90.000đ</div>
                        <div style="font-size: 0.85rem; color: #aaa;">90.000đ/tháng</div>
                    </div>

                    <ul style="color: #ddd; font-size: 0.9rem; line-height: 2; margin: 0 0 20px 20px; flex: 1;">
                        <li>Chất lượng 4K Ultra HD</li>
                        <li>Profile riêng biệt</li>
                        <li>Đặt PIN bảo mật</li>
                        <li>Xem đa thiết bị</li>
                        <li>Hủy bất cứ lúc nào</li>
                    </ul>

                    <div
                        style="background: rgba(74, 222, 128, 0.15); border: 1px solid rgba(74, 222, 128, 0.3); border-radius: 6px; padding: 12px; margin-bottom: 16px; text-align: center;">
                        <span style="color: #4ade80; font-size: 0.95rem; font-weight: 600;">Tiết kiệm 25%</span>
                    </div>

                    <button class="btn"
                        style="width: 100%; background: #4ade80; color: #000; font-weight: 700; font-size: 1rem; padding: 14px;"
                        onclick="event.stopPropagation(); openPaymentModal('premium-1m', '90.000đ')">
                        Mua ngay
                    </button>
                </div>

                <!-- 3 Months Plan - PHỔ BIẾN -->
                <div style="background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(147, 197, 253, 0.2)); border: 2px solid #3b82f6; border-radius: 12px; padding: 30px 25px; cursor: pointer; transition: all 0.3s; position: relative; min-height: 500px; display: flex; flex-direction: column;"
                    onmouseover="this.style.transform='translateY(-5px)'"
                    onmouseout="this.style.transform='translateY(0)'">
                    <div
                        style="position: absolute; top: -12px; left: 50%; transform: translateX(-50%); background: #3b82f6; color: #fff; padding: 6px 18px; border-radius: 12px; font-size: 0.8rem; font-weight: 700; white-space: nowrap; box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);">
                        PHỔ BIẾN</div>

                    <div style="text-align: center; margin-bottom: 20px;">
                        <div style="font-size: 1.5rem; font-weight: 700; color: #fff; margin-bottom: 8px;">3 Tháng</div>
                        <div style="font-size: 0.9rem; color: #3b82f6; font-weight: 600;">Đáng giá nhất</div>
                        <div style="font-size: 0.8rem; color: #aaa; margin-top: 6px;">Tối ưu – Ai cũng chọn</div>
                    </div>

                    <div
                        style="background: rgba(0, 0, 0, 0.3); border-radius: 8px; padding: 20px; margin-bottom: 20px; text-align: center;">
                        <div
                            style="text-decoration: line-through; color: #aaa; font-size: 0.95rem; margin-bottom: 10px;">
                            360.000đ</div>
                        <div
                            style="font-size: 2.4rem; font-weight: 700; color: #3b82f6; line-height: 1; margin-bottom: 10px;">
                            250.000đ</div>
                        <div style="font-size: 0.85rem; color: #aaa;">Chỉ 83.333đ/tháng</div>
                    </div>

                    <ul style="color: #ddd; font-size: 0.9rem; line-height: 2; margin: 0 0 20px 20px; flex: 1;">
                        <li>Chất lượng 4K Ultra HD</li>
                        <li>Profile riêng biệt</li>
                        <li>Đặt PIN bảo mật</li>
                        <li>Xem đa thiết bị</li>
                        <li><strong style="color: #3b82f6;">Tiết kiệm 110k</strong></li>
                    </ul>

                    <div
                        style="background: rgba(59, 130, 246, 0.15); border: 1px solid rgba(59, 130, 246, 0.3); border-radius: 6px; padding: 12px; margin-bottom: 16px; text-align: center;">
                        <span style="color: #3b82f6; font-size: 0.95rem; font-weight: 600;">Tiết kiệm 31%</span>
                    </div>

                    <button class="btn"
                        style="width: 100%; background: #3b82f6; color: #fff; font-weight: 700; font-size: 1rem; padding: 14px;"
                        onclick="event.stopPropagation(); openPaymentModal('premium-3m', '250.000đ')">
                        Mua ngay
                    </button>
                </div>

                <!-- 6 Months Plan - TIẾT KIỆM -->
                <div style="background: linear-gradient(135deg, rgba(168, 85, 247, 0.2), rgba(196, 181, 253, 0.2)); border: 2px solid #a855f7; border-radius: 12px; padding: 30px 25px; cursor: pointer; transition: all 0.3s; position: relative; min-height: 500px; display: flex; flex-direction: column;"
                    onmouseover="this.style.transform='translateY(-5px)'"
                    onmouseout="this.style.transform='translateY(0)'">
                    <div
                        style="position: absolute; top: -12px; left: 50%; transform: translateX(-50%); background: #a855f7; color: #fff; padding: 6px 18px; border-radius: 12px; font-size: 0.8rem; font-weight: 700; white-space: nowrap; box-shadow: 0 4px 12px rgba(168, 85, 247, 0.4);">
                        TIẾT KIỆM</div>

                    <div style="text-align: center; margin-bottom: 20px;">
                        <div style="font-size: 1.5rem; font-weight: 700; color: #fff; margin-bottom: 8px;">6 Tháng</div>
                        <div style="font-size: 0.9rem; color: #a855f7; font-weight: 600;">Cân bằng nhất</div>
                        <div style="font-size: 0.8rem; color: #aaa; margin-top: 6px;">Vừa túi – Vừa thời gian</div>
                    </div>

                    <div
                        style="background: rgba(0, 0, 0, 0.3); border-radius: 8px; padding: 20px; margin-bottom: 20px; text-align: center;">
                        <div
                            style="text-decoration: line-through; color: #aaa; font-size: 0.95rem; margin-bottom: 10px;">
                            720.000đ</div>
                        <div
                            style="font-size: 2.4rem; font-weight: 700; color: #a855f7; line-height: 1; margin-bottom: 10px;">
                            480.000đ</div>
                        <div style="font-size: 0.85rem; color: #aaa;">Chỉ 80.000đ/tháng</div>
                    </div>

                    <ul style="color: #ddd; font-size: 0.9rem; line-height: 2; margin: 0 0 20px 20px; flex: 1;">
                        <li>Chất lượng 4K Ultra HD</li>
                        <li>Profile riêng biệt</li>
                        <li>Đặt PIN bảo mật</li>
                        <li>Xem đa thiết bị</li>
                        <li><strong style="color: #a855f7;">Tiết kiệm 240k</strong></li>
                    </ul>

                    <div
                        style="background: rgba(168, 85, 247, 0.15); border: 1px solid rgba(168, 85, 247, 0.3); border-radius: 6px; padding: 12px; margin-bottom: 16px; text-align: center;">
                        <span style="color: #a855f7; font-size: 0.95rem; font-weight: 600;">Tiết kiệm 33%</span>
                    </div>

                    <button class="btn"
                        style="width: 100%; background: #a855f7; color: #fff; font-weight: 700; font-size: 1rem; padding: 14px;"
                        onclick="event.stopPropagation(); openPaymentModal('premium-6m', '480.000đ')">
                        Mua ngay
                    </button>
                </div>

                <!-- 12 Months Plan - BEST VALUE -->
                <div style="background: linear-gradient(135deg, rgba(234, 179, 8, 0.2), rgba(253, 224, 71, 0.2)); border: 2px solid #eab308; border-radius: 12px; padding: 30px 25px; cursor: pointer; transition: all 0.3s; position: relative; min-height: 500px; display: flex; flex-direction: column;"
                    onmouseover="this.style.transform='translateY(-5px)'"
                    onmouseout="this.style.transform='translateY(0)'">
                    <div
                        style="position: absolute; top: -12px; left: 50%; transform: translateX(-50%); background: linear-gradient(135deg, #eab308, #fbbf24); color: #000; padding: 6px 18px; border-radius: 12px; font-size: 0.8rem; font-weight: 700; white-space: nowrap; box-shadow: 0 4px 12px rgba(234, 179, 8, 0.4);">
                        BEST VALUE</div>

                    <div style="text-align: center; margin-bottom: 20px;">
                        <div style="font-size: 1.5rem; font-weight: 700; color: #fff; margin-bottom: 8px;">12 Tháng
                        </div>
                        <div style="font-size: 0.9rem; color: #fbbf24; font-weight: 600;">Hợp lý nhất</div>
                        <div style="font-size: 0.8rem; color: #aaa; margin-top: 6px;">Ổn định – Tiết kiệm nhất</div>
                    </div>

                    <div
                        style="background: rgba(0, 0, 0, 0.3); border-radius: 8px; padding: 20px; margin-bottom: 20px; text-align: center;">
                        <div
                            style="text-decoration: line-through; color: #aaa; font-size: 0.95rem; margin-bottom: 10px;">
                            1.440.000đ</div>
                        <div
                            style="font-size: 2.4rem; font-weight: 700; color: #eab308; line-height: 1; margin-bottom: 10px;">
                            920.000đ</div>
                        <div style="font-size: 0.85rem; color: #aaa;">Chỉ 76.667đ/tháng</div>
                    </div>

                    <ul style="color: #ddd; font-size: 0.9rem; line-height: 2; margin: 0 0 20px 20px; flex: 1;">
                        <li>Chất lượng 4K Ultra HD</li>
                        <li>Profile riêng biệt</li>
                        <li>Đặt PIN bảo mật</li>
                        <li>Xem đa thiết bị</li>
                        <li><strong style="color: #fbbf24;">Tiết kiệm 520k</strong></li>
                    </ul>

                    <div
                        style="background: rgba(234, 179, 8, 0.15); border: 1px solid rgba(234, 179, 8, 0.3); border-radius: 6px; padding: 12px; margin-bottom: 16px; text-align: center;">
                        <span style="color: #eab308; font-size: 0.95rem; font-weight: 600;">Tiết kiệm 36%</span>
                    </div>

                    <button class="btn"
                        style="width: 100%; background: linear-gradient(135deg, #eab308, #fbbf24); color: #000; font-weight: 700; font-size: 1rem; padding: 14px;"
                        onclick="event.stopPropagation(); openPaymentModal('premium-12m', '920.000đ')">
                        Mua ngay
                    </button>

                    <!-- Mobile-only: Quay về trang chủ button inside package -->
                    <button class="btn btn-secondary mobile-only-home-btn"
                        onclick="closeOfficialPackageModal(); window.location.href='/';"
                        style="width: 100%; padding: 16px 0; margin-top: 20px;">
                        Quay về Trang chủ
                    </button>
                </div>
            </div>

            <!-- Desktop-only: Quay về trang chủ button outside packages -->
            <div style="text-align: center;" class="desktop-only-home-btn-container">
                <button class="btn btn-secondary" onclick="closeOfficialPackageModal(); window.location.href='/';"
                    style="width: 100%; padding: 16px 0;">
                    Quay về Trang chủ
                </button>
            </div>
        </div>
    </div>

    <!-- Report Issue Modal -->
    <div class="modal" id="reportIssueModal">
        <div class="modal-content" style="max-width: 500px;">
            <h2 style="margin-bottom: 20px; text-align: center;">Báo hỏng và đổi tài khoản Netflix</h2>

            <div
                style="background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3); padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                <p style="margin: 0; font-size: 0.9rem; line-height: 1.6;">
                    <strong>Lưu ý quan trọng:</strong><br>
                    • Nếu kiểm tra thấy tài khoản Netflix vẫn còn dùng được, bạn có thể bị hạn chế vì lạm dụng.<br>
                    • Số lần còn lại: <strong id="reportLimitModal">2/2</strong>
                </p>
            </div>

            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 10px; font-weight: 600;">Chọn lý do:</label>
                <select id="reportReason"
                    style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 8px; font-size: 1rem;">
                    <option value="">-- Chọn lý do --</option>
                    <option value="household">Lỗi hộ gia đình (Household)</option>
                    <option value="payment">Lỗi phương thức thanh toán (Payment)</option>
                    <option value="other">Lý do khác</option>
                </select>
            </div>

            <div id="customReasonContainer" style="display: none; margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 10px; font-weight: 600;">Nhập lý do:</label>
                <textarea id="customReason" placeholder="Mô tả chi tiết lý do..."
                    style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 8px; font-size: 1rem; min-height: 80px; font-family: inherit;"></textarea>
            </div>

            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closeReportIssueModal()">Hủy</button>
                <button class="btn btn-danger" onclick="confirmReportIssue()">Report & Chuyển tài khoản</button>
            </div>
        </div>
    </div>

    <!-- Team Message Modal (tránh ad blocker) -->
    <div class="modal" id="teamModal">
        <div class="modal-content">
            <!-- Message Section (Free users) -->
            <div id="messageSection">
                <h2 style="margin-bottom: 20px; text-align: center; color: #fbbf24;">💌 Gửi các thực khách thân yêu của
                    Tiệm Bánh</h2>

                <div
                    style="background: rgba(255, 255, 255, 0.05); border-radius: 12px; padding: 20px; margin-bottom: 20px; border: 1px solid rgba(251, 191, 36, 0.3);">
                    <!-- Lời nhắn cảm động -->
                    <p
                        style="color: #ddd; font-size: 0.9rem; line-height: 1.7; margin-bottom: 18px; text-align: justify;">
                        Để duy trì hoạt động và mang đến trải nghiệm tốt nhất cho mọi người, Ban Quản Lý Tiệm Bánh đã mở
                        thêm <strong style="color: #fbbf24;">Quầy Lưu Niệm</strong> – nơi giới thiệu một số sản phẩm
                        tiếp thị liên kết (affiliate) với giá ưu đãi.
                        Mỗi đơn hàng bạn ủng hộ sẽ giúp chúng mình có thêm nguồn lực để tiếp tục vận hành và phát triển.
                        <strong style="color: #4ade80;">Cảm ơn bạn đã luôn đồng hành cùng Tiệm Bánh!</strong>
                    </p>

                    <!-- 4 Product Cards - Load động từ featured-products.js -->
                    <div id="modalProductsGrid1"
                        style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin-bottom: 15px;">
                        <!-- Sản phẩm sẽ được load bằng JS -->
                    </div>

                    <p style="color: #aaa; font-size: 0.85rem; text-align: center; margin-bottom: 15px;">
                        Còn nhiều sản phẩm khác đang chờ bạn khám phá! <a href="/shop/" target="_blank"
                            style="color: #fbbf24; font-weight: 600;">Ghé qua Quầy lưu niệm →</a>
                    </p>

                    <div
                        style="background: rgba(251, 191, 36, 0.1); border-left: 3px solid #fbbf24; padding: 12px 15px; border-radius: 6px;">
                        <p style="color: #fbbf24; font-weight: 600; margin-bottom: 8px; font-size: 0.95rem;">Kêu gọi hợp
                            tác & tài trợ</p>
                        <p style="color: #ddd; line-height: 1.6; font-size: 0.9rem; margin: 0;">
                            Nếu bạn là <strong style="color: #fbbf24;">doanh nghiệp, cá nhân</strong> muốn quảng bá sản
                            phẩm/dịch vụ đến <strong style="color: #fbbf24;">hàng nghìn người dùng mỗi ngày</strong>,
                            hoặc đơn giản chỉ muốn <strong style="color: #fbbf24;">ủng hộ một chút cà phê</strong> để
                            team có động lực duy trì tiếp,
                            hãy <a href="/contact/" target="_blank"
                                style="color: #60a5fa; font-weight: 700; text-decoration: underline;">liên hệ với chúng
                                mình tại đây</a> nhé!
                            Mọi đóng góp đều được <strong style="color: #fbbf24;">ghi nhận và trân trọng</strong>. ❤️
                        </p>
                    </div>
                </div>

                <div class="modal-actions">
                    <button class="btn btn-secondary" id="cancelBtn">Hủy</button>
                    <button class="btn" id="startWatchingBtn" disabled>Bắt đầu xem sau 30s</button>
                </div>
            </div>

            <!-- Watching Section (Progress for all users) -->
            <div id="watchingSection" style="display: none;">
                <div class="ad-content"
                    style="padding: 30px; background: linear-gradient(135deg, rgba(20, 20, 20, 0.98) 0%, rgba(26, 26, 26, 0.98) 100%); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 16px;">

                    <!-- Progress Text -->
                    <h2 id="watchingProgress"
                        style="font-size: 1.5rem; font-weight: 600; color: #fff; margin-bottom: 20px; text-align: center;">
                        Đang đăng nhập...</h2>

                    <!-- Loading Bar -->
                    <div id="loadingBarContainer"
                        style="width: 100%; height: 3px; background: rgba(255, 255, 255, 0.1); border-radius: 10px; overflow: hidden; margin-bottom: 25px;">
                        <div
                            style="height: 100%; background: linear-gradient(90deg, #e50914, #b20710); width: 0%; animation: loading 2s ease-in-out infinite;">
                        </div>
                    </div>

                    <!-- Warning Text -->
                    <div style="text-align: left; line-height: 1.7; color: #fff; margin-bottom: 25px;">
                        <p style="margin-bottom: 12px; font-size: 0.95rem;">
                            <span style="color: #fbbf24; font-weight: 700;">LƯU Ý QUAN TRỌNG</span>
                        </p>
                        <p style="margin-bottom: 8px; font-size: 0.9rem;">
                            Giữ <span style="color: #60a5fa; font-weight: 600;">tab Tiệm Bánh Netflix</span> này <span
                                style="font-weight: 600;">luôn MỞ</span> khi xem phim
                        </p>
                        <p style="margin-bottom: 8px; font-size: 0.9rem;">
                            <span style="color: #ef4444; font-weight: 600;">KHÔNG</span> được đóng hoặc tắt tab này
                            trong suốt quá trình xem
                        </p>
                        <p style="font-size: 0.9rem; color: #fbbf24; font-weight: 600;">
                            Nếu đóng tab này, bạn sẽ bị đăng xuất khỏi Netflix ngay lập tức
                        </p>
                    </div>

                    <!-- Product Cards -->
                    <div style="border-top: 1px solid rgba(255, 255, 255, 0.1); padding-top: 20px;">
                        <p
                            style="color: #fbbf24; font-size: 0.95rem; margin-bottom: 12px; text-align: center; font-weight: 500;">
                            Trong lúc chờ đợi, khách yêu ghé Quầy Lưu Niệm chơi nhé!</p>
                        <div id="modalProductsGrid2"
                            style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">
                            <!-- Sản phẩm sẽ được load bằng JS -->
                        </div>
                        <p style="color: #aaa; font-size: 0.9rem; text-align: center; margin-top: 12px;">
                            <a href="/shop/" target="_blank" style="color: #fbbf24; font-weight: 600;">Ghé qua Quầy lưu
                                niệm →</a>
                        </p>
                    </div>

                    <!-- Hidden icon for JS update -->
                    <div id="watchingIcon" style="display: none;"></div>
                </div>

                <div class="modal-actions" style="margin-top: 20px;">
                    <button class="btn btn-secondary" onclick="closeTeamModal()">Đóng</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ========================================
        // PRODUCTION SECURITY - CONSOLE PROTECTION
        // ========================================

        (function () {
            // DISABLE CONSOLE VÀ ERROR LOGGING trong production
            const isProduction = window.location.hostname !== 'localhost' &&
                window.location.hostname !== '127.0.0.1';

            if (isProduction) {
                const noop = () => { };

                // Disable tất cả console methods
                const consoleMethods = ['log', 'warn', 'info', 'debug', 'error', 'exception', 'table', 'group', 'groupEnd', 'groupCollapsed', 'trace', 'dir', 'dirxml', 'assert', 'count', 'clear', 'time', 'timeEnd', 'profile', 'profileEnd'];
                consoleMethods.forEach(method => {
                    if (console[method]) {
                        console[method] = noop;
                    }
                });

                // Override toàn bộ console object
                try {
                    Object.defineProperty(window, 'console', {
                        value: {},
                        writable: false,
                        configurable: false
                    });
                    // Fill với noop để không crash
                    consoleMethods.forEach(method => {
                        window.console[method] = noop;
                    });
                } catch (e) {
                    // Nếu không override được, chỉ disable methods
                }

                // Catch tất cả uncaught errors và rejections - KHÔNG hiện trong console
                window.onerror = function (msg, url, line, col, error) {
                    // Suppress tất cả errors
                    return true; // Prevent default error handling
                };

                window.addEventListener('error', function (e) {
                    e.preventDefault();
                    return true;
                }, true);

                // Catch unhandled promise rejections
                window.addEventListener('unhandledrejection', function (e) {
                    e.preventDefault();
                    return true;
                });

                // Suppress network errors logging
                const originalFetch = window.fetch;
                window.fetch = function (...args) {
                    return originalFetch.apply(this, args).catch(err => {
                        // Suppress error, chỉ return rejected promise
                        return Promise.reject(err);
                    });
                };
            }
        })();

        // Disable right-click inspect (optional - có thể bỏ nếu ảnh hưởng UX)
        // document.addEventListener('contextmenu', e => e.preventDefault());

        // Disable DevTools shortcuts
        document.addEventListener('keydown', function (e) {
            // F12
            if (e.key === 'F12') {
                e.preventDefault();
                return false;
            }
            // Ctrl+Shift+I (DevTools)
            if (e.ctrlKey && e.shiftKey && e.key === 'I') {
                e.preventDefault();
                return false;
            }
            // Ctrl+Shift+J (Console)
            if (e.ctrlKey && e.shiftKey && e.key === 'J') {
                e.preventDefault();
                return false;
            }
            // Ctrl+U (View Source)
            if (e.ctrlKey && e.key === 'U') {
                e.preventDefault();
                return false;
            }
        });

        // ========================================
        // MOBILE HAMBURGER MENU
        // ========================================

        function toggleMobileMenu() {
            const btn = document.getElementById('mobileHamburgerBtn');
            const menu = document.getElementById('mobileSlideMenu');
            const overlay = document.getElementById('mobileMenuOverlay');

            if (btn && menu && overlay) {
                const isOpen = menu.classList.contains('open');

                if (isOpen) {
                    closeMobileMenu();
                } else {
                    btn.classList.add('open');
                    menu.classList.add('open');
                    overlay.classList.add('open');
                    document.body.style.overflow = 'hidden';
                }
            }
        }

        function closeMobileMenu() {
            const btn = document.getElementById('mobileHamburgerBtn');
            const menu = document.getElementById('mobileSlideMenu');
            const overlay = document.getElementById('mobileMenuOverlay');

            if (btn) btn.classList.remove('open');
            if (menu) menu.classList.remove('open');
            if (overlay) overlay.classList.remove('open');
            document.body.style.overflow = '';
        }

        // ========================================
        // SMART LOADING INDICATOR WITH PROGRESSIVE MESSAGES
        // ========================================

        let loadingTimeout = null;
        let progressiveMessageTimeouts = [];

        /**
         * Show loading indicator after delay with progressive messages for server load
         * Progressive messages inform users about wait times during high load
         * @param {string} text - Initial loading text
         * @param {number} delayMs - Delay before showing loading (default 500ms)
         */
        function showSmartLoading(text = 'Đang xử lý...', delayMs = 500) {
            // Clear any existing timeouts
            if (loadingTimeout) clearTimeout(loadingTimeout);
            clearProgressiveMessages();

            // Show loading after initial delay
            loadingTimeout = setTimeout(() => {
                const overlay = document.getElementById('smartLoadingOverlay');
                const textEl = document.getElementById('smartLoadingText');
                if (overlay && textEl) {
                    textEl.textContent = text;
                    overlay.style.display = 'flex';

                    // Setup progressive messages for long waits
                    setupProgressiveMessages(textEl);
                }
            }, delayMs);
        }

        /**
         * Setup progressive loading messages that update based on wait time
         * This helps manage user expectations during server overload (e.g., 1000 concurrent users)
         * @param {HTMLElement} textEl - Text element to update
         */
        function setupProgressiveMessages(textEl) {
            if (!textEl) return;

            // Clear previous timeouts
            clearProgressiveMessages();

            // 2 seconds: Gentle reassurance
            progressiveMessageTimeouts.push(setTimeout(() => {
                if (textEl && textEl.parentElement && textEl.parentElement.style.display === 'flex') {
                    textEl.textContent = 'Đang xử lý yêu cầu của bạn, chờ tí nhé...';
                }
            }, 2000));

            // 5 seconds: Inform about server load (Pool = 50 may be busy)
            progressiveMessageTimeouts.push(setTimeout(() => {
                if (textEl && textEl.parentElement && textEl.parentElement.style.display === 'flex') {
                    textEl.textContent = 'Tiệm Bánh nay hơi đông khách, bọn mình đang cố gắng xử lý, sắp đến lượt bạn rồi...';
                }
            }, 5000));

            // 10 seconds: Connection message (likely queued in connection pool)
            progressiveMessageTimeouts.push(setTimeout(() => {
                if (textEl && textEl.parentElement && textEl.parentElement.style.display === 'flex') {
                    textEl.textContent = 'Cảm ơn bạn đã kiên nhẫn, bọn mình đã order cho bạn rồi nè...';
                }
            }, 10000));

            // 15 seconds: Strong reassurance (definitely in queue)
            progressiveMessageTimeouts.push(setTimeout(() => {
                if (textEl && textEl.parentElement && textEl.parentElement.style.display === 'flex') {
                    textEl.textContent = 'Bánh sắp xong rồi nè...';
                }
            }, 15000));
        }

        /**
         * Clear all progressive message timeouts
         */
        function clearProgressiveMessages() {
            progressiveMessageTimeouts.forEach(timeout => clearTimeout(timeout));
            progressiveMessageTimeouts = [];
        }

        /**
         * Hide loading indicator immediately and clear all timers
         */
        function hideSmartLoading() {
            if (loadingTimeout) {
                clearTimeout(loadingTimeout);
                loadingTimeout = null;
            }

            clearProgressiveMessages();

            const overlay = document.getElementById('smartLoadingOverlay');
            if (overlay) overlay.style.display = 'none';
        }

        // ========================================
        // CUSTOM MODAL DIALOG SYSTEM
        // ========================================

        function showCustomModal(options) {
            const {
                icon = 'ℹ️',
                title = 'Thông báo',
                message = '',
                buttons = [{ text: 'OK', type: 'primary', onClick: null }]
            } = options;

            const modalOverlay = document.getElementById('customModalOverlay');
            const modalIcon = document.getElementById('customModalIcon');
            const modalTitle = document.getElementById('customModalTitle');
            const modalBody = document.getElementById('customModalBody');
            const modalFooter = document.getElementById('customModalFooter');

            modalIcon.textContent = icon;
            modalTitle.textContent = title;

            if (message.includes('\n') || message.includes('•')) {
                modalBody.innerHTML = `<pre>${message}</pre>`;
            } else {
                modalBody.innerHTML = message;
            }

            modalFooter.innerHTML = '';
            buttons.forEach(btn => {
                const button = document.createElement('button');
                button.className = `custom-modal-btn custom-modal-btn-${btn.type || 'primary'}`;
                button.textContent = btn.text;
                button.onclick = () => {
                    closeCustomModal();
                    if (btn.onClick) btn.onClick();
                };
                modalFooter.appendChild(button);
            });

            modalOverlay.classList.add('active');

            modalOverlay.onclick = (e) => {
                if (e.target === modalOverlay) {
                    closeCustomModal();
                }
            };

            const escHandler = (e) => {
                if (e.key === 'Escape') {
                    closeCustomModal();
                    document.removeEventListener('keydown', escHandler);
                }
            };
            document.addEventListener('keydown', escHandler);
        }

        function closeCustomModal() {
            const modalOverlay = document.getElementById('customModalOverlay');
            modalOverlay.classList.remove('active');
        }

        function showConfirmCustomModal(options) {
            return new Promise((resolve) => {
                const {
                    icon = '❓',
                    title = 'Xác nhận',
                    message = '',
                    confirmText = 'Đồng ý',
                    cancelText = 'Hủy'
                } = options;

                showCustomModal({
                    icon,
                    title,
                    message,
                    buttons: [
                        {
                            text: cancelText,
                            type: 'secondary',
                            onClick: () => resolve(false)
                        },
                        {
                            text: confirmText,
                            type: 'primary',
                            onClick: () => resolve(true)
                        }
                    ]
                });
            });
        }

        // ========================================
        // LOAD COOKIE INFO
        // ========================================
        async function loadCookieInfo() {
            try {
                const token = localStorage.getItem('auth_token');
                if (!token) return;

                const backendUrl = window.APP_CONFIG ? window.APP_CONFIG.BACKEND_URL : 'https://backend-c0r3-7xpq9zn2025.onrender.com';
                const response = await fetch(`${backendUrl}/api/auth/me`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    const cookieElement = document.getElementById('assignedCookie');
                    const reportLimitElement = document.getElementById('reportLimit');

                    // ✅ CẬP NHẬT LOCALSTORAGE VỚI DỮ LIỆU MỚI TỪ DATABASE
                    if (data.user) {
                        localStorage.setItem('currentUser', JSON.stringify(data.user));
                        localStorage.setItem('current_user', JSON.stringify(data.user));
                        console.log('✅ Synced user data from database:', {
                            plan: data.user.plan,
                            monthlyReportLimit: data.user.monthlyReportLimit
                        });
                    }

                    if (data.cookieInfo && cookieElement) {
                        const { cookieNumber } = data.cookieInfo;
                        cookieElement.textContent = `${cookieNumber}`;
                        cookieElement.style.color = '#22c55e';
                    } else if (cookieElement) {
                        cookieElement.textContent = 'Not assigned';
                        cookieElement.style.color = '#ef4444';
                    }

                    // Update report limit display
                    if (data.user && reportLimitElement) {
                        const limit = data.user.monthlyReportLimit !== undefined ? data.user.monthlyReportLimit : 2;
                        const maxLimit = data.user.plan === 'pro' ? 5 : 2;
                        const threshold = Math.floor(maxLimit / 2);
                        reportLimitElement.textContent = `${limit}/${maxLimit}`;
                        reportLimitElement.style.color = limit > threshold ? '#22c55e' : limit > 0 ? '#fbbf24' : '#ef4444';
                    }

                    // Update credits display
                    if (data.user) {
                        updateCreditsDisplay(data.user.credits || 0);
                        updateCreditsExpiration(data.user);
                    }

                    // Load assigned cookies (PC + Mobile) - chỉ trên mobile
                    if (window.__isMobile) {
                        await loadAssignedCookies();
                    }
                }

                // Fetch referral info
                await loadReferralInfo();

            } catch (error) {
                console.error('❌ Load cookie info error:', error);
            }
        }

        // ========================================
        // REFERRAL INFO FUNCTIONS
        // ========================================

        async function loadReferralInfo() {
            try {
                const token = localStorage.getItem('auth_token');
                if (!token) return;

                const backendUrl = window.APP_CONFIG ? window.APP_CONFIG.BACKEND_URL : 'https://backend-c0r3-7xpq9zn2025.onrender.com';
                const response = await fetch(`${backendUrl}/api/referral/info`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    if (data.success) {
                        updateReferralsDisplay(data.referralsRemaining, data.referralsUsedThisMonth);
                    }
                }
            } catch (error) {
                console.error('❌ Load referral info error:', error);
            }
        }

        function updateReferralsDisplay(remaining, used) {
            const referralsElement = document.getElementById('referralsRemaining');
            if (referralsElement) {
                referralsElement.textContent = `${remaining}/2`;
                // Màu sắc: xanh nếu còn lượt, vàng nếu còn 1, đỏ nếu hết
                if (remaining >= 2) {
                    referralsElement.style.color = '#22c55e'; // Xanh
                } else if (remaining === 1) {
                    referralsElement.style.color = '#fbbf24'; // Vàng
                } else {
                    referralsElement.style.color = '#ef4444'; // Đỏ
                }
            }
        }

        // ========================================
        // REFERRAL NOTIFICATION POPUP
        // ========================================

        /**
         * Hiển thị popup thông báo khi có người dùng mã giới thiệu
         */
        function showReferralNotificationPopup(notification) {
            const { unreadCount, totalCreditsEarned, referredEmails } = notification;

            // Tạo message
            let message = '';
            if (unreadCount === 1) {
                message = `🎉 Bạn vừa nhận <strong style="color: #22c55e;">${totalCreditsEarned} credits</strong> từ việc giới thiệu <strong>${referredEmails[0]}</strong>!`;
            } else {
                message = `🎉 Bạn vừa nhận <strong style="color: #22c55e;">${totalCreditsEarned} credits</strong> từ việc giới thiệu <strong>${unreadCount} người bạn</strong>!`;
            }

            showCustomModal({
                icon: '🎁',
                title: 'Thưởng giới thiệu!',
                message: `<div style="text-align: center; line-height: 1.6;">
                    <p style="margin-bottom: 15px;">${message}</p>
                    <p style="color: #aaa; font-size: 0.9rem;">Cảm ơn bạn đã giới thiệu Tiệm Bánh đến bạn bè!</p>
                </div>`,
                buttons: [
                    {
                        text: 'Xem lịch sử',
                        type: 'secondary',
                        onClick: () => showReferralHistoryModal()
                    },
                    {
                        text: 'Tuyệt vời!',
                        type: 'primary',
                        onClick: () => markReferralsAsRead()
                    }
                ]
            });
        }

        /**
         * Đánh dấu đã đọc thông báo referral
         */
        async function markReferralsAsRead() {
            try {
                const token = localStorage.getItem('auth_token');
                if (!token) return;

                const backendUrl = window.APP_CONFIG ? window.APP_CONFIG.BACKEND_URL : 'https://backend-c0r3-7xpq9zn2025.onrender.com';
                await fetch(`${backendUrl}/api/referral/mark-read`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    }
                });
                console.log('✅ Marked referrals as read');
            } catch (error) {
                console.error('❌ Mark referrals read error:', error);
            }
        }

        /**
         * Wrapper để đóng modal referral notification
         * Gọi hàm phù hợp tùy theo context (đăng nhập hoặc reload trang)
         */
        async function handleCloseReferralNotification() {
            // Thử gọi hàm từ app.js trước (khi reload trang)
            if (typeof closeReferralNotificationOnLoad === 'function') {
                await closeReferralNotificationOnLoad();
            }
            // Fallback: gọi hàm từ auth.js (khi đăng nhập)
            else if (typeof closeReferralNotification === 'function') {
                await closeReferralNotification();
            }
            // Fallback cuối: đóng modal trực tiếp
            else {
                const overlay = document.getElementById('referralNotificationOverlay');
                if (overlay) {
                    overlay.classList.remove('active');
                }
            }
        }

        /**
         * Hiển thị modal lịch sử giới thiệu
         */
        async function showReferralHistoryModal() {
            // Đánh dấu đã đọc trước
            await markReferralsAsRead();

            // Lấy lịch sử từ backend
            try {
                const token = localStorage.getItem('auth_token');
                if (!token) return;

                // Hiện loading indicator
                if (typeof showSmartLoading === 'function') {
                    showSmartLoading('Đang tải lịch sử...', 300);
                }

                const backendUrl = window.APP_CONFIG ? window.APP_CONFIG.BACKEND_URL : 'https://backend-c0r3-7xpq9zn2025.onrender.com';
                const response = await fetch(`${backendUrl}/api/referral/history`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    }
                });

                // Ẩn loading indicator
                if (typeof hideSmartLoading === 'function') {
                    hideSmartLoading();
                }

                if (!response.ok) {
                    throw new Error('Failed to load history');
                }

                const data = await response.json();

                // Lấy email user để hiển thị mã giới thiệu
                const currentUser = JSON.parse(localStorage.getItem('current_user') || '{}');
                const userEmail = currentUser.email || '';

                // Kiểm tra mobile
                const isMobile = window.__isMobile || window.innerWidth <= 768;

                if (!data.success || !data.history || data.history.length === 0) {
                    if (isMobile) {
                        showMobileReferralModal(userEmail, 0, []);
                    } else {
                        showCustomModal({
                            icon: '📋',
                            title: 'Lịch sử giới thiệu',
                            message: `<p style="text-align: center; color: #aaa; margin: 0;">Khách yêu chưa mời thêm bạn nào ghé chơi Tiệm Bánh rồi!<br><br>Mã giới thiệu của bạn: <strong style="color: #22c55e; user-select: all;">${userEmail}</strong></p>`,
                            buttons: [{ text: 'Đóng', type: 'primary' }]
                        });
                    }
                    return;
                }

                // Tính tổng credits
                const totalCredits = data.history.reduce((sum, item) => sum + (item.creditsEarned || 0), 0);

                if (isMobile) {
                    showMobileReferralModal(userEmail, totalCredits, data.history);
                } else {
                    // Tạo HTML cho lịch sử (desktop)
                    let historyHTML = '';
                    data.history.forEach((item) => {
                        const date = new Date(item.timestamp);
                        const dateStr = date.toLocaleDateString('vi-VN', { day: '2-digit', month: '2-digit', year: 'numeric' });
                        const isNew = !item.isRead;
                        const newBadge = isNew ? ' <span style="background:#e50914;color:#fff;padding:1px 5px;border-radius:3px;font-size:0.7rem;">MỚI</span>' : '';

                        historyHTML += `<div style="display:flex;justify-content:space-between;align-items:center;padding:8px 0;border-bottom:1px solid rgba(255,255,255,0.1);">
                            <div><span style="color:#fff;">${item.referredEmail}</span>${newBadge}<br><span style="color:#666;font-size:0.75rem;">${dateStr}</span></div>
                            <span style="color:#22c55e;font-weight:600;">+${item.creditsEarned}</span>
                        </div>`;
                    });

                    showCustomModal({
                        icon: '📋',
                        title: 'Lịch sử giới thiệu',
                        message: `<div style="text-align:center;margin-bottom:10px;color:#888;font-size:0.9rem;">Mã của bạn: <strong style="color:#22c55e;">${userEmail}</strong> • Tổng: <strong style="color:#22c55e;">${totalCredits} credits</strong></div><div style="max-height:200px;overflow-y:auto;">${historyHTML}</div>`,
                        buttons: [{ text: 'Đóng', type: 'primary' }]
                    });
                }

            } catch (error) {
                // Ẩn loading indicator khi lỗi
                if (typeof hideSmartLoading === 'function') {
                    hideSmartLoading();
                }

                console.error('❌ Load referral history error:', error);
                showCustomModal({
                    icon: '❌',
                    title: 'Lỗi',
                    message: 'Không thể tải lịch sử giới thiệu. Vui lòng thử lại sau.',
                    buttons: [{ text: 'Đóng', type: 'primary' }]
                });
            }
        }

        /**
         * Hiển thị modal lịch sử giới thiệu cho mobile
         */
        function showMobileReferralModal(userEmail, totalCredits, history) {
            // Xóa modal cũ nếu có
            const existingModal = document.getElementById('mobileReferralHistoryModal');
            if (existingModal) existingModal.remove();

            // Tạo HTML cho danh sách
            let listHTML = '';
            if (history.length === 0) {
                listHTML = `<div style="text-align:center;color:#888;padding:20px 0;font-size:0.75rem;">
                    Chưa có ai sử dụng mã giới thiệu của bạn
                </div>`;
            } else {
                history.forEach((item) => {
                    const date = new Date(item.timestamp);
                    const dateStr = date.toLocaleDateString('vi-VN', { day: '2-digit', month: '2-digit', year: 'numeric' });
                    listHTML += `
                        <div style="display:flex;justify-content:space-between;align-items:center;padding:8px 0;border-bottom:1px solid rgba(255,255,255,0.08);">
                            <div style="flex:1;min-width:0;">
                                <div style="color:#fff;font-size:0.72rem;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">${item.referredEmail}</div>
                                <div style="color:#666;font-size:0.65rem;">${dateStr}</div>
                            </div>
                            <div style="color:#22c55e;font-weight:600;font-size:0.75rem;margin-left:8px;">+${item.creditsEarned}</div>
                        </div>`;
                });
            }

            // Tạo modal
            const modal = document.createElement('div');
            modal.id = 'mobileReferralHistoryModal';
            modal.innerHTML = `
                <div style="position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.85);z-index:9999999;display:flex;align-items:center;justify-content:center;padding:20px;box-sizing:border-box;">
                    <div style="background:#1a1a1a;border-radius:12px;width:100%;max-width:280px;overflow:hidden;border:1px solid rgba(255,255,255,0.1);">
                        <!-- Header -->
                        <div style="background:linear-gradient(135deg,rgba(34,197,94,0.15),rgba(34,197,94,0.05));padding:12px;text-align:center;border-bottom:1px solid rgba(255,255,255,0.08);">
                            <div style="font-size:1.2rem;margin-bottom:4px;">🎁</div>
                            <div style="color:#22c55e;font-weight:600;font-size:0.85rem;">Lịch sử giới thiệu</div>
                        </div>
                        
                        <!-- Summary -->
                        <div style="padding:10px 12px;background:rgba(0,0,0,0.3);display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid rgba(255,255,255,0.08);">
                            <div style="font-size:0.65rem;color:#888;">Mã của bạn:<br><span style="color:#22c55e;font-size:0.7rem;word-break:break-all;">${userEmail}</span></div>
                            <div style="text-align:right;"><div style="color:#22c55e;font-weight:700;font-size:1rem;">${totalCredits}</div><div style="color:#888;font-size:0.6rem;">credits</div></div>
                        </div>
                        
                        <!-- List -->
                        <div style="max-height:35vh;overflow-y:auto;padding:8px 12px;">
                            ${listHTML}
                        </div>
                        
                        <!-- Footer -->
                        <div style="padding:10px 12px;border-top:1px solid rgba(255,255,255,0.08);">
                            <button onclick="document.getElementById('mobileReferralHistoryModal').remove()" style="width:100%;padding:10px;background:rgba(255,255,255,0.1);border:none;border-radius:6px;color:#fff;font-size:0.75rem;font-weight:500;cursor:pointer;">Đóng</button>
                        </div>
                    </div>
                </div>`;

            document.body.appendChild(modal);

            // Click outside to close
            modal.querySelector('div').addEventListener('click', function (e) {
                if (e.target === this) {
                    modal.remove();
                }
            });
        }

        // ========================================
        // ACCOUNT HELP MODAL
        // ========================================

        function showAccountHelpModal() {
            // Lấy email của user hiện tại
            const currentUser = JSON.parse(localStorage.getItem('current_user') || '{}');
            const userEmail = currentUser.email || 'email của bạn';

            showCustomModal({
                icon: '',
                title: 'Giải thích thông tin tài khoản',
                message: `<div style="text-align: justify; line-height: 1.5; width: 400px;">
<p style="margin: 0 0 6px 0;"><strong style="color: #fbbf24;">Credits:</strong> Số lượt đăng nhập Netflix còn lại. Mỗi lần bấm "Watch as Guest" thành công sẽ trừ 1 credit.</p>
<p style="margin: 0 0 6px 0;"><strong style="color: #fbbf24;">Expires:</strong> Ngày hết hạn credits. Với gói Free, credits sẽ hết hạn sau 7 ngày kể từ ngày đăng ký hoặc được cấp lại. Sau khi hết hạn, credits sẽ về 0.</p>
<p style="margin: 0 0 6px 0;"><strong style="color: #fbbf24;">Assigned Account:</strong> Tài khoản Netflix đang được gán cho bạn. Mỗi user sẽ được gán 1 tài khoản riêng.</p>
<p style="margin: 0 0 6px 0;"><strong style="color: #fbbf24;">Switches Left:</strong> Số lần đổi tài khoản Netflix còn lại trong tháng. Dùng khi tài khoản hiện tại bị lỗi.</p>
<p style="margin: 0;"><strong style="color: #fbbf24;">Monthly Invites:</strong> Số lượt mời bạn bè còn lại trong tháng. Khi bạn bè nhập mã giới thiệu của bạn để đăng ký thành công tài khoản tại Tiệm Bánh, cả 2 sẽ được nhận thêm 5 credits.<br><br><strong style="text-align: left; display: block;">Mã giới thiệu của bạn là:</strong><span style="color: #22c55e; user-select: all; display: block;">${userEmail}</span></p>
</div>`,
                buttons: [{ text: 'Đã hiểu', type: 'primary' }]
            });
        }

        // ========================================
        // REPORT ISSUE FUNCTIONS
        // ========================================

        function showReportIssueModal() {
            const modal = document.getElementById('reportIssueModal');
            if (modal) {
                modal.classList.add('active');
                document.body.style.overflow = 'hidden';

                // Update limit in modal
                const reportLimitText = document.getElementById('reportLimit')?.textContent || '3/3';
                const reportLimitModal = document.getElementById('reportLimitModal');
                if (reportLimitModal) {
                    reportLimitModal.textContent = reportLimitText;
                }

                // Setup reason dropdown listener
                const reasonSelect = document.getElementById('reportReason');
                const customContainer = document.getElementById('customReasonContainer');

                reasonSelect.onchange = function () {
                    if (this.value === 'other') {
                        customContainer.style.display = 'block';
                    } else {
                        customContainer.style.display = 'none';
                    }
                };
            }
        }

        function closeReportIssueModal() {
            const modal = document.getElementById('reportIssueModal');
            if (modal) {
                modal.classList.remove('active');
                document.body.style.overflow = '';
                document.getElementById('reportReason').value = '';
                document.getElementById('customReason').value = '';
                document.getElementById('customReasonContainer').style.display = 'none';
            }
        }

        function showMessageBeforeReport() {
            return new Promise((resolve) => {
                const teamModal = document.getElementById('teamModal');
                const startBtn = document.getElementById('startWatchingBtn');
                const cancelBtn = document.getElementById('cancelBtn');
                const messageSection = document.getElementById('messageSection');
                const watchingSection = document.getElementById('watchingSection');
                let countdown = 30; // 30 seconds duration

                // RESET MODAL STATE - Show message section, hide watching section
                if (messageSection) messageSection.style.display = 'block';
                if (watchingSection) watchingSection.style.display = 'none';

                // ========================================
                // REMOVE ALL OLD EVENT LISTENERS
                // ========================================
                // Clone and replace button để xóa tất cả event listeners cũ
                const newStartBtn = startBtn.cloneNode(true);
                const newCancelBtn = cancelBtn.cloneNode(true);
                startBtn.parentNode.replaceChild(newStartBtn, startBtn);
                cancelBtn.parentNode.replaceChild(newCancelBtn, cancelBtn);

                // Update references
                const startBtnRef = newStartBtn;
                const cancelBtnRef = newCancelBtn;
                // ========================================

                // Show modal
                teamModal.classList.add('active');
                document.body.style.overflow = 'hidden';
                startBtnRef.disabled = true;
                startBtnRef.textContent = `Bắt đầu xem sau ${countdown}s`;

                // Countdown timer
                const timer = setInterval(() => {
                    countdown--;
                    if (countdown > 0) {
                        startBtnRef.textContent = `Bắt đầu xem sau ${countdown}s`;
                    } else {
                        clearInterval(timer);
                        startBtnRef.disabled = false;
                        startBtnRef.textContent = 'Bắt đầu xem';
                    }
                }, 1000);

                // Handle start button click
                const handleStart = () => {
                    if (!startBtnRef.disabled) {
                        clearInterval(timer);
                        teamModal.classList.remove('active');
                        document.body.style.overflow = '';
                        resolve(true); // User watched message - continue
                    }
                };

                // Handle cancel button
                const handleCancel = () => {
                    clearInterval(timer);
                    teamModal.classList.remove('active');
                    document.body.style.overflow = '';
                    resolve(false); // User cancelled - stop
                };

                startBtnRef.addEventListener('click', handleStart);
                cancelBtnRef.addEventListener('click', handleCancel);
            });
        }

        async function confirmReportIssue() {
            const reason = document.getElementById('reportReason').value;
            const customReason = document.getElementById('customReason').value;

            if (!reason) {
                showCustomModal({
                    icon: '❌',
                    title: 'Thiếu thông tin',
                    message: 'Vui lòng chọn lý do!',
                    buttons: [{ text: 'OK', type: 'danger' }]
                });
                return;
            }

            if (reason === 'other' && !customReason.trim()) {
                showCustomModal({
                    icon: '❌',
                    title: 'Thiếu thông tin',
                    message: 'Vui lòng nhập lý do chi tiết!',
                    buttons: [{ text: 'OK', type: 'danger' }]
                });
                return;
            }

            // Đóng modal chọn lý do trước khi hiện modal "TRƯỚC KHI ĐỔI TÀI KHOẢN"
            closeReportIssueModal();

            // Confirm action with new message
            const confirmed = await showConfirmCustomModal({
                icon: '⚠️',
                title: 'TRƯỚC KHI ĐỔI TÀI KHOẢN',
                message: `⚠️ QUAN TRỌNG: Hãy thử các cách sau trước!

Do cơ chế ANTIBOT của Netflix, đôi khi bạn cần:

1️⃣ THỬ CHUYỂN SANG PROFILE KHÁC (NÊN LÀM)
2️⃣ TẮT VÀ MỞ LẠI TAB NETFLIX
3️⃣ TẮT VÀ MỞ LẠI TRÌNH DUYỆT

━━━━━━━━━━━━━━━━━━━━━━━

Nếu vẫn không được, bạn cần đổi tài khoản với một số lưu ý sau:
• Sẽ trừ 1 lượt đổi tài khoản của tháng
• Phải xem quảng cáo 30 giây
• Nếu hệ thống phát hiện tài khoản Netflix cũ vẫn hoạt động, tài khoản của bạn có thể bị hạn chế vì lạm dụng

Bạn đã thử 3 cách trên và vẫn không được?`,
                confirmText: 'Đã thử, vẫn lỗi - Đồng ý đổi',
                cancelText: 'Để tôi thử lại'
            });

            if (!confirmed) return;

            // Show message before processing
            const watchedMessage = await showMessageBeforeReport();

            // If user cancelled, stop here
            if (!watchedMessage) {
                console.log('❌ User cancelled - Report issue aborted');
                return;
            }

            try {
                showSmartLoading('Đang xử lý...', 500);

                // Call API to report issue
                const backendUrl = window.APP_CONFIG ? window.APP_CONFIG.BACKEND_URL : 'https://backend-c0r3-7xpq9zn2025.onrender.com';
                const response = await fetch(`${backendUrl}/api/cookies/report-issue`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('auth_token')}`
                    },
                    body: JSON.stringify({
                        reason: reason,
                        customReason: customReason
                    })
                });

                const data = await response.json();
                hideSmartLoading();

                if (!response.ok) {
                    // Handle BANNED error (tài khoản bị khóa)
                    if (data.code === 'BANNED') {
                        closeReportIssueModal();
                        const isPermanent = data.isPermanent;
                        const remainingTime = data.remainingSeconds;

                        let timeMessage = '';
                        if (isPermanent) {
                            timeMessage = 'Tài khoản của bạn đã bị khóa vĩnh viễn.';
                        } else if (remainingTime) {
                            const hours = Math.floor(remainingTime / 3600);
                            const minutes = Math.floor((remainingTime % 3600) / 60);
                            if (hours > 0) {
                                timeMessage = `Thời gian còn lại: ${hours} giờ ${minutes} phút`;
                            } else {
                                timeMessage = `Thời gian còn lại: ${minutes} phút`;
                            }
                        }

                        showCustomModal({
                            icon: '🚫',
                            title: 'Tài khoản bị khóa',
                            message: `Lý do: ${data.error || 'Tài khoản của bạn đã bị khóa do các hoạt động bất thường.'}\n\n${timeMessage}\n\nNếu bạn cho rằng đây là nhầm lẫn, vui lòng liên hệ Support để được hỗ trợ.`,
                            buttons: [
                                {
                                    text: 'Liên hệ Support',
                                    type: 'primary',
                                    onClick: () => {
                                        window.open('https://www.facebook.com/tiembanh4k/', '_blank');
                                    }
                                },
                                {
                                    text: 'Đóng',
                                    type: 'secondary'
                                }
                            ]
                        });
                        return;
                    }

                    // Handle NO_REPORT_LIMIT error (hết lượt đổi tài khoản)
                    if (data.code === 'NO_REPORT_LIMIT' || data.code === 'LIMIT_EXCEEDED') {
                        closeReportIssueModal();
                        if (data.plan === 'free') {
                            showLimitExceededFreeModal();
                        } else {
                            showLimitExceededProModal();
                        }
                        return;
                    }

                    // Handle NO_CREDITS error (hết credits)
                    if (data.code === 'NO_CREDITS') {
                        closeReportIssueModal();
                        showNoCreditsModal();
                        return;
                    }

                    showCustomModal({
                        icon: '❌',
                        title: 'Lỗi',
                        message: data.error || 'Có lỗi xảy ra',
                        buttons: [{ text: 'OK', type: 'danger' }]
                    });
                    return;
                }

                // Success - Update localStorage with new quota
                const currentUser = JSON.parse(localStorage.getItem('currentUser') || localStorage.getItem('current_user') || '{}');
                const maxLimit = currentUser.plan === 'pro' ? 5 : 2;

                // CẬP NHẬT QUOTA MỚI VÀO LOCALSTORAGE
                currentUser.monthlyReportLimit = data.remainingReports;
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                localStorage.setItem('current_user', JSON.stringify(currentUser));
                console.log('✅ Updated localStorage with new quota:', data.remainingReports);

                closeReportIssueModal();

                // Reload cookie info
                await loadCookieInfo();

                showCustomModal({
                    icon: '✅',
                    title: 'Thành công',
                    message: `${data.message}\n\nSố lần còn lại: ${data.remainingReports}/${maxLimit}\n\nBấm OK để hệ thống tự động chuyển sang tài khoản Netflix mới.`,
                    buttons: [{
                        text: 'OK', type: 'primary', onClick: async () => {
                            closeCustomModal();

                            // TỰ ĐỘNG MỞ NETFLIX TAB NẾU CHƯA CÓ
                            if (typeof window.netflixGuestApp !== 'undefined') {
                                const state = window.netflixGuestApp.state;

                                // Check if Netflix tab exists
                                if (!state.netflixTabRef || state.netflixTabRef.closed) {
                                    console.log('📂 Netflix tab not found, auto-opening...');
                                    // Trigger open Netflix
                                    const openNetflixBtn = document.getElementById('openNetflixBtn');
                                    if (openNetflixBtn) {
                                        openNetflixBtn.click();
                                        // Wait for tab to open
                                        await new Promise(resolve => setTimeout(resolve, 1000));
                                    }
                                }

                                // TỰ ĐỘNG TRIGGER WATCH AS GUEST (skip quota check)
                                console.log('🔄 Auto-triggering Watch as Guest after report...');
                                if (typeof window.handleWatchAsGuestAfterReport === 'function') {
                                    await window.handleWatchAsGuestAfterReport();
                                }
                            }
                        }
                    }]
                });

            } catch (error) {
                hideSmartLoading();
                console.error('❌ Report issue error:', error);
                showCustomModal({
                    icon: '❌',
                    title: 'Lỗi kết nối',
                    message: 'Có lỗi xảy ra: ' + error.message,
                    buttons: [{ text: 'OK', type: 'danger' }]
                });
            }
        }

        // ========================================
        // LIMIT EXCEEDED MODALS
        // ========================================

        function showNoCreditsModal() {
            // Lấy email của user hiện tại
            const currentUser = JSON.parse(localStorage.getItem('current_user') || '{}');
            const userEmail = currentUser.email || 'email của bạn';

            showConfirmCustomModal({
                icon: '💳',
                title: 'HẾT CREDITS',
                message: `Bạn đã sử dụng hết credits.

Bạn có thể:
• Mua thêm credits (500 VNĐ = 1 credit, tối thiểu 30.000 VNĐ = 60 credits)
• Nâng cấp Pro 30.000 VNĐ/tháng → nhận ngay 60 credits + 5 lượt đổi tài khoản/tháng
• Giới thiệu bạn bè đăng ký Tiệm Bánh Netflix → nhận 5 credits/người
(tối đa 2 lượt/tháng)

💡 Mã giới thiệu của bạn là: ${userEmail}`,
                confirmText: 'Mua thêm Credits',
                cancelText: 'Đóng'
            }).then(confirmed => {
                if (confirmed) {
                    openPurchaseCreditsModal();
                }
            });
        }

        function showLimitExceededFreeModal() {
            showConfirmCustomModal({
                icon: '⚠️',
                title: 'HẾT LƯỢT ĐỔI TÀI KHOẢN',
                message: `Bạn đã sử dụng hết 2 lượt đổi tài khoản Netflix của gói Free trong tháng này.
Nâng cấp lên Pro để nhận nhiều quyền lợi:
• Nhận ngay 60 credits (1 credit = 1 lần đăng nhập thành công Netflix)
• Tăng lượt đổi tài khoản Netflix lên 5 lượt/tháng
• Xem phim không quảng cáo
• Ưu tiên hỗ trợ khi có sự cố`,
                confirmText: 'Nâng cấp Pro - 30.000đ/tháng',
                cancelText: 'Đóng'
            }).then(confirmed => {
                if (confirmed) {
                    openPaymentModal('pro', '30.000đ/tháng', 'pro');
                }
            });
        }

        function showLimitExceededProModal() {
            showConfirmCustomModal({
                icon: '⚠️',
                title: 'HẾT LƯỢT ĐỔI TÀI KHOẢN',
                message: `Bạn đã sử dụng hết 5 lượt đổi tài khoản Netflix của gói Pro trong tháng này.
Nếu cần thêm lượt đổi tài khoản, vui lòng liên hệ Support qua Facebook để được hỗ trợ.`,
                confirmText: 'Liên hệ Support',
                cancelText: 'Đóng'
            }).then(confirmed => {
                if (confirmed) {
                    window.open('https://www.facebook.com/tiembanh4k/', '_blank');
                }
            });
        }

        // ========================================
        // AUTH CHECK
        // ========================================
        async function checkAuth() {
            // ✅ Check if user is in the middle of viewing Tiệm bánh message
            const pendingToken = sessionStorage.getItem('pending_tiembanh_token');
            const pendingUser = sessionStorage.getItem('pending_tiembanh_user');

            if (pendingToken && pendingUser) {
                // User tried to bypass the message by changing URL
                console.warn('⚠️ User attempted to bypass Tiệm bánh message, redirecting back to /auth');
                window.location.href = '/auth';
                return;
            }

            const currentUser = localStorage.getItem('current_user');
            const loggedIn = sessionStorage.getItem('logged_in') === 'true';

            if (loggedIn && currentUser) {
                // ✅ FETCH FRESH DATA FROM BACKEND FIRST
                console.log('🔄 Fetching fresh user data from backend...');
                const token = localStorage.getItem('auth_token');
                let user = JSON.parse(currentUser); // Fallback nếu API fail

                if (token) {
                    try {
                        const backendUrl = window.APP_CONFIG ? window.APP_CONFIG.BACKEND_URL : 'https://backend-c0r3-7xpq9zn2025.onrender.com';
                        const response = await fetch(`${backendUrl}/api/auth/me`, {
                            method: 'GET',
                            headers: {
                                'Authorization': `Bearer ${token}`,
                                'Content-Type': 'application/json'
                            }
                        });

                        if (response.ok) {
                            const data = await response.json();
                            if (data.success && data.user) {
                                user = data.user; // Use fresh data from API
                                // Update localStorage với data mới
                                localStorage.setItem('current_user', JSON.stringify(user));
                                localStorage.setItem('currentUser', JSON.stringify(user));
                                console.log('✅ Fresh user data loaded:', {
                                    plan: user.plan,
                                    credits: user.credits,
                                    monthlyReportLimit: user.monthlyReportLimit
                                });

                                // ========================================
                                // CHECK REFERRAL NOTIFICATION
                                // ========================================
                                if (data.referralNotification && data.referralNotification.hasUnread) {
                                    console.log('🎁 User has unread referral notifications:', data.referralNotification);
                                    // Delay hiển thị popup để trang load xong
                                    setTimeout(() => {
                                        showReferralNotificationPopup(data.referralNotification);
                                    }, 1000);
                                }
                            }
                        }
                    } catch (error) {
                        console.warn('⚠️ Failed to fetch fresh user data, using cached:', error);
                    }
                }

                // Hide login section, show profile
                document.getElementById('loginSection').style.display = 'none';
                document.getElementById('userProfileCard').style.display = 'block';

                // Update profile info
                document.getElementById('userDisplayName').textContent = user.name;
                document.getElementById('userEmail').textContent = user.email;

                // Show verified badge if email is verified
                const verifiedBadge = document.getElementById('verifiedBadge');
                if (user.emailVerified) {
                    verifiedBadge.style.display = 'inline-block';
                } else {
                    verifiedBadge.style.display = 'none';
                }

                // Update account type based on plan
                const accountType = user.plan === 'pro' ? 'PRO PLAN' : 'FREE PLAN';
                const accountTypeColor = user.plan === 'pro' ? '#f5cd05' : '#4ade80';
                document.getElementById('userType').textContent = accountType;
                document.getElementById('userType').style.color = accountTypeColor;

                // Show Pro info if Pro plan
                if (user.plan === 'pro') {
                    // Show Pro upgrade date
                    if (user.proUpgradedAt) {
                        const upgradedDate = new Date(user.proUpgradedAt);
                        const dayU = String(upgradedDate.getDate()).padStart(2, '0');
                        const monthU = String(upgradedDate.getMonth() + 1).padStart(2, '0');
                        const yearU = upgradedDate.getFullYear();
                        document.getElementById('proUpgradedDate').textContent = `${dayU}/${monthU}/${yearU}`;
                    } else {
                        document.getElementById('proUpgradedDate').textContent = '-';
                    }

                    // Show Pro expiration date
                    if (user.proExpiresAt) {
                        const expiresDate = new Date(user.proExpiresAt);
                        const dayE = String(expiresDate.getDate()).padStart(2, '0');
                        const monthE = String(expiresDate.getMonth() + 1).padStart(2, '0');
                        const yearE = expiresDate.getFullYear();
                        document.getElementById('proExpiresDate').textContent = `${dayE}/${monthE}/${yearE}`;
                    } else {
                        document.getElementById('proExpiresDate').textContent = '-';
                    }

                    document.getElementById('proExpiresContainer').style.display = 'block';
                    // Ẩn nút nâng cấp Pro cho user Pro
                    const upgradeBtn = document.getElementById('upgradeToProBtn');
                    if (upgradeBtn) upgradeBtn.style.display = 'none';
                } else {
                    document.getElementById('proExpiresContainer').style.display = 'none';
                    // Hiện nút mua credits cho user Free (đã đổi tên button)
                    const purchaseBtn = document.getElementById('purchaseCreditsBtn');
                    if (purchaseBtn) purchaseBtn.style.display = 'block';
                }

                // Update credits display
                updateCreditsDisplay(user.credits || 0);

                // Update credits expiration display (chỉ cho Free plan)
                updateCreditsExpiration(user);

                // Avatar - using favicon.svg
                const avatarEl = document.getElementById('userAvatar');
                avatarEl.innerHTML = '<img src="../favicon.svg" alt="Avatar" width="40" height="40" style="display: block;">';

                // Load cookie info from backend (initial - chỉ 1 lần khi login)
                loadCookieInfo();

                // ✅ Data đã được refresh từ backend khi page load
                // Không cần auto-refresh mỗi 30s nữa

                // Enable guest section
                const loginRequired = document.getElementById('loginRequired');
                if (loginRequired) loginRequired.style.display = 'none';

                const openBtn = document.getElementById('openNetflixBtn');
                const guestBtn = document.getElementById('watchAsGuestBtn');
                if (openBtn) openBtn.disabled = false;
                if (guestBtn) guestBtn.disabled = false;

                console.log('✅ User logged in:', user.email, 'Plan:', user.plan);
            } else {
                // Show login section, hide profile
                document.getElementById('loginSection').style.display = 'block';
                document.getElementById('userProfileCard').style.display = 'none';

                // Disable guest section
                const loginRequired = document.getElementById('loginRequired');
                if (loginRequired) loginRequired.style.display = 'block';

                const openBtn = document.getElementById('openNetflixBtn');
                const guestBtn = document.getElementById('watchAsGuestBtn');
                if (openBtn) openBtn.disabled = true;
                if (guestBtn) guestBtn.disabled = true;

                console.log('⚠️ User not logged in - Guest features disabled');
            }
        }

        async function handleLogout() {
            const confirmed = await showConfirmCustomModal({
                icon: '🚪',
                title: 'Xác nhận đăng xuất',
                message: 'Bạn có chắc muốn đăng xuất khỏi tài khoản này?',
                confirmText: 'Đăng xuất',
                cancelText: 'Hủy'
            });

            if (confirmed) {
                localStorage.removeItem('current_user');
                localStorage.removeItem('auth_token');
                sessionStorage.removeItem('logged_in');

                showCustomModal({
                    icon: '✅',
                    title: 'Đăng xuất thành công',
                    message: 'Bạn đã đăng xuất khỏi tài khoản.',
                    buttons: [{
                        text: 'OK',
                        type: 'primary',
                        onClick: () => window.location.reload()
                    }]
                });
            }
        }

        // Check auth on load
        checkAuth();

        // Manual Extension Detection - Improved method
        // Try multiple extension IDs (unpacked extension has different ID)
        const POSSIBLE_EXTENSION_IDS = [
            'akfpgaefjdmofdplmogeknigbeieiifi', // Published extension ID
            'geohkippdgmeckiolifccmjmjmpfmoci', // Unpacked extension ID (local dev)
        ];

        // Flag to track if extension already detected
        let extensionDetected = false;

        // Method 1: Try to find extension by name first
        async function findExtensionId() {
            if (typeof chrome !== 'undefined' && chrome.management) {
                try {
                    const extensions = await chrome.management.getAll();
                    const netflixExtension = extensions.find(ext =>
                        ext.name === 'Tiệm Bánh Netflix' ||
                        ext.name.includes('Netflix') ||
                        ext.name.includes('Tiệm Bánh')
                    );
                    if (netflixExtension) {
                        console.log('✅ Found extension by name:', netflixExtension.id, 'version:', netflixExtension.version);
                        return netflixExtension.id;
                    }
                } catch (error) {
                    console.warn('⚠️ Cannot use chrome.management API:', error);
                }
            }
            return null;
        }

        // Method 2: Ping extension multiple times to ensure detection
        async function pingExtension(attempt = 1, extensionIdIndex = 0) {
            // Stop if already detected
            if (extensionDetected) {
                console.log('✅ Extension already detected, stopping ping');
                return;
            }

            // Try to find extension ID first
            let extensionId = await findExtensionId();

            // Fallback: Try each hardcoded ID
            if (!extensionId) {
                if (extensionIdIndex < POSSIBLE_EXTENSION_IDS.length) {
                    extensionId = POSSIBLE_EXTENSION_IDS[extensionIdIndex];
                    console.log(`🔄 Trying extension ID ${extensionIdIndex + 1}/${POSSIBLE_EXTENSION_IDS.length}:`, extensionId);
                } else {
                    // Tried all IDs, retry from beginning
                    if (attempt < 5) {
                        setTimeout(() => pingExtension(attempt + 1, 0), 500);
                    } else {
                        console.error('❌ Extension not found after trying all IDs');
                        window.dispatchEvent(new CustomEvent('NetflixGuestExtensionNotFound'));
                    }
                    return;
                }
            }

            if (!extensionId) {
                console.error('❌ Cannot find extension ID');
                if (attempt < 5) {
                    setTimeout(() => pingExtension(attempt + 1, 0), 500);
                } else {
                    window.dispatchEvent(new CustomEvent('NetflixGuestExtensionNotFound'));
                }
                return;
            }

            console.log('🔍 Ping attempt ' + attempt + ' to extension:', extensionId);

            if (typeof chrome !== 'undefined' && chrome.runtime) {
                chrome.runtime.sendMessage(
                    extensionId,
                    { action: 'ping' },
                    (response) => {
                        console.log('📨 Response:', response);
                        console.log('❌ Error:', chrome.runtime.lastError);

                        if (!chrome.runtime.lastError && response && response.status === 'ok') {
                            console.log('✅ Extension detected via ping (attempt ' + attempt + ')');
                            console.log('📦 Extension version received:', response.version);

                            // Set flag to stop further pings
                            extensionDetected = true;

                            // Trigger success event
                            window.dispatchEvent(new CustomEvent('NetflixGuestExtensionReady', {
                                detail: {
                                    version: response.version || '1.0.0',
                                    extensionId: extensionId
                                }
                            }));
                        } else {
                            console.warn('⏳ Ping attempt ' + attempt + ' failed:', chrome.runtime.lastError?.message);
                            // Try next extension ID
                            if (extensionIdIndex + 1 < POSSIBLE_EXTENSION_IDS.length) {
                                setTimeout(() => pingExtension(attempt, extensionIdIndex + 1), 200);
                            } else if (attempt < 5) {
                                // Retry from beginning with next attempt
                                setTimeout(() => pingExtension(attempt + 1, 0), 500);
                            } else {
                                console.error('❌ Extension not found after 5 attempts');
                                window.dispatchEvent(new CustomEvent('NetflixGuestExtensionNotFound'));
                            }
                        }
                    }
                );
            } else {
                console.error('❌ chrome.runtime not available');
                window.dispatchEvent(new CustomEvent('NetflixGuestExtensionNotFound'));
            }
        }

        // Start pinging after 500ms
        setTimeout(() => pingExtension(1), 500);

        // Also ping again after 3 seconds as backup check
        setTimeout(() => pingExtension(99), 3000);

        // ========================================
        // MODAL FUNCTIONS
        // ========================================
        function showPlanModal() {
            document.getElementById('planModal').classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closePlanModal() {
            document.getElementById('planModal').classList.remove('active');
            document.body.style.overflow = '';
        }

        function selectFreePlan() {
            closePlanModal();
            // Show team message modal
            document.getElementById('teamModal').classList.add('active');
        }

        function selectProPlan() {
            // Deprecated - using openUpgradeToProFromPlanModal instead
        }

        function openUpgradeToProFromPlanModal() {
            // Close plan modal first
            closePlanModal();
            // Open payment modal for Pro upgrade from plan modal
            openPaymentModal('pro', '30.000đ/tháng', 'pro-from-plan');
        }

        // Official Package Modal Functions
        // ⚠️ TẠM NGƯNG: Đặt thành false để mở lại modal chính chủ khi cần
        const OFFICIAL_PACKAGE_ENABLED = false;

        function showOfficialPackageModal() {
            // Kiểm tra xem tính năng có được bật không
            if (!OFFICIAL_PACKAGE_ENABLED) {
                // Hiện thông báo tạm ngưng
                showSuspendedNotice();
                return;
            }

            // Logic gốc - mở modal chính chủ
            document.getElementById('officialPackageModal').classList.add('active');
            document.body.style.overflow = 'hidden'; // Ẩn scroll body khi modal mở
        }

        // Thông báo tạm ngưng phát hành gói chính chủ
        function showSuspendedNotice() {
            // Tạo modal thông báo
            const noticeHTML = `
                <div class="modal active" id="suspendedNoticeModal" style="z-index: 10001;">
                    <div class="modal-content" style="max-width: 500px; text-align: center; padding: 40px 30px;">
                        <div style="font-size: 4rem; margin-bottom: 20px;">⚠️</div>
                        <h2 style="color: #fbbf24; margin-bottom: 15px; font-size: 1.4rem;">Tạm ngưng phát hành</h2>
                        <p style="color: #ccc; line-height: 1.7; margin-bottom: 25px; font-size: 0.95rem;">
                            Hiện tại Tiệm Bánh đang <strong style="color: #e50914;">tạm ngưng phát hành các gói Netflix chính chủ</strong> 
                            do một số thay đổi trong chính sách của Netflix.
                        </p>
                        <p style="color: #888; line-height: 1.6; margin-bottom: 30px; font-size: 0.85rem;">
                            Bọn mình sẽ thông báo ngay khi dịch vụ được mở lại.<br>
                            Cảm ơn bạn đã thông cảm! 💖
                        </p>
                        <button onclick="closeSuspendedNotice()" class="btn" style="padding: 14px 40px; font-size: 1rem;">
                            Đã hiểu
                        </button>
                    </div>
                </div>
            `;

            // Thêm modal vào body
            document.body.insertAdjacentHTML('beforeend', noticeHTML);
            document.body.style.overflow = 'hidden';
        }

        function closeSuspendedNotice() {
            const modal = document.getElementById('suspendedNoticeModal');
            if (modal) {
                modal.remove();
                document.body.style.overflow = '';
            }
        }

        function closeOfficialPackageModal() {
            document.getElementById('officialPackageModal').classList.remove('active');
            document.body.style.overflow = ''; // Khôi phục scroll body khi đóng modal
        }

        function selectBasicPlan() {
            // No longer needed - using openPaymentModal instead
        }

        function selectFamilyPlan() {
            // No longer needed - using openPaymentModal instead
        }

        function selectPremiumPlan() {
            // No longer needed - using openPaymentModal instead
        }

        // Payment Modal Functions
        var paymentSource = 'package'; // 'package' or 'pro' or 'credits'

        function openPaymentModal(plan, amount, source = 'package') {
            const planNames = {
                'basic': 'Cơ Bản',
                'family': 'Gia Đình',
                'premium': 'Premium Pro',
                'pro': 'Pro',
                'credits': 'Mua Credits'
            };

            // Store payment source
            paymentSource = source;

            // Get user email from localStorage
            const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
            const userEmail = currentUser.email || '';

            // Set content based on source
            let contentText = '';
            if ((source === 'pro' || source === 'pro-from-plan' || source === 'credits') && userEmail) {
                // For Pro upgrade or Credits purchase: show actual email
                contentText = userEmail;
            } else {
                // For package purchase: show instruction
                contentText = 'Email đăng ký tài khoản';
            }

            // Set plan name, amount and content
            document.getElementById('paymentPlanName').textContent = planNames[plan] || plan;
            document.getElementById('paymentAmount').textContent = amount;
            document.getElementById('paymentContent').textContent = contentText;

            // Close official package modal if it's open (without resetting overflow)
            document.getElementById('officialPackageModal').classList.remove('active');

            // Show payment modal
            document.getElementById('paymentModal').classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function openUpgradeToProModal() {
            // Open payment modal for Pro upgrade
            openPaymentModal('pro', '30.000đ/tháng', 'pro');
        }

        function closePaymentModal() {
            document.getElementById('paymentModal').classList.remove('active');
            document.body.style.overflow = '';
        }

        function backToPackageSelection() {
            // Close payment modal
            closePaymentModal();

            // Check payment source to decide where to go back
            if (paymentSource === 'credits') {
                // For Credits purchase: just close, don't open anything
                // Do nothing - already closed modal
            } else if (paymentSource === 'pro-from-plan') {
                // For Pro upgrade from plan modal: go back to plan modal
                showPlanModal();
            } else if (paymentSource === 'pro') {
                // For Pro upgrade from dashboard: stay on main page
                // Do nothing - already closed modal
            } else {
                // For package purchase: reopen official package modal
                showOfficialPackageModal();
            }
        }

        function sendVerification() {
            // Redirect to Facebook support page
            window.open('https://www.facebook.com/tiembanh4k/', '_blank');
            closePaymentModal();
        }

        // Close payment modal when clicking outside
        document.addEventListener('click', (e) => {
            const paymentModal = document.getElementById('paymentModal');
            if (e.target === paymentModal) {
                closePaymentModal();
            }
        });
    </script>

    <!-- Ad Modal Overlay (for report issue flow) - DEPRECATED - No longer used -->
    <!-- This modal is kept for backward compatibility but should be removed in future updates -->

    <!-- Confirm Modal (Xác nhận chung) -->
    <div class="modal" id="confirmModal" style="z-index: 10003;">
        <div class="modal-content"
            style="max-width: 400px; background: rgba(0, 0, 0, 0.95); border-radius: 16px; border: 1px solid rgba(255, 255, 255, 0.1); padding: 0; overflow: hidden;">
            <div style="padding: 24px 24px 20px; border-bottom: 1px solid rgba(255, 255, 255, 0.1);">
                <div style="text-align: center; margin-bottom: 12px;">
                    <span id="confirmModalIcon" style="font-size: 3rem; line-height: 1;">⚠️</span>
                </div>
                <h3 id="confirmModalTitle" style="margin: 0; text-align: center; font-size: 1.1rem; color: #fff;">Xác
                    nhận</h3>
            </div>
            <div style="padding: 20px 24px;">
                <p id="confirmModalMessage"
                    style="margin: 0; text-align: center; line-height: 1.6; color: #ddd; font-size: 0.95rem;">
                    Bạn có chắc chắn muốn thực hiện hành động này?
                </p>
            </div>
            <div style="padding: 16px 24px; border-top: 1px solid rgba(255, 255, 255, 0.1); display: flex; gap: 10px;">
                <button onclick="closeConfirmModal(false)"
                    style="flex: 1; padding: 12px; background: rgba(255, 255, 255, 0.05); color: #999; border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 8px; font-size: 0.95rem; font-weight: 600; cursor: pointer; transition: all 0.2s;">
                    Hủy
                </button>
                <button id="confirmModalBtn" onclick="closeConfirmModal(true)"
                    style="flex: 1; padding: 12px; background: #60a5fa; color: #000; border: none; border-radius: 8px; font-size: 0.95rem; font-weight: 600; cursor: pointer; transition: all 0.2s;">
                    Xác nhận
                </button>
            </div>
        </div>
    </div>

    <!-- Payment Modal -->
    <div class="modal" id="paymentModal">
        <div class="modal-content" style="max-width: 900px;">
            <h2 style="margin-bottom: 25px; text-align: center;">Thanh toán gói <span id="paymentPlanName"></span></h2>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
                <!-- Left Column: QR Code -->
                <div
                    style="display: flex; flex-direction: column; align-items: center; justify-content: center; background: rgba(255, 255, 255, 0.05); border-radius: 12px; padding: 20px;">
                    <h3 style="margin-bottom: 15px; color: #60a5fa;">Quét QR để thanh toán nhanh</h3>
                    <img src="QR.png" alt="QR Code"
                        style="width: 100%; max-width: 300px; border-radius: 8px; border: 2px solid rgba(255, 255, 255, 0.2);">
                </div>

                <!-- Right Column: Payment Instructions -->
                <div style="display: flex; flex-direction: column; justify-content: space-between;">
                    <div>
                        <h3 style="margin-bottom: 15px; color: #60a5fa;">Hướng dẫn thanh toán</h3>

                        <div
                            style="background: rgba(255, 255, 255, 0.05); border-radius: 8px; padding: 15px; margin-bottom: 20px;">
                            <p style="margin: 0 0 10px 0; font-size: 0.95rem; color: #ddd;"><strong>Thông tin thanh
                                    toán:</strong></p>
                            <div style="line-height: 1.8; color: #ccc;">
                                <p style="margin: 5px 0;"><strong style="color: #60a5fa;">Ngân hàng:</strong>
                                    Vietcombank</p>
                                <p style="margin: 5px 0;"><strong style="color: #60a5fa;">Số tài khoản:</strong>
                                    1039015381</p>
                                <p style="margin: 5px 0;"><strong style="color: #60a5fa;">Chủ tài khoản:</strong> Đặng
                                    Văn Quốc Bảo</p>
                                <p style="margin: 5px 0;"><strong style="color: #60a5fa;">Số tiền:</strong> <span
                                        id="paymentAmount" style="color: #4ade80; font-weight: 700;"></span></p>
                                <p style="margin: 5px 0;"><strong style="color: #60a5fa;">Nội dung:</strong> <span
                                        id="paymentContent" style="color: #4ade80; font-weight: 600;"></span></p>
                            </div>
                        </div>

                        <div
                            style="background: rgba(255, 193, 7, 0.1); border: 1px solid rgba(255, 193, 7, 0.3); border-radius: 8px; padding: 15px; margin-bottom: 20px;">
                            <p style="margin: 0; font-size: 0.9rem; color: #fbbf24;">
                                <strong>⚠️ Lưu ý quan trọng:</strong><br>
                                Khi chuyển khoản, vui lòng nhập chính xác email bạn đã đăng ký tài khoản vào phần
                                <strong>Nội dung chuyển khoản</strong>
                            </p>
                        </div>

                        <div
                            style="background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.3); border-radius: 8px; padding: 15px;">
                            <p style="margin: 0; font-size: 0.9rem; line-height: 1.6; color: #ddd;">
                                <strong style="color: #60a5fa;">Xác minh thanh toán:</strong><br>
                                Sau khi chuyển khoản, vui lòng bấm nút "Gửi xác minh" bên dưới để được chuyển đến trang
                                hỗ trợ. Tại đây, bạn cần gửi ảnh chụp màn hình xác nhận giao dịch để được nâng cấp tài
                                khoản.
                            </p>
                        </div>
                    </div>

                    <div style="display: flex; gap: 10px; margin-top: 20px;">
                        <button class="btn btn-secondary" onclick="backToPackageSelection()" style="flex: 1;">
                            Hủy
                        </button>
                        <button class="btn" onclick="sendVerification()"
                            style="flex: 1; background: linear-gradient(135deg, #60a5fa, #3b82f6);">
                            Gửi xác minh
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Referral Notification Modal -->
    <div class="referral-notification-overlay" id="referralNotificationOverlay">
        <div class="referral-notification-modal">
            <div class="referral-notification-header">
                <div class="referral-notification-icon">🎉</div>
                <div class="referral-notification-title">Tin vui!</div>
                <div class="referral-notification-subtitle">Có người đã nhập mã giới thiệu của bạn</div>
            </div>
            <div class="referral-notification-body" id="referralNotificationBody">
                <!-- Nội dung sẽ được inject bằng JS -->
            </div>
            <div class="referral-notification-footer">
                <button class="referral-notification-btn" id="referralNotificationBtn"
                    onclick="handleCloseReferralNotification()">
                    Tuyệt vời! Tiếp tục
                </button>
            </div>
        </div>
    </div>

    <!-- Custom Modal Dialog -->
    <div class="custom-modal-overlay" id="customModalOverlay">
        <div class="custom-modal-dialog">
            <div class="custom-modal-header">
                <span class="custom-modal-icon" id="customModalIcon">ℹ️</span>
                <div class="custom-modal-title" id="customModalTitle">Thông báo</div>
            </div>
            <div class="custom-modal-body" id="customModalBody">
                <!-- Content will be injected here -->
            </div>
            <div class="custom-modal-footer" id="customModalFooter">
                <!-- Buttons will be injected here -->
            </div>
        </div>
    </div>

    <!-- Modal Hướng Dẫn Kiếm Credits -->
    <div class="earn-credits-modal-overlay" id="earnCreditsModalOverlay" style="display: none;">
        <div class="earn-credits-modal">
            <div class="earn-credits-modal-header">
                <span class="earn-credits-modal-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="10" />
                        <path d="M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8" />
                        <path d="M12 18V6" />
                    </svg>
                </span>
                <h3 class="earn-credits-modal-title">Cách Kiếm Thêm Credits</h3>
                <button class="earn-credits-close-btn" onclick="closeEarnCreditsModal()">&times;</button>
            </div>
            <div class="earn-credits-modal-body">
                <!-- Cách 1: Mời bạn bè -->
                <div class="earn-credits-section-title">
                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2" />
                        <circle cx="9" cy="7" r="4" />
                        <path d="M22 21v-2a4 4 0 0 0-3-3.87" />
                        <path d="M16 3.13a4 4 0 0 1 0 7.75" />
                    </svg>
                    Cách 1: Mời bạn bè
                </div>
                <p class="earn-credits-desc">Mời bạn bè đăng ký tài khoản Tiệm Bánh để nhận thêm credits.</p>
                <p class="earn-credits-highlight">Mỗi lượt mời thành công sẽ được <strong>+5 credits</strong></p>
                <p class="earn-credits-remaining">Tháng này bạn còn <span id="earnCreditsInvitesRemaining">2</span> lượt
                    mời</p>

                <div class="earn-credits-referral-code">
                    <span class="referral-label">Mã mời của bạn:</span>
                    <div class="referral-code-box">
                        <span id="earnCreditsReferralCode">email@example.com</span>
                        <button class="copy-referral-btn" onclick="copyEarnCreditsReferralCode()" title="Copy mã mời">
                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round">
                                <rect width="14" height="14" x="8" y="8" rx="2" ry="2" />
                                <path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2" />
                            </svg>
                        </button>
                    </div>
                </div>

                <div class="earn-credits-divider"></div>

                <!-- Cách 2: Mua thêm credits -->
                <div class="earn-credits-section-title">
                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <rect width="20" height="14" x="2" y="5" rx="2" />
                        <line x1="2" x2="22" y1="10" y2="10" />
                    </svg>
                    Cách 2: Mua thêm credits
                </div>
                <p class="earn-credits-desc">Mua thêm credits để sử dụng các tính năng cao cấp.</p>
                <p class="earn-credits-highlight"><strong>500 VNĐ = 1 credit</strong> (tối thiểu 30.000 VNĐ)</p>
                <button class="earn-credits-buy-btn" onclick="handleBuyCreditsFromEarnModal()">
                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                        style="margin-right: 6px;">
                        <circle cx="8" cy="21" r="1" />
                        <circle cx="19" cy="21" r="1" />
                        <path d="M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12" />
                    </svg>
                    Mua thêm credits tại đây
                </button>
            </div>
        </div>
    </div>

    <style>
        /* Earn Credits Modal Styles - Compact Version */
        .earn-credits-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(6px);
            z-index: 10001;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.2s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        .earn-credits-modal {
            background: linear-gradient(145deg, rgba(28, 28, 32, 0.98), rgba(18, 18, 22, 0.98));
            border: 1px solid rgba(255, 255, 255, 0.12);
            border-radius: 14px;
            max-width: 320px;
            width: 92%;
            box-shadow: 0 16px 48px rgba(0, 0, 0, 0.5), 0 0 24px rgba(139, 92, 246, 0.1);
            animation: slideUp 0.25s ease;
            overflow: hidden;
        }

        @keyframes slideUp {
            from {
                transform: translateY(20px);
                opacity: 0;
            }

            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .earn-credits-modal-header {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.15), rgba(168, 85, 247, 0.08));
            padding: 12px 16px;
            display: flex;
            align-items: center;
            gap: 8px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.08);
        }

        .earn-credits-modal-icon {
            color: #a78bfa;
            display: flex;
            align-items: center;
        }

        .earn-credits-modal-title {
            color: #fff;
            font-size: 0.95rem;
            font-weight: 600;
            margin: 0;
            flex: 1;
        }

        .earn-credits-close-btn {
            background: rgba(255, 255, 255, 0.08);
            border: none;
            color: #888;
            font-size: 18px;
            width: 26px;
            height: 26px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1;
        }

        .earn-credits-close-btn:hover {
            background: rgba(239, 68, 68, 0.25);
            color: #ef4444;
        }

        .earn-credits-modal-body {
            padding: 14px 16px 16px;
        }

        .earn-credits-section-title {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #d0d0d0;
            font-weight: 600;
            font-size: 0.82rem;
            margin-bottom: 6px;
        }

        .earn-credits-section-title svg {
            color: #a78bfa;
        }

        .earn-credits-desc {
            color: #999;
            font-size: 0.78rem;
            margin: 0 0 4px 0;
            line-height: 1.4;
        }

        .earn-credits-highlight {
            color: #fbbf24 !important;
            font-size: 0.78rem;
            margin: 0 0 4px 0;
        }

        .earn-credits-remaining {
            color: #22c55e !important;
            font-weight: 500;
            font-size: 0.78rem;
            margin: 0;
        }

        .earn-credits-referral-code {
            margin-top: 8px;
        }

        .referral-label {
            color: #777;
            font-size: 0.75rem;
            display: block;
            margin-bottom: 5px;
        }

        .referral-code-box {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(0, 0, 0, 0.35);
            border: 1px solid rgba(139, 92, 246, 0.25);
            border-radius: 8px;
            padding: 7px 10px;
        }

        .referral-code-box span {
            flex: 1;
            color: #a78bfa;
            font-size: 0.8rem;
            user-select: all;
            word-break: break-all;
        }

        .copy-referral-btn {
            background: rgba(139, 92, 246, 0.15);
            border: 1px solid rgba(139, 92, 246, 0.3);
            border-radius: 6px;
            padding: 5px 8px;
            cursor: pointer;
            color: #a78bfa;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .copy-referral-btn:hover {
            background: rgba(139, 92, 246, 0.3);
        }

        .earn-credits-divider {
            height: 1px;
            background: rgba(255, 255, 255, 0.08);
            margin: 10px 0;
        }

        .earn-credits-buy-btn {
            width: 100%;
            background: linear-gradient(135deg, #8b5cf6, #a855f7);
            border: none;
            color: #fff;
            padding: 10px 14px;
            border-radius: 8px;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            margin-top: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .earn-credits-buy-btn:hover {
            background: linear-gradient(135deg, #9333ea, #c026d3);
            transform: translateY(-1px);
            box-shadow: 0 4px 16px rgba(139, 92, 246, 0.35);
        }

        /* Link style for insufficient credits message - Verified Badge Color */
        .earn-credits-link {
            color: #22c55e;
            text-decoration: underline;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 500;
        }

        .earn-credits-link:hover {
            color: #4ade80;
            text-decoration-thickness: 2px;
        }

        /* Mobile responsive */
        @media (max-width: 480px) {
            .earn-credits-modal {
                max-width: 300px;
            }

            .earn-credits-modal-header {
                padding: 10px 14px;
            }

            .earn-credits-modal-title {
                font-size: 0.9rem;
            }

            .earn-credits-modal-body {
                padding: 10px 12px 12px;
            }
        }
    </style>

    <!-- Footer -->
    <footer
        style="background: rgba(0, 0, 0, 0.3); padding: 40px 20px; margin-top: 60px; border-top: 1px solid rgba(255, 255, 255, 0.1);">
        <div style="max-width: 1200px; margin: 0 auto; text-align: center;">
            <div style="margin-bottom: 25px;">
                <h3 style="color: #fff; font-size: 1.3rem; margin-bottom: 15px;">Tiệm Bánh Netflix</h3>
                <p style="color: #ddd; font-size: 0.95rem; max-width: 600px; margin: 0 auto;">
                    Nền tảng chia sẻ tài khoản Netflix hợp pháp cho cộng đồng. Giúp bạn tiết kiệm chi phí khi có nhu cầu
                    xem phim thấp.
                </p>
            </div>

            <div style="display: flex; flex-wrap: wrap; justify-content: center; gap: 25px; margin-bottom: 25px;">
                <a href="/privacy-policy/"
                    style="color: #fff; text-decoration: none; font-size: 0.95rem; transition: color 0.3s;"
                    onmouseover="this.style.color='#fbbf24'" onmouseout="this.style.color='#fff'">
                    Chính Sách Bảo Mật
                </a>
                <span style="color: rgba(255, 255, 255, 0.3);">|</span>
                <a href="/terms-of-service/"
                    style="color: #fff; text-decoration: none; font-size: 0.95rem; transition: color 0.3s;"
                    onmouseover="this.style.color='#fbbf24'" onmouseout="this.style.color='#fff'">
                    Điều Khoản Sử Dụng
                </a>
                <span style="color: rgba(255, 255, 255, 0.3);">|</span>
                <a href="/contact/"
                    style="color: #fff; text-decoration: none; font-size: 0.95rem; transition: color 0.3s;"
                    onmouseover="this.style.color='#fbbf24'" onmouseout="this.style.color='#fff'">
                    Liên Hệ
                </a>
                <span style="color: rgba(255, 255, 255, 0.3);">|</span>
                <a href="/install-guide/"
                    style="color: #fff; text-decoration: none; font-size: 0.95rem; transition: color 0.3s;"
                    onmouseover="this.style.color='#fbbf24'" onmouseout="this.style.color='#fff'">
                    Cài Extension
                </a>
                <span style="color: rgba(255, 255, 255, 0.3);">|</span>
                <a href="https://youtu.be/vrVgwrjUbpo" target="_blank"
                    style="color: #fff; text-decoration: none; font-size: 0.95rem; transition: color 0.3s;"
                    onmouseover="this.style.color='#fbbf24'" onmouseout="this.style.color='#fff'">
                    Hướng Dẫn Sử Dụng
                </a>
            </div>

            <div style="padding-top: 20px; border-top: 1px solid rgba(255, 255, 255, 0.1);">
                <p style="color: rgba(255, 255, 255, 0.6); font-size: 0.85rem; margin: 0;">
                    © 2025 Tiệm Bánh Netflix. Hoạt động minh bạch, tuân thủ pháp luật Việt Nam.
                </p>
                <p style="color: rgba(255, 255, 255, 0.5); font-size: 0.8rem; margin-top: 8px;">
                    Tất cả tài khoản Netflix được chia sẻ đều thuộc sở hữu hợp pháp của chúng tôi.
                </p>
            </div>
        </div>
    </footer>

    <!-- Credits System Functions - Inline -->
    <script>
        // Open Purchase Credits Modal
        function openPurchaseCreditsModal() {
            const modal = document.getElementById('purchaseCreditsModal');
            if (modal) {
                modal.style.display = 'flex';
                document.getElementById('purchaseAmount').value = '';
                document.getElementById('creditsAmount').textContent = '0';
                document.getElementById('totalAmount').textContent = '0 VNĐ';

                const confirmBtn = document.getElementById('confirmPurchaseBtn');
                confirmBtn.disabled = true;
                confirmBtn.style.opacity = '0.5';
            }
        }

        // Close Purchase Credits Modal
        function closePurchaseCreditsModal() {
            const modal = document.getElementById('purchaseCreditsModal');
            if (modal) {
                modal.style.display = 'none';
            }
        }

        // Format currency với dấu phân cách
        function formatCurrency(value) {
            // Remove all non-digits
            const digits = value.replace(/\D/g, '');
            if (!digits) return '';

            // Format with thousands separator
            return parseInt(digits).toLocaleString('vi-VN');
        }

        // Calculate credits from amount + Format input
        function calculateCredits(value) {
            const input = document.getElementById('purchaseAmount');
            const creditsAmount = document.getElementById('creditsAmount');
            const confirmBtn = document.getElementById('confirmPurchaseBtn');
            const totalAmount = document.getElementById('totalAmount');

            // Save cursor position
            const cursorPos = input.selectionStart;

            // Format input value với dấu phân cách
            const formatted = formatCurrency(value);
            const oldValue = input.value;
            input.value = formatted;

            // Restore cursor position
            if (formatted.length > oldValue.length) {
                input.setSelectionRange(cursorPos + 1, cursorPos + 1);
            } else if (formatted.length < oldValue.length) {
                input.setSelectionRange(cursorPos - 1, cursorPos - 1);
            } else {
                input.setSelectionRange(cursorPos, cursorPos);
            }

            // Parse to number (remove dots)
            const numAmount = parseInt(formatted.replace(/\./g, '') || '0');

            // Luôn hiển thị (0 nếu invalid)
            if (!formatted || isNaN(numAmount) || numAmount < 30000 || numAmount % 1000 !== 0) {
                creditsAmount.textContent = '0';
                if (totalAmount) totalAmount.textContent = '0 VNĐ';
                confirmBtn.disabled = true;
                confirmBtn.style.opacity = '0.4';
                return;
            }

            // Valid amount → Calculate credits (500 VNĐ = 1 credit, tức 30.000 = 60 credits)
            const credits = Math.floor(numAmount / 500);

            creditsAmount.textContent = credits.toLocaleString('vi-VN');
            if (totalAmount) totalAmount.textContent = formatted + ' VNĐ';

            confirmBtn.disabled = false;
            confirmBtn.style.opacity = '1';
        }

        // Confirm purchase credits - Open Payment Modal
        function confirmPurchaseCredits() {
            // Parse amount (remove dots)
            const inputValue = document.getElementById('purchaseAmount').value;
            const amount = parseInt(inputValue.replace(/\./g, ''));

            if (!amount || amount < 30000 || amount % 1000 !== 0) {
                alert('Vui lòng nhập số tiền hợp lệ\n\nTối thiểu: 30.000 VNĐ\nChỉ chấp nhận số tròn nghìn');
                return;
            }

            // Close purchase modal
            closePurchaseCreditsModal();

            // Calculate credits (500 VNĐ = 1 credit)
            const credits = Math.floor(amount / 500);

            // Format amount
            const formattedAmount = amount.toLocaleString('vi-VN') + 'đ';

            // Debug log
            console.log('Opening payment modal for credits:', formattedAmount);
            console.log('openPaymentModal function exists:', typeof openPaymentModal);

            // Wait a moment for DOM to be ready, then open payment modal
            setTimeout(() => {
                if (typeof openPaymentModal === 'function') {
                    console.log('Calling openPaymentModal...');
                    openPaymentModal('credits', formattedAmount, 'credits');
                } else {
                    console.error('openPaymentModal not found!');
                    alert(`Vui lòng chuyển khoản ${formattedAmount} và liên hệ Admin qua Facebook để nhận ${credits} credits!`);
                    window.open('https://www.facebook.com/tiembanh4k/', '_blank');
                }
            }, 100);
        }

        // Update credits display
        function updateCreditsDisplay(credits) {
            const creditsElement = document.getElementById('userCredits');
            if (creditsElement) {
                creditsElement.textContent = credits || 0;
                if (credits <= 0) {
                    creditsElement.style.color = '#ef4444';
                } else if (credits <= 5) {
                    creditsElement.style.color = '#fbbf24';
                } else {
                    creditsElement.style.color = '#22c55e';
                }
            }
        }

        // Update credits expiration display (cho Free plan)
        function updateCreditsExpiration(user) {
            const expiresRow = document.getElementById('creditsExpiresRow');
            const expiresText = document.getElementById('creditsExpires');

            if (!expiresRow || !expiresText) return;

            // Chỉ hiện cho Free plan
            if (user.plan !== 'free') {
                expiresRow.style.display = 'none';
                return;
            }

            // Tính số ngày còn lại (7 ngày từ lastCreditsReset)
            const lastReset = user.lastCreditsReset ? new Date(user.lastCreditsReset) : new Date();
            const now = new Date();
            const daysSinceReset = Math.floor((now - lastReset) / (1000 * 60 * 60 * 24));
            const daysLeft = Math.max(0, 7 - daysSinceReset);

            // Tính ngày hết hạn
            const expireDate = new Date(lastReset);
            expireDate.setDate(expireDate.getDate() + 7);
            const expireDateStr = expireDate.toLocaleDateString('vi-VN', { day: '2-digit', month: '2-digit', year: 'numeric' });

            // Hiển thị row
            expiresRow.style.display = 'flex';

            // Cập nhật text và màu sắc
            if (daysLeft <= 0 || user.credits <= 0) {
                // Đã hết hạn - hiện ngày hết hạn
                expiresText.textContent = `Expired (${expireDateStr})`;
                expiresText.style.color = '#ef4444'; // Đỏ
            } else if (daysLeft === 1) {
                expiresText.textContent = '1 day left';
                expiresText.style.color = '#ef4444'; // Đỏ
            } else if (daysLeft <= 3) {
                expiresText.textContent = `${daysLeft} days left`;
                expiresText.style.color = '#f59e0b'; // Cam
            } else {
                expiresText.textContent = `${daysLeft} days left`;
                expiresText.style.color = '#22c55e'; // Xanh
            }
        }

        // Show no credits modal
        function showNoCreditsModal() {
            // Lấy email của user hiện tại
            const currentUser = JSON.parse(localStorage.getItem('current_user') || '{}');
            const userEmail = currentUser.email || 'email của bạn';

            if (typeof showConfirmCustomModal === 'function') {
                showConfirmCustomModal({
                    icon: '💳',
                    title: 'HẾT CREDITS',
                    message: `Bạn đã sử dụng hết credits.\n\nCách nhận thêm credits:\n• Mua credits (500 VNĐ = 1 credit, tối thiểu 30.000 VNĐ = 60 credits)\n• Giới thiệu bạn bè → nhận 5 credits/người\n (tối đa 2 lượt/tháng)\n\n💡 Mã giới thiệu của bạn là: ${userEmail}`,
                    confirmText: 'Mua thêm Credits',
                    cancelText: 'Đóng'
                }).then(confirmed => {
                    if (confirmed) {
                        openPurchaseCreditsModal();
                    }
                });
            } else {
                alert('Bạn đã hết credits. Vui lòng mua thêm để tiếp tục!');
                openPurchaseCreditsModal();
            }
        }

        // ========================================
        // EARN CREDITS MODAL FUNCTIONS
        // ========================================

        /**
         * Mở modal hướng dẫn kiếm credits
         */
        function openEarnCreditsModal() {
            const modal = document.getElementById('earnCreditsModalOverlay');
            if (!modal) return;

            // Lấy thông tin user hiện tại
            const currentUser = JSON.parse(localStorage.getItem('current_user') || localStorage.getItem('currentUser') || '{}');
            const userEmail = currentUser.email || 'email của bạn';
            const monthlyReferralsUsed = currentUser.monthlyReferralsUsed || 0;
            const invitesRemaining = Math.max(0, 2 - monthlyReferralsUsed);

            // Cập nhật nội dung modal
            const referralCodeEl = document.getElementById('earnCreditsReferralCode');
            const invitesRemainingEl = document.getElementById('earnCreditsInvitesRemaining');

            if (referralCodeEl) referralCodeEl.textContent = userEmail;
            if (invitesRemainingEl) invitesRemainingEl.textContent = invitesRemaining;

            // Hiển thị modal
            modal.style.display = 'flex';

            // Click outside to close
            modal.onclick = function (e) {
                if (e.target === modal) {
                    closeEarnCreditsModal();
                }
            };

            // ESC to close
            document.addEventListener('keydown', handleEarnCreditsModalEsc);
        }

        /**
         * Đóng modal hướng dẫn kiếm credits
         */
        function closeEarnCreditsModal() {
            const modal = document.getElementById('earnCreditsModalOverlay');
            if (modal) {
                modal.style.display = 'none';
            }
            document.removeEventListener('keydown', handleEarnCreditsModalEsc);
        }

        /**
         * Handler ESC key cho modal
         */
        function handleEarnCreditsModalEsc(e) {
            if (e.key === 'Escape') {
                closeEarnCreditsModal();
            }
        }

        /**
         * Copy mã giới thiệu vào clipboard
         */
        function copyEarnCreditsReferralCode() {
            const codeEl = document.getElementById('earnCreditsReferralCode');
            if (!codeEl) return;

            const code = codeEl.textContent;
            navigator.clipboard.writeText(code).then(() => {
                // Hiển thị feedback bằng SVG check icon
                const btn = document.querySelector('.copy-referral-btn');
                if (btn) {
                    const originalHTML = btn.innerHTML;
                    btn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#22c55e" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>';
                    setTimeout(() => {
                        btn.innerHTML = originalHTML;
                    }, 1500);
                }
            }).catch(err => {
                console.error('Copy failed:', err);
                // Fallback: select text
                const range = document.createRange();
                range.selectNode(codeEl);
                window.getSelection().removeAllRanges();
                window.getSelection().addRange(range);
            });
        }

        /**
         * Xử lý bấm nút mua credits từ modal kiếm credits
         */
        function handleBuyCreditsFromEarnModal() {
            // Đóng modal hiện tại
            closeEarnCreditsModal();

            // Mở modal mua credits
            setTimeout(() => {
                if (typeof openPurchaseCreditsModal === 'function') {
                    openPurchaseCreditsModal();
                }
            }, 200);
        }

        /**
         * Hiển thị thông báo không đủ credits với link hướng dẫn
         * @param {number} required - Số credits cần
         * @param {number} current - Số credits hiện có
         * @returns {string} HTML string với thông báo
         */
        function getInsufficientCreditsMessage(required, current) {
            return `Bạn cần ${required} credits để kích hoạt TV. Hiện tại bạn có ${current} credits. <span class="earn-credits-link" onclick="openEarnCreditsModal()">Cách để kiếm thêm credits?</span>`;
        }

        // Export functions
        window.openEarnCreditsModal = openEarnCreditsModal;
        window.closeEarnCreditsModal = closeEarnCreditsModal;
        window.copyEarnCreditsReferralCode = copyEarnCreditsReferralCode;
        window.handleBuyCreditsFromEarnModal = handleBuyCreditsFromEarnModal;
        window.getInsufficientCreditsMessage = getInsufficientCreditsMessage;

        // ========================================
        // TV ACTIVATION - Kích hoạt Netflix trên TV
        // ========================================

        /**
         * Xử lý kích hoạt TV từ form nhập mã
         */
        async function handleTvActivation() {
            const codeInput = document.getElementById('tvCodeInput');
            const activateBtn = document.getElementById('tvActivateBtn');
            const btnText = document.getElementById('tvActivateBtnText');
            const statusDiv = document.getElementById('tvActivationStatus');

            const code = codeInput.value.replace(/-/g, '').trim(); // Loại bỏ dấu "-"

            // Validate mã TV
            if (!code) {
                showTvStatus('Vui lòng nhập mã TV từ màn hình TV.', 'warning');
                codeInput.focus();
                return;
            }

            if (!/^[0-9]{8}$/.test(code)) {
                showTvStatus('Mã TV phải là 8 chữ số.', 'error');
                codeInput.focus();
                return;
            }

            // Kiểm tra đăng nhập
            const authToken = localStorage.getItem('auth_token');
            if (!authToken) {
                showTvStatus('Vui lòng đăng nhập để sử dụng tính năng này.', 'error');
                return;
            }

            // Hiện modal xác nhận trừ 5 credits trước khi kích hoạt
            if (typeof showConfirmCustomModal === 'function') {
                const confirmed = await showConfirmCustomModal({
                    icon: '📺',
                    title: 'Xác nhận kích hoạt Netflix TV',
                    message: 'Kích hoạt Netflix trên TV sẽ trừ 5 credits từ tài khoản của bạn.\n\nBạn có muốn tiếp tục?',
                    confirmText: 'Kích hoạt (-5 credits)',
                    cancelText: 'Hủy'
                });

                if (!confirmed) {
                    return;
                }
            }

            // Disable button và hiện loading
            activateBtn.disabled = true;
            btnText.innerHTML = '<span class="spinner" style="display: inline-block; width: 14px; height: 14px; border: 2px solid #fff; border-top-color: transparent; border-radius: 50%; animation: spin 0.8s linear infinite;"></span> Đang kích hoạt Netflix TV...';
            showTvStatus('Đang kết nối đến Netflix...', 'info');

            try {
                // Lấy BACKEND_URL từ config
                const backendUrl = window.APP_CONFIG ? window.APP_CONFIG.BACKEND_URL : 'https://backend-c0r3-7xpq9zn2025.onrender.com';

                const response = await fetch(`${backendUrl}/api/tv/activate`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({ code: code })
                });

                const data = await response.json();

                if (data.success) {
                    // Thành công!
                    showTvStatus('TV đã được kích hoạt thành công! Kiểm tra TV của bạn.', 'success');
                    codeInput.value = '';

                    // Show modal thông báo thành công
                    if (typeof showCustomModal === 'function') {
                        showCustomModal({
                            icon: '✅',
                            title: 'Kích hoạt Netflix TV thành công!',
                            message: 'Netflix đã được kích hoạt trên TV của bạn.\n\nBây giờ bạn có thể xem phim trên TV!',
                            buttons: [{
                                text: 'Tuyệt vời!',
                                type: 'primary'
                            }]
                        });
                    }
                } else {
                    // Xử lý lỗi cụ thể
                    let errorMsg = data.error || 'Không thể kích hoạt TV.';
                    let errorType = 'error';

                    // Gợi ý cho từng loại lỗi
                    if (data.code === 'COOKIE_EXPIRED' || data.code === 'SESSION_EXPIRED' || data.code === 'COOKIE_INVALID') {
                        // Hiển thị modal hướng dẫn rõ ràng
                        if (typeof showCustomModal === 'function') {
                            showCustomModal({
                                icon: '⚠️',
                                title: 'Cần kích hoạt lại tài khoản',
                                message: 'Tài khoản Netflix hiện không khả dụng.\n\nĐể kích hoạt TV, bạn cần:\n\n1. Mở PC/Laptop có cài Extension\n2. Bấm "Watch as Guest" để lấy tài khoản mới\n3. Sau đó quay lại đây nhập mã TV',
                                buttons: [{
                                    text: 'Đã hiểu',
                                    type: 'primary'
                                }]
                            });
                        }
                        errorType = 'warning';
                    } else if (data.code === 'NO_COOKIE_AVAILABLE') {
                        errorMsg = 'Hiện không có tài khoản Netflix khả dụng. Vui lòng thử lại sau hoặc liên hệ support.';
                    } else if (data.code === 'RATE_LIMITED') {
                        errorType = 'warning';
                    } else if (data.code === 'INSUFFICIENT_CREDITS') {
                        // Hiển thị thông báo với link hướng dẫn kiếm credits
                        const required = data.required || 5;
                        const current = data.current || 0;
                        showTvStatusWithHtml(getInsufficientCreditsMessage(required, current), 'error');
                        return; // Không gọi showTvStatus thường
                    }

                    showTvStatus(errorMsg, errorType);
                }

            } catch (error) {
                console.error('❌ TV activation error:', error);
                showTvStatus('Lỗi kết nối. Vui lòng kiểm tra mạng và thử lại.', 'error');
            } finally {
                // Re-enable button
                activateBtn.disabled = false;
                btnText.textContent = 'Kích hoạt TV';
            }
        }

        /**
         * Hiển thị status message cho TV activation
         */
        function showTvStatus(message, type = 'info') {
            const statusDiv = document.getElementById('tvActivationStatus');
            if (!statusDiv) return;

            statusDiv.style.display = 'block';
            statusDiv.textContent = message;

            // Reset styles
            statusDiv.style.background = '';
            statusDiv.style.color = '';
            statusDiv.style.borderLeft = '';

            switch (type) {
                case 'success':
                    statusDiv.style.background = 'rgba(34, 197, 94, 0.15)';
                    statusDiv.style.color = '#4ade80';
                    statusDiv.style.borderLeft = '3px solid #22c55e';
                    break;
                case 'error':
                    statusDiv.style.background = 'rgba(239, 68, 68, 0.15)';
                    statusDiv.style.color = '#f87171';
                    statusDiv.style.borderLeft = '3px solid #ef4444';
                    break;
                case 'warning':
                    statusDiv.style.background = 'rgba(251, 191, 36, 0.15)';
                    statusDiv.style.color = '#fbbf24';
                    statusDiv.style.borderLeft = '3px solid #f59e0b';
                    break;
                case 'info':
                default:
                    statusDiv.style.background = 'rgba(139, 92, 246, 0.15)';
                    statusDiv.style.color = '#a78bfa';
                    statusDiv.style.borderLeft = '3px solid #8b5cf6';
                    break;
            }

            // Auto-hide after 10 seconds for success
            if (type === 'success') {
                setTimeout(() => {
                    statusDiv.style.display = 'none';
                }, 10000);
            }
        }

        /**
         * Hiển thị status message với HTML content cho TV activation
         * (Dùng khi cần hiển thị link có thể click)
         */
        function showTvStatusWithHtml(htmlMessage, type = 'info') {
            const statusDiv = document.getElementById('tvActivationStatus');
            if (!statusDiv) return;

            statusDiv.style.display = 'block';
            statusDiv.innerHTML = htmlMessage; // Dùng innerHTML thay vì textContent

            // Reset styles
            statusDiv.style.background = '';
            statusDiv.style.color = '';
            statusDiv.style.borderLeft = '';

            switch (type) {
                case 'success':
                    statusDiv.style.background = 'rgba(34, 197, 94, 0.15)';
                    statusDiv.style.color = '#4ade80';
                    statusDiv.style.borderLeft = '3px solid #22c55e';
                    break;
                case 'error':
                    statusDiv.style.background = 'rgba(239, 68, 68, 0.15)';
                    statusDiv.style.color = '#f87171';
                    statusDiv.style.borderLeft = '3px solid #ef4444';
                    break;
                case 'warning':
                    statusDiv.style.background = 'rgba(251, 191, 36, 0.15)';
                    statusDiv.style.color = '#fbbf24';
                    statusDiv.style.borderLeft = '3px solid #f59e0b';
                    break;
                case 'info':
                default:
                    statusDiv.style.background = 'rgba(139, 92, 246, 0.15)';
                    statusDiv.style.color = '#a78bfa';
                    statusDiv.style.borderLeft = '3px solid #8b5cf6';
                    break;
            }
        }

        /**
         * Toggle Accordion cho hướng dẫn TV
         */
        function toggleAccordion(accordionId) {
            const accordion = document.getElementById(accordionId);
            const icon = document.getElementById(accordionId + 'Icon');

            if (accordion.style.maxHeight && accordion.style.maxHeight !== '0px') {
                // Đang mở -> đóng lại
                accordion.style.maxHeight = '0px';
                icon.style.transform = 'rotate(0deg)';
                icon.textContent = '▼';
            } else {
                // Đang đóng -> mở ra
                accordion.style.maxHeight = accordion.scrollHeight + 'px';
                icon.style.transform = 'rotate(180deg)';
                icon.textContent = '▲';
            }
        }

        /**
         * Mobile TV Activation Handler
         */
        async function handleMobileTvActivation() {
            const codeInput = document.getElementById('mobileTvCodeInput');
            const statusDiv = document.getElementById('mobileTvStatus');
            const btn = codeInput.parentElement.querySelector('button');

            const code = codeInput.value.replace(/-/g, '').trim(); // Loại bỏ dấu "-"

            // Validate
            if (!code) {
                statusDiv.innerHTML = '<span style="color: #fbbf24;">Nhập mã TV</span>';
                codeInput.focus();
                return;
            }

            if (!/^[0-9]{8}$/.test(code)) {
                statusDiv.innerHTML = '<span style="color: #ef4444;">Mã phải là 8 số</span>';
                codeInput.focus();
                return;
            }

            const authToken = localStorage.getItem('auth_token');
            if (!authToken) {
                statusDiv.innerHTML = '<span style="color: #ef4444;">Chưa đăng nhập</span>';
                return;
            }

            // Hiện modal xác nhận trừ 5 credits trước khi kích hoạt
            if (typeof showConfirmCustomModal === 'function') {
                const confirmed = await showConfirmCustomModal({
                    icon: '📺',
                    title: 'Xác nhận kích hoạt Netflix TV',
                    message: 'Kích hoạt Netflix trên TV sẽ trừ 5 credits từ tài khoản của bạn.\n\nBạn có muốn tiếp tục?',
                    confirmText: 'Kích hoạt (-5 credits)',
                    cancelText: 'Hủy'
                });

                if (!confirmed) {
                    return;
                }
            }

            // Loading
            btn.disabled = true;
            statusDiv.innerHTML = '<span style="color: #a78bfa;">Đang kích hoạt Netflix TV...</span>';

            try {
                const backendUrl = window.APP_CONFIG ? window.APP_CONFIG.BACKEND_URL : 'https://backend-c0r3-7xpq9zn2025.onrender.com';

                const response = await fetch(`${backendUrl}/api/tv/activate`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({ code: code })
                });

                const data = await response.json();

                if (data.success) {
                    statusDiv.innerHTML = '<span style="color: #4ade80;">Kích hoạt Netflix TV thành công!</span>';
                    codeInput.value = '';

                    // Reload assigned cookies để cập nhật TV Account display
                    if (typeof loadAssignedCookies === 'function') {
                        loadAssignedCookies();
                    }

                    // Cập nhật credits display
                    if (data.creditsRemaining !== undefined) {
                        if (typeof updateCreditsDisplay === 'function') {
                            updateCreditsDisplay(data.creditsRemaining);
                        }
                    }

                    // Tạo message cho modal
                    let successMsg = 'Netflix đã được kích hoạt trên TV của bạn.';
                    if (data.creditsDeducted > 0) {
                        successMsg += `\n\n-${data.creditsDeducted} credits (còn lại: ${data.creditsRemaining})`;
                    }

                    if (typeof showCustomModal === 'function') {
                        showCustomModal({
                            icon: '✅',
                            title: 'Kích hoạt TV thành công!',
                            message: successMsg,
                            buttons: [{ text: 'OK', type: 'primary' }]
                        });
                    }
                } else {
                    let errorMsg = data.error || 'Lỗi kích hoạt';
                    if (data.code === 'COOKIE_EXPIRED' || data.code === 'SESSION_EXPIRED' || data.code === 'COOKIE_INVALID') {
                        errorMsg = 'Cần Watch as Guest trước';
                        statusDiv.innerHTML = `<span style="color: #ef4444;">${errorMsg}</span>`;
                    } else if (data.code === 'INSUFFICIENT_CREDITS') {
                        // Hiển thị thông báo với link hướng dẫn kiếm credits
                        const required = data.required || 5;
                        const current = data.current || 0;
                        statusDiv.innerHTML = `<span style="color: #ef4444;">${getInsufficientCreditsMessage(required, current)}</span>`;
                    } else {
                        statusDiv.innerHTML = `<span style="color: #ef4444;">${errorMsg}</span>`;
                    }
                }

            } catch (error) {
                statusDiv.innerHTML = '<span style="color: #ef4444;">Lỗi kết nối</span>';
            } finally {
                btn.disabled = false;
            }
        }

        // Add CSS animation for spinner
        if (!document.getElementById('tvActivationStyles')) {
            const style = document.createElement('style');
            style.id = 'tvActivationStyles';
            style.textContent = `
                @keyframes spin {
                    to { transform: rotate(360deg); }
                }
            `;
            document.head.appendChild(style);
        }

        // Format TV code input as xxxx-xxxx
        function formatTvCodeInput(input) {
            input.addEventListener('input', function (e) {
                let value = e.target.value.replace(/[^0-9]/g, ''); // Chỉ giữ số
                if (value.length > 8) value = value.slice(0, 8);

                // Format xxxx-xxxx
                if (value.length > 4) {
                    value = value.slice(0, 4) + '-' + value.slice(4);
                }

                e.target.value = value;
            });
        }

        // Apply format to both inputs
        document.addEventListener('DOMContentLoaded', function () {
            const desktopInput = document.getElementById('tvCodeInput');
            const mobileInput = document.getElementById('mobileTvCodeInput');

            if (desktopInput) formatTvCodeInput(desktopInput);
            if (mobileInput) formatTvCodeInput(mobileInput);

            // Show/hide mobile-only elements
            if (window.__isMobile) {
                const pcAccountRow = document.getElementById('pcAccountRow');
                const tvAccountRow = document.getElementById('tvAccountRow');
                const switchTvBtn = document.getElementById('switchTvAccountBtn');

                // Ẩn PC Account, hiện TV Account trên mobile
                if (pcAccountRow) pcAccountRow.style.display = 'none';
                if (tvAccountRow) tvAccountRow.style.display = 'flex';
                if (switchTvBtn) switchTvBtn.style.display = 'block';
            }
        });

        // ========================================
        // MOBILE TV COOKIE FUNCTIONS
        // ========================================

        // Load assigned cookies (PC + Mobile)
        async function loadAssignedCookies() {
            try {
                const authToken = localStorage.getItem('auth_token');
                if (!authToken) return;

                const backendUrl = window.APP_CONFIG ? window.APP_CONFIG.BACKEND_URL : 'https://backend-c0r3-7xpq9zn2025.onrender.com';

                const response = await fetch(`${backendUrl}/api/cookies/assigned`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (response.ok) {
                    const data = await response.json();

                    // Trên mobile: chỉ cập nhật TV Account (Mobile cookie)
                    if (window.__isMobile) {
                        const tvCookieEl = document.getElementById('assignedTvCookie');

                        if (tvCookieEl) {
                            if (data.mobileCookie) {
                                tvCookieEl.textContent = `#${data.mobileCookie.cookieNumber}`;
                                tvCookieEl.style.color = '#8b5cf6';
                            } else {
                                tvCookieEl.textContent = '-';
                                tvCookieEl.style.color = '#666';
                            }
                        }
                    }
                }
            } catch (error) {
                console.error('Load assigned cookies error:', error);
            }
        }

        // Switch mobile TV account
        async function switchMobileTvAccount() {
            const btn = document.getElementById('switchTvAccountBtn');
            if (!btn) return;

            // Confirm với custom modal đẹp hơn
            if (typeof showConfirmCustomModal === 'function') {
                const confirmed = await showConfirmCustomModal({
                    icon: '🔄',
                    title: 'Đổi tài khoản Netflix TV',
                    message: 'Bạn muốn đổi sang tài khoản Netflix TV khác?\n\nLưu ý: Mỗi lần đổi sẽ trừ 1 vào Switches Left.',
                    confirmText: 'Đổi tài khoản',
                    cancelText: 'Hủy'
                });

                if (!confirmed) return;
            } else {
                const confirmed = confirm('Bạn muốn đổi sang tài khoản Netflix TV khác?\n\nLưu ý: Mỗi lần đổi sẽ trừ 1 vào Switches Left.');
                if (!confirmed) return;
            }

            const authToken = localStorage.getItem('auth_token');
            if (!authToken) {
                if (typeof showCustomModal === 'function') {
                    showCustomModal({
                        icon: '⚠️',
                        title: 'Chưa đăng nhập',
                        message: 'Vui lòng đăng nhập lại để tiếp tục.',
                        buttons: [{ text: 'OK', type: 'primary' }]
                    });
                } else {
                    alert('Vui lòng đăng nhập lại');
                }
                return;
            }

            // Loading state
            const originalText = btn.innerHTML;
            btn.disabled = true;
            btn.innerHTML = '⏳ Đang đổi...';

            try {
                const backendUrl = window.APP_CONFIG ? window.APP_CONFIG.BACKEND_URL : 'https://backend-c0r3-7xpq9zn2025.onrender.com';

                const response = await fetch(`${backendUrl}/api/cookies/switch-mobile`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    }
                });

                const data = await response.json();

                if (data.success) {
                    // Update TV cookie display
                    const tvCookieEl = document.getElementById('assignedTvCookie');
                    if (tvCookieEl) {
                        tvCookieEl.textContent = `#${data.newCookieNumber}`;
                        tvCookieEl.style.color = '#8b5cf6';
                    }

                    // Update switches left
                    const reportLimitEl = document.getElementById('reportLimit');
                    if (reportLimitEl && data.switchesLeft !== undefined) {
                        const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
                        const maxLimit = currentUser.plan === 'pro' ? 5 : 2;
                        const threshold = Math.floor(maxLimit / 2);
                        reportLimitEl.textContent = `${data.switchesLeft}/${maxLimit}`;
                        reportLimitEl.style.color = data.switchesLeft > threshold ? '#22c55e' : data.switchesLeft > 0 ? '#fbbf24' : '#ef4444';
                    }

                    // Show success modal
                    if (typeof showCustomModal === 'function') {
                        showCustomModal({
                            icon: '✅',
                            title: 'Đổi tài khoản TV thành công!',
                            message: data.message,
                            buttons: [{ text: 'OK', type: 'primary' }]
                        });
                    } else {
                        alert(data.message);
                    }
                } else {
                    // Show error
                    if (typeof showCustomModal === 'function') {
                        showCustomModal({
                            icon: '❌',
                            title: 'Không thể đổi tài khoản',
                            message: data.error || 'Vui lòng thử lại sau',
                            buttons: [{ text: 'OK', type: 'secondary' }]
                        });
                    } else {
                        alert(data.error || 'Không thể đổi tài khoản');
                    }
                }

            } catch (error) {
                console.error('Switch mobile TV account error:', error);
                if (typeof showCustomModal === 'function') {
                    showCustomModal({
                        icon: '❌',
                        title: 'Lỗi kết nối',
                        message: 'Không thể kết nối đến server. Vui lòng thử lại.',
                        buttons: [{ text: 'OK', type: 'secondary' }]
                    });
                } else {
                    alert('Lỗi kết nối. Vui lòng thử lại.');
                }
            } finally {
                btn.disabled = false;
                btn.innerHTML = originalText;
            }
        }

        // Export functions
        window.loadAssignedCookies = loadAssignedCookies;
        window.switchMobileTvAccount = switchMobileTvAccount;
    </script>

    <!-- Environment Configuration - Must load first -->
    <script src="config.js"></script>
    <script src="auth.js"></script>
    <script src="cookie-retry-handler.js"></script>
    <script src="shop/featured-products.js"></script>
    <script>
        // Load sản phẩm featured vào các modal
        function renderFeaturedProducts() {
            const grids = ['modalProductsGrid1', 'modalProductsGrid2'];

            grids.forEach(gridId => {
                const grid = document.getElementById(gridId);
                if (!grid || typeof featuredProducts === 'undefined') return;

                grid.innerHTML = featuredProducts.map(product => `
                    <a href="${product.buyLink}" target="_blank" style="text-decoration: none; background: rgba(0,0,0,0.4); border-radius: 10px; padding: 10px; border: 1px solid rgba(255,255,255,0.1); transition: all 0.3s; display: flex; gap: 10px; align-items: center;" onmouseover="this.style.borderColor='#e50914'; this.style.transform='translateY(-2px)';" onmouseout="this.style.borderColor='rgba(255,255,255,0.1)'; this.style.transform='translateY(0)';">
                        <img src="${product.image}" alt="${product.name}" style="width: 50px; height: 50px; object-fit: cover; border-radius: 6px; flex-shrink: 0;">
                        <div style="text-align: left;">
                            <p style="color: #fff; font-size: 0.95rem; font-weight: 600; margin: 0 0 4px 0; line-height: 1.3;">${product.name}</p>
                            <p style="color: #4ade80; font-size: 0.9rem; margin: 0;">${product.priceNow} ${product.priceOriginal ? `<span style="color: #888; text-decoration: line-through; font-size: 0.85rem;">${product.priceOriginal}</span>` : ''}</p>
                        </div>
                    </a>
                `).join('');
            });
        }

        // Chạy khi DOM ready
        document.addEventListener('DOMContentLoaded', renderFeaturedProducts);
    </script>
    <script src="app.js"></script>
</body>

</html>